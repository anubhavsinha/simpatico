<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Simpatico: DdMd::AtomDistributor Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Simpatico
   &#160;<span id="projectnumber">v1.05</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="namespaceDdMd.html">DdMd</a>      </li>
      <li class="navelem"><a class="el" href="classDdMd_1_1AtomDistributor.html">AtomDistributor</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">DdMd::AtomDistributor Class Reference<div class="ingroups"><a class="el" href="group__DdMd__Communicate__Module.html">MPI Communication</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="DdMd::AtomDistributor" --><!-- doxytag: inherits="Util::ParamComposite" --><hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Class for distributing Atoms among processors. </p>
<p>A <a class="el" href="classDdMd_1_1AtomDistributor.html" title="Class for distributing Atoms among processors.">AtomDistributor</a> is used to distribute items among processors during startup, when the master process must read a configuration file.</p>
<p>Usage: </p>
<div class="fragment"><pre class="fragment">    <a class="code" href="classDdMd_1_1AtomDistributor.html#a251a1b76004612e19311393af4641bb0" title="Constructor.">AtomDistributor</a>   distributor;
    AtomStorage   storage;
    Atom*         ptr;
    std::ifstream file

    <span class="keywordflow">if</span> (rank = 0) {  <span class="comment">// If master processor</span>

       distributor.setup();

       <span class="comment">// Read from file</span>
       <span class="keywordflow">for</span> (i = 0; i &lt; nAtom; ++i) {

           ptr = distributor.newAtomPtr();

           <span class="comment">// Read properties of Atom *ptr from file</span>
           file &gt;&gt; ptr-&gt;position();
           <span class="comment">// ...</span>

           <span class="comment">// Cache active atom *ptr for sending.</span>
           distributor.addAtom(storage);
       }

       <span class="comment">// Send all remaining.</span>
       distributor.send();

    } <span class="keywordflow">else</span> { <span class="comment">// If not master processor</span>

       distributor.receive(storage);

    }
</pre></div><p> The addAtom(storage) method can send items if required by memory limits, and the <a class="el" href="classDdMd_1_1AtomDistributor.html#a7db868b432bda314ff90fe779154e607" title="Send all atoms that have not be sent previously.">send()</a> method then sends all remaining atoms. </p>

<p>Definition at line <a class="el" href="AtomDistributor_8h_source.html#l00075">75</a> of file <a class="el" href="AtomDistributor_8h_source.html">AtomDistributor.h</a>.</p>
</div>
<p><code>#include &lt;<a class="el" href="AtomDistributor_8h_source.html">AtomDistributor.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for DdMd::AtomDistributor:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classDdMd_1_1AtomDistributor.png" usemap="#DdMd::AtomDistributor_map" alt=""/>
  <map id="DdMd::AtomDistributor_map" name="DdMd::AtomDistributor_map">
<area href="classUtil_1_1ParamComposite.html" title="An object that can read multiple parameters from file." alt="Util::ParamComposite" shape="rect" coords="74,112,212,136"/>
<area href="classUtil_1_1ParamComponent.html" title="Abstract base class for classes that input and ouput parameters to file." alt="Util::ParamComponent" shape="rect" coords="74,56,212,80"/>
<area href="classUtil_1_1Serializable.html" title="Abstract class for serializable objects." alt="Util::Serializable" shape="rect" coords="0,0,138,24"/>
<area href="classUtil_1_1MpiFileIo.html" title="Identifies whether this processor may do file I/O." alt="Util::MpiFileIo" shape="rect" coords="148,0,286,24"/>
</map>
 </div></div>

<p><a href="classDdMd_1_1AtomDistributor-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDdMd_1_1AtomDistributor.html#a251a1b76004612e19311393af4641bb0">AtomDistributor</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="#a251a1b76004612e19311393af4641bb0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDdMd_1_1AtomDistributor.html#ac01053af8c89fb1463d88a700936ada2">~AtomDistributor</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor.  <a href="#ac01053af8c89fb1463d88a700936ada2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDdMd_1_1AtomDistributor.html#a342cdb0b33d09f8e8c16a079cd8ee167">associate</a> (<a class="el" href="classDdMd_1_1Domain.html">Domain</a> &amp;domain, <a class="el" href="group__Boundary__Module.html#ga71421cd7b35b357699d30161edb9a53c">Boundary</a> &amp;boundary, <a class="el" href="classDdMd_1_1AtomStorage.html">AtomStorage</a> &amp;storage, <a class="el" href="classDdMd_1_1Buffer.html">Buffer</a> &amp;buffer)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Set pointers to boundary, domain, and buffer.  <a href="#a342cdb0b33d09f8e8c16a079cd8ee167"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDdMd_1_1AtomDistributor.html#a357b04f23528f44d50eaf84065f53ae5">initialize</a> (int cacheCapacity=100)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Set cacheCapacity, allocate memory and initialize object.  <a href="#a357b04f23528f44d50eaf84065f53ae5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDdMd_1_1AtomDistributor.html#aa3c52a6ca52884182c4bde27f7dbf686">readParameters</a> (std::istream &amp;in)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Read cacheCapacity, allocate memory and initialize object.  <a href="#aa3c52a6ca52884182c4bde27f7dbf686"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDdMd_1_1AtomDistributor.html#a66c9e5396bccd71cc6723687504c43f0">setup</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize buffer before the loop over atoms.  <a href="#a66c9e5396bccd71cc6723687504c43f0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classDdMd_1_1Atom.html">Atom</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDdMd_1_1AtomDistributor.html#a90bcc378acb7aff30016bd01ebbf9116">newAtomPtr</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns pointer an address available for a new <a class="el" href="classDdMd_1_1Atom.html" title="A point particle in an MD simulation.">Atom</a>.  <a href="#a90bcc378acb7aff30016bd01ebbf9116"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDdMd_1_1AtomDistributor.html#ae886a036e9985172666dbb1bb78e1fb2">addAtom</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Process the active atom for sending.  <a href="#ae886a036e9985172666dbb1bb78e1fb2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDdMd_1_1AtomDistributor.html#a7db868b432bda314ff90fe779154e607">send</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Send all atoms that have not be sent previously.  <a href="#a7db868b432bda314ff90fe779154e607"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDdMd_1_1AtomDistributor.html#a02d76d4f40c4a3d92f05aaea082f001b">receive</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive all atoms sent by master processor.  <a href="#a02d76d4f40c4a3d92f05aaea082f001b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDdMd_1_1AtomDistributor.html#a47a676ca8e326c5edeff5804b5b66b9b">validate</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Validate distribution of atoms after completion.  <a href="#a47a676ca8e326c5edeff5804b5b66b9b"></a><br/></td></tr>
</table>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a251a1b76004612e19311393af4641bb0"></a><!-- doxytag: member="DdMd::AtomDistributor::AtomDistributor" ref="a251a1b76004612e19311393af4641bb0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classDdMd_1_1AtomDistributor.html#a251a1b76004612e19311393af4641bb0">DdMd::AtomDistributor::AtomDistributor</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Constructor. </p>

<p>Definition at line <a class="el" href="AtomDistributor_8cpp_source.html#l00029">29</a> of file <a class="el" href="AtomDistributor_8cpp_source.html">AtomDistributor.cpp</a>.</p>

<p>References <a class="el" href="ParamComposite_8cpp_source.html#l00276">Util::ParamComposite::setClassName()</a>.</p>

</div>
</div>
<a class="anchor" id="ac01053af8c89fb1463d88a700936ada2"></a><!-- doxytag: member="DdMd::AtomDistributor::~AtomDistributor" ref="ac01053af8c89fb1463d88a700936ada2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classDdMd_1_1AtomDistributor.html#ac01053af8c89fb1463d88a700936ada2">DdMd::AtomDistributor::~AtomDistributor</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Destructor. </p>

<p>Definition at line <a class="el" href="AtomDistributor_8cpp_source.html#l00051">51</a> of file <a class="el" href="AtomDistributor_8cpp_source.html">AtomDistributor.cpp</a>.</p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a342cdb0b33d09f8e8c16a079cd8ee167"></a><!-- doxytag: member="DdMd::AtomDistributor::associate" ref="a342cdb0b33d09f8e8c16a079cd8ee167" args="(Domain &amp;domain, Boundary &amp;boundary, AtomStorage &amp;storage, Buffer &amp;buffer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classDdMd_1_1AtomDistributor.html#a342cdb0b33d09f8e8c16a079cd8ee167">DdMd::AtomDistributor::associate</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDdMd_1_1Domain.html">Domain</a> &amp;&#160;</td>
          <td class="paramname"><em>domain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__Boundary__Module.html#ga71421cd7b35b357699d30161edb9a53c">Boundary</a> &amp;&#160;</td>
          <td class="paramname"><em>boundary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classDdMd_1_1AtomStorage.html">AtomStorage</a> &amp;&#160;</td>
          <td class="paramname"><em>storage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classDdMd_1_1Buffer.html">Buffer</a> &amp;&#160;</td>
          <td class="paramname"><em>buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set pointers to boundary, domain, and buffer. </p>
<p>This method must be called on all nodes, before any other.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">boundary</td><td>Boundary object (periodic boundary conditions) </td></tr>
    <tr><td class="paramname">domain</td><td><a class="el" href="classDdMd_1_1Domain.html" title="Decomposition of the system into domains associated with processors.">Domain</a> object (processor grid) </td></tr>
    <tr><td class="paramname">storage</td><td><a class="el" href="classDdMd_1_1AtomStorage.html" title="A container for all the atoms and ghost atoms on this processor.">AtomStorage</a> object (processor grid) </td></tr>
    <tr><td class="paramname">buffer</td><td><a class="el" href="classDdMd_1_1Buffer.html" title="Buffer for sending blocks of data between processors.">Buffer</a> used for communication </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="AtomDistributor_8cpp_source.html#l00057">57</a> of file <a class="el" href="AtomDistributor_8cpp_source.html">AtomDistributor.cpp</a>.</p>

<p>Referenced by <a class="el" href="ddMd_2configIos_2ConfigIo_8cpp_source.html#l00125">DdMd::ConfigIo::associate()</a>.</p>

</div>
</div>
<a class="anchor" id="a357b04f23528f44d50eaf84065f53ae5"></a><!-- doxytag: member="DdMd::AtomDistributor::initialize" ref="a357b04f23528f44d50eaf84065f53ae5" args="(int cacheCapacity=100)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classDdMd_1_1AtomDistributor.html#a357b04f23528f44d50eaf84065f53ae5">DdMd::AtomDistributor::initialize</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>cacheCapacity</em> = <code>100</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set cacheCapacity, allocate memory and initialize object. </p>
<p>This method and readParameters both allocate all required memory and initialize the <a class="el" href="classDdMd_1_1AtomDistributor.html" title="Class for distributing Atoms among processors.">AtomDistributor</a>. Memory for a temporary read cache is alocated only on the master.</p>
<p>If cacheCapacity &lt; 0, this sets a default value large enough to accomodate full send buffers for all processors simultaneously.</p>
<p>Preconditions: The initialize method must have been called, the <a class="el" href="classDdMd_1_1Buffer.html" title="Buffer for sending blocks of data between processors.">Buffer</a> must be allocated, and the <a class="el" href="classDdMd_1_1Domain.html" title="Decomposition of the system into domains associated with processors.">Domain</a> must be initialized.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">cacheCapacity</td><td>max number of atoms cached for sending </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="AtomDistributor_8cpp_source.html#l00071">71</a> of file <a class="el" href="AtomDistributor_8cpp_source.html">AtomDistributor.cpp</a>.</p>

<p>Referenced by <a class="el" href="ddMd_2configIos_2ConfigIo_8cpp_source.html#l00169">DdMd::ConfigIo::initialize()</a>, <a class="el" href="ddMd_2configIos_2ConfigIo_8cpp_source.html#l00229">DdMd::ConfigIo::load()</a>, and <a class="el" href="ddMd_2configIos_2ConfigIo_8cpp_source.html#l00204">DdMd::ConfigIo::readParameters()</a>.</p>

</div>
</div>
<a class="anchor" id="aa3c52a6ca52884182c4bde27f7dbf686"></a><!-- doxytag: member="DdMd::AtomDistributor::readParameters" ref="aa3c52a6ca52884182c4bde27f7dbf686" args="(std::istream &amp;in)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classDdMd_1_1AtomDistributor.html#aa3c52a6ca52884182c4bde27f7dbf686">DdMd::AtomDistributor::readParameters</a> </td>
          <td>(</td>
          <td class="paramtype">std::istream &amp;&#160;</td>
          <td class="paramname"><em>in</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Read cacheCapacity, allocate memory and initialize object. </p>
<p>This method reads cacheCapacity from file, and then goes through the same initialization steps as <a class="el" href="classDdMd_1_1AtomDistributor.html#a357b04f23528f44d50eaf84065f53ae5" title="Set cacheCapacity, allocate memory and initialize object.">AtomDistributor::initialize()</a>.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">in</td><td>input stream from which parameter is read. </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classUtil_1_1ParamComposite.html#a172a3a656b5829c8d758424ad09a22a6">Util::ParamComposite</a>.</p>

<p>Definition at line <a class="el" href="AtomDistributor_8cpp_source.html#l00080">80</a> of file <a class="el" href="AtomDistributor_8cpp_source.html">AtomDistributor.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a66c9e5396bccd71cc6723687504c43f0"></a><!-- doxytag: member="DdMd::AtomDistributor::setup" ref="a66c9e5396bccd71cc6723687504c43f0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classDdMd_1_1AtomDistributor.html#a66c9e5396bccd71cc6723687504c43f0">DdMd::AtomDistributor::setup</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize buffer before the loop over atoms. </p>
<p>This method should be called only by the master processor, just before entering the loop to read atoms from file. </p>

<p>Definition at line <a class="el" href="AtomDistributor_8cpp_source.html#l00150">150</a> of file <a class="el" href="AtomDistributor_8cpp_source.html">AtomDistributor.cpp</a>.</p>

<p>References <a class="el" href="Buffer_8cpp_source.html#l00226">DdMd::Buffer::beginSendBlock()</a>, and <a class="el" href="Buffer_8cpp_source.html#l00215">DdMd::Buffer::clearSendBuffer()</a>.</p>

<p>Referenced by <a class="el" href="SerializeConfigIo_8cpp_source.html#l00087">DdMd::SerializeConfigIo::loadConfig()</a>, <a class="el" href="ddMd_2configIos_2DdMdConfigIo_8cpp_source.html#l00090">DdMd::DdMdConfigIo::readConfig()</a>, <a class="el" href="DdMdOrderedConfigIo_8cpp_source.html#l00091">DdMd::DdMdOrderedConfigIo::readConfig()</a>, and <a class="el" href="ddMd_2configIos_2LammpsConfigIo_8cpp_source.html#l00109">DdMd::LammpsConfigIo::readConfig()</a>.</p>

</div>
</div>
<a class="anchor" id="a90bcc378acb7aff30016bd01ebbf9116"></a><!-- doxytag: member="DdMd::AtomDistributor::newAtomPtr" ref="a90bcc378acb7aff30016bd01ebbf9116" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classDdMd_1_1Atom.html">Atom</a> * <a class="el" href="classDdMd_1_1AtomDistributor.html#a90bcc378acb7aff30016bd01ebbf9116">DdMd::AtomDistributor::newAtomPtr</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns pointer an address available for a new <a class="el" href="classDdMd_1_1Atom.html" title="A point particle in an MD simulation.">Atom</a>. </p>
<p>This method should be called only by the master processor. It returns the address within the internal cache for a new <a class="el" href="classDdMd_1_1Atom.html" title="A point particle in an MD simulation.">Atom</a> object. Every call to <a class="el" href="classDdMd_1_1AtomDistributor.html#a90bcc378acb7aff30016bd01ebbf9116" title="Returns pointer an address available for a new Atom.">newAtomPtr()</a> must be followed by a matching call to <a class="el" href="classDdMd_1_1AtomDistributor.html#ae886a036e9985172666dbb1bb78e1fb2" title="Process the active atom for sending.">addAtom()</a>.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>address for a new <a class="el" href="classDdMd_1_1Atom.html" title="A point particle in an MD simulation.">Atom</a>. </dd></dl>

<p>Definition at line <a class="el" href="AtomDistributor_8cpp_source.html#l00162">162</a> of file <a class="el" href="AtomDistributor_8cpp_source.html">AtomDistributor.cpp</a>.</p>

<p>References <a class="el" href="Buffer_8cpp_source.html#l00226">DdMd::Buffer::beginSendBlock()</a>, <a class="el" href="ddMd_2chemistry_2Atom_8cpp_source.html#l00056">DdMd::Atom::clear()</a>, <a class="el" href="Buffer_8cpp_source.html#l00215">DdMd::Buffer::clearSendBuffer()</a>, <a class="el" href="Domain_8h_source.html#l00256">DdMd::Domain::communicator()</a>, <a class="el" href="Buffer_8cpp_source.html#l00250">DdMd::Buffer::endSendBlock()</a>, <a class="el" href="Domain_8h_source.html#l00303">DdMd::Domain::gridRank()</a>, <a class="el" href="Domain_8h_source.html#l00348">DdMd::Domain::isInitialized()</a>, <a class="el" href="ddMd_2chemistry_2Atom_8cpp_source.html#l00069">DdMd::Atom::packAtom()</a>, <a class="el" href="ArrayStack_8h_source.html#l00196">Util::ArrayStack&lt; Data &gt;::pop()</a>, <a class="el" href="ArrayStack_8h_source.html#l00183">Util::ArrayStack&lt; Data &gt;::push()</a>, <a class="el" href="Buffer_8cpp_source.html#l00367">DdMd::Buffer::send()</a>, <a class="el" href="ArrayStack_8h_source.html#l00176">Util::ArrayStack&lt; Data &gt;::size()</a>, and <a class="el" href="global_8h_source.html#l00051">UTIL_THROW</a>.</p>

<p>Referenced by <a class="el" href="SerializeConfigIo_8cpp_source.html#l00087">DdMd::SerializeConfigIo::loadConfig()</a>, <a class="el" href="ddMd_2configIos_2DdMdConfigIo_8cpp_source.html#l00090">DdMd::DdMdConfigIo::readConfig()</a>, <a class="el" href="DdMdOrderedConfigIo_8cpp_source.html#l00091">DdMd::DdMdOrderedConfigIo::readConfig()</a>, and <a class="el" href="ddMd_2configIos_2LammpsConfigIo_8cpp_source.html#l00109">DdMd::LammpsConfigIo::readConfig()</a>.</p>

</div>
</div>
<a class="anchor" id="ae886a036e9985172666dbb1bb78e1fb2"></a><!-- doxytag: member="DdMd::AtomDistributor::addAtom" ref="ae886a036e9985172666dbb1bb78e1fb2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classDdMd_1_1AtomDistributor.html#ae886a036e9985172666dbb1bb78e1fb2">DdMd::AtomDistributor::addAtom</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Process the active atom for sending. </p>
<p>This method may be called only by the master processor, after a matching call to <a class="el" href="classDdMd_1_1AtomDistributor.html#a90bcc378acb7aff30016bd01ebbf9116" title="Returns pointer an address available for a new Atom.">newAtomPtr()</a>. It identifies which processor owns the active atom, i.e., the atom returned by the most recent call to newAtomPtr. After shifting the position of this atom to lie within the primary cell, it identifies the rank of the processor that owns this atom, based on its position. If this atom is owned by the master (rank == 0), the atom is added to the <a class="el" href="classDdMd_1_1AtomStorage.html" title="A container for all the atoms and ghost atoms on this processor.">AtomStorage</a> on the master node. Otherwise, the atom is added to a cache of stored atoms, and a pointer to this atom is added to a sendList for the relevant processor.</p>
<p>Atoms are actually transmitted to other processors as needed: Whenever addition of an atom to the cache would exceed either the cache capacity or the capacity of the sendlist for the owner processor, this method sends a buffer to the processor with the the largest sendList, before caching the current atom and marking it for later sending.</p>
<p>The coordinates of the active atom must be expressed in scaled / generalized [0, 1] coordinates when it is added.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>rank of processor that owns the active atom. </dd></dl>

<p>Definition at line <a class="el" href="AtomDistributor_8cpp_source.html#l00232">232</a> of file <a class="el" href="AtomDistributor_8cpp_source.html">AtomDistributor.cpp</a>.</p>

<p>References <a class="el" href="AtomStorage_8cpp_source.html#l00170">DdMd::AtomStorage::addNewAtom()</a>, <a class="el" href="Buffer_8cpp_source.html#l00226">DdMd::Buffer::beginSendBlock()</a>, <a class="el" href="Buffer_8cpp_source.html#l00215">DdMd::Buffer::clearSendBuffer()</a>, <a class="el" href="Domain_8h_source.html#l00256">DdMd::Domain::communicator()</a>, <a class="el" href="Buffer_8cpp_source.html#l00250">DdMd::Buffer::endSendBlock()</a>, <a class="el" href="Domain_8h_source.html#l00267">DdMd::Domain::grid()</a>, <a class="el" href="Domain_8h_source.html#l00303">DdMd::Domain::gridRank()</a>, <a class="el" href="AtomStorage_8h_source.html#l00598">DdMd::AtomStorage::isCartesian()</a>, <a class="el" href="Domain_8h_source.html#l00348">DdMd::Domain::isInitialized()</a>, <a class="el" href="AtomStorage_8cpp_source.html#l00149">DdMd::AtomStorage::newAtomPtr()</a>, <a class="el" href="Domain_8cpp_source.html#l00211">DdMd::Domain::ownerRank()</a>, <a class="el" href="ddMd_2chemistry_2Atom_8cpp_source.html#l00069">DdMd::Atom::packAtom()</a>, <a class="el" href="ddMd_2chemistry_2Atom_8h_source.html#l00363">DdMd::Atom::position()</a>, <a class="el" href="ArrayStack_8h_source.html#l00183">Util::ArrayStack&lt; Data &gt;::push()</a>, <a class="el" href="Buffer_8cpp_source.html#l00367">DdMd::Buffer::send()</a>, <a class="el" href="OrthorhombicBoundary_8h_source.html#l00412">Util::OrthorhombicBoundary::shiftGen()</a>, <a class="el" href="Grid_8h_source.html#l00147">Util::Grid::size()</a>, <a class="el" href="ArrayStack_8h_source.html#l00176">Util::ArrayStack&lt; Data &gt;::size()</a>, and <a class="el" href="global_8h_source.html#l00051">UTIL_THROW</a>.</p>

<p>Referenced by <a class="el" href="SerializeConfigIo_8cpp_source.html#l00087">DdMd::SerializeConfigIo::loadConfig()</a>, <a class="el" href="ddMd_2configIos_2DdMdConfigIo_8cpp_source.html#l00090">DdMd::DdMdConfigIo::readConfig()</a>, <a class="el" href="DdMdOrderedConfigIo_8cpp_source.html#l00091">DdMd::DdMdOrderedConfigIo::readConfig()</a>, and <a class="el" href="ddMd_2configIos_2LammpsConfigIo_8cpp_source.html#l00109">DdMd::LammpsConfigIo::readConfig()</a>.</p>

</div>
</div>
<a class="anchor" id="a7db868b432bda314ff90fe779154e607"></a><!-- doxytag: member="DdMd::AtomDistributor::send" ref="a7db868b432bda314ff90fe779154e607" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classDdMd_1_1AtomDistributor.html#a7db868b432bda314ff90fe779154e607">DdMd::AtomDistributor::send</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send all atoms that have not be sent previously. </p>
<p>This method should be called only by the master processor, after completion of a loop over all atoms to be sent. </p>

<p>Definition at line <a class="el" href="AtomDistributor_8cpp_source.html#l00349">349</a> of file <a class="el" href="AtomDistributor_8cpp_source.html">AtomDistributor.cpp</a>.</p>

<p>References <a class="el" href="Buffer_8cpp_source.html#l00226">DdMd::Buffer::beginSendBlock()</a>, <a class="el" href="ArrayStack_8h_source.html#l00169">Util::ArrayStack&lt; Data &gt;::capacity()</a>, <a class="el" href="Buffer_8cpp_source.html#l00215">DdMd::Buffer::clearSendBuffer()</a>, <a class="el" href="Domain_8h_source.html#l00256">DdMd::Domain::communicator()</a>, <a class="el" href="AtomStorage_8cpp_source.html#l00526">DdMd::AtomStorage::computeNAtomTotal()</a>, <a class="el" href="Buffer_8cpp_source.html#l00250">DdMd::Buffer::endSendBlock()</a>, <a class="el" href="Domain_8h_source.html#l00267">DdMd::Domain::grid()</a>, <a class="el" href="Domain_8h_source.html#l00303">DdMd::Domain::gridRank()</a>, <a class="el" href="Domain_8h_source.html#l00348">DdMd::Domain::isInitialized()</a>, <a class="el" href="AtomStorage_8h_source.html#l00583">DdMd::AtomStorage::nAtom()</a>, <a class="el" href="AtomStorage_8h_source.html#l00604">DdMd::AtomStorage::nAtomTotal()</a>, <a class="el" href="ddMd_2chemistry_2Atom_8cpp_source.html#l00069">DdMd::Atom::packAtom()</a>, <a class="el" href="ArrayStack_8h_source.html#l00183">Util::ArrayStack&lt; Data &gt;::push()</a>, <a class="el" href="Buffer_8cpp_source.html#l00367">DdMd::Buffer::send()</a>, <a class="el" href="Grid_8h_source.html#l00147">Util::Grid::size()</a>, <a class="el" href="ArrayStack_8h_source.html#l00176">Util::ArrayStack&lt; Data &gt;::size()</a>, <a class="el" href="AtomStorage_8cpp_source.html#l00541">DdMd::AtomStorage::unsetNAtomTotal()</a>, and <a class="el" href="global_8h_source.html#l00051">UTIL_THROW</a>.</p>

<p>Referenced by <a class="el" href="SerializeConfigIo_8cpp_source.html#l00087">DdMd::SerializeConfigIo::loadConfig()</a>, <a class="el" href="ddMd_2configIos_2DdMdConfigIo_8cpp_source.html#l00090">DdMd::DdMdConfigIo::readConfig()</a>, <a class="el" href="DdMdOrderedConfigIo_8cpp_source.html#l00091">DdMd::DdMdOrderedConfigIo::readConfig()</a>, and <a class="el" href="ddMd_2configIos_2LammpsConfigIo_8cpp_source.html#l00109">DdMd::LammpsConfigIo::readConfig()</a>.</p>

</div>
</div>
<a class="anchor" id="a02d76d4f40c4a3d92f05aaea082f001b"></a><!-- doxytag: member="DdMd::AtomDistributor::receive" ref="a02d76d4f40c4a3d92f05aaea082f001b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classDdMd_1_1AtomDistributor.html#a02d76d4f40c4a3d92f05aaea082f001b">DdMd::AtomDistributor::receive</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Receive all atoms sent by master processor. </p>
<p>This should be called by all processes except the master.</p>
<p>Upon return, all processors should have the correct atoms, with scaled / generalized atom coordinates set correctly. </p>

<p>Definition at line <a class="el" href="AtomDistributor_8cpp_source.html#l00427">427</a> of file <a class="el" href="AtomDistributor_8cpp_source.html">AtomDistributor.cpp</a>.</p>

<p>References <a class="el" href="AtomStorage_8cpp_source.html#l00170">DdMd::AtomStorage::addNewAtom()</a>, <a class="el" href="Buffer_8cpp_source.html#l00274">DdMd::Buffer::beginRecvBlock()</a>, <a class="el" href="Domain_8h_source.html#l00256">DdMd::Domain::communicator()</a>, <a class="el" href="AtomStorage_8cpp_source.html#l00526">DdMd::AtomStorage::computeNAtomTotal()</a>, <a class="el" href="Buffer_8cpp_source.html#l00304">DdMd::Buffer::endRecvBlock()</a>, <a class="el" href="Domain_8h_source.html#l00303">DdMd::Domain::gridRank()</a>, <a class="el" href="Domain_8h_source.html#l00348">DdMd::Domain::isInitialized()</a>, <a class="el" href="AtomStorage_8cpp_source.html#l00149">DdMd::AtomStorage::newAtomPtr()</a>, <a class="el" href="Domain_8cpp_source.html#l00211">DdMd::Domain::ownerRank()</a>, <a class="el" href="ddMd_2chemistry_2Atom_8h_source.html#l00363">DdMd::Atom::position()</a>, <a class="el" href="Buffer_8cpp_source.html#l00395">DdMd::Buffer::recv()</a>, <a class="el" href="Buffer_8cpp_source.html#l00497">DdMd::Buffer::recvSize()</a>, <a class="el" href="ddMd_2chemistry_2Atom_8cpp_source.html#l00091">DdMd::Atom::unpackAtom()</a>, <a class="el" href="AtomStorage_8cpp_source.html#l00541">DdMd::AtomStorage::unsetNAtomTotal()</a>, and <a class="el" href="global_8h_source.html#l00051">UTIL_THROW</a>.</p>

<p>Referenced by <a class="el" href="SerializeConfigIo_8cpp_source.html#l00087">DdMd::SerializeConfigIo::loadConfig()</a>, <a class="el" href="ddMd_2configIos_2DdMdConfigIo_8cpp_source.html#l00090">DdMd::DdMdConfigIo::readConfig()</a>, <a class="el" href="DdMdOrderedConfigIo_8cpp_source.html#l00091">DdMd::DdMdOrderedConfigIo::readConfig()</a>, and <a class="el" href="ddMd_2configIos_2LammpsConfigIo_8cpp_source.html#l00109">DdMd::LammpsConfigIo::readConfig()</a>.</p>

</div>
</div>
<a class="anchor" id="a47a676ca8e326c5edeff5804b5b66b9b"></a><!-- doxytag: member="DdMd::AtomDistributor::validate" ref="a47a676ca8e326c5edeff5804b5b66b9b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classDdMd_1_1AtomDistributor.html#a47a676ca8e326c5edeff5804b5b66b9b">DdMd::AtomDistributor::validate</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Validate distribution of atoms after completion. </p>
<p>This method checks call <a class="el" href="classDdMd_1_1AtomStorage.html#a648f8dc58ab38a365bdd82d67180df00" title="Return true if the container is valid, or throw an Exception.">AtomStorage::isValid()</a>, checks that the total number of atoms on all processors is equal to nAtom, and checks that every atom is in the correct processor domain.</p>
<p>On the master processor </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>total number of atoms distributed on master, 0 on slaves. </dd></dl>

<p>Definition at line <a class="el" href="AtomDistributor_8cpp_source.html#l00475">475</a> of file <a class="el" href="AtomDistributor_8cpp_source.html">AtomDistributor.cpp</a>.</p>

<p>References <a class="el" href="AtomStorage_8cpp_source.html#l00449">DdMd::AtomStorage::begin()</a>, <a class="el" href="Domain_8h_source.html#l00256">DdMd::Domain::communicator()</a>, <a class="el" href="AtomStorage_8cpp_source.html#l00526">DdMd::AtomStorage::computeNAtomTotal()</a>, <a class="el" href="Dimension_8h_source.html#l00019">Util::Dimension</a>, <a class="el" href="Domain_8cpp_source.html#l00193">DdMd::Domain::domainBound()</a>, <a class="el" href="Domain_8h_source.html#l00312">DdMd::Domain::isMaster()</a>, <a class="el" href="AtomStorage_8cpp_source.html#l00609">DdMd::AtomStorage::isValid()</a>, <a class="el" href="AtomStorage_8h_source.html#l00583">DdMd::AtomStorage::nAtom()</a>, <a class="el" href="AtomStorage_8h_source.html#l00604">DdMd::AtomStorage::nAtomTotal()</a>, <a class="el" href="ConstPArrayIterator_8h_source.html#l00092">Util::ConstPArrayIterator&lt; Data &gt;::notEnd()</a>, and <a class="el" href="global_8h_source.html#l00051">UTIL_THROW</a>.</p>

<p>Referenced by <a class="el" href="SerializeConfigIo_8cpp_source.html#l00087">DdMd::SerializeConfigIo::loadConfig()</a>, <a class="el" href="ddMd_2configIos_2DdMdConfigIo_8cpp_source.html#l00090">DdMd::DdMdConfigIo::readConfig()</a>, <a class="el" href="DdMdOrderedConfigIo_8cpp_source.html#l00091">DdMd::DdMdOrderedConfigIo::readConfig()</a>, and <a class="el" href="ddMd_2configIos_2LammpsConfigIo_8cpp_source.html#l00109">DdMd::LammpsConfigIo::readConfig()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="AtomDistributor_8h_source.html">AtomDistributor.h</a></li>
<li><a class="el" href="AtomDistributor_8cpp_source.html">AtomDistributor.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.3-->
<!-- start footer part -->


<hr class="footer"/><address class="footer"><small>
Generated on Mon Nov 4 2013 19:47:48 for Simpatico by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
