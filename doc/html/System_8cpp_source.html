<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Simpatico: System.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Simpatico
   &#160;<span id="projectnumber">v1.10</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">System.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">* Simpatico - Simulation Package for Polymeric and Molecular Liquids</span>
<a name="l00003"></a>00003 <span class="comment">*</span>
<a name="l00004"></a>00004 <span class="comment">* Copyright 2010 - 2014, The Regents of the University of Minnesota</span>
<a name="l00005"></a>00005 <span class="comment">* Distributed under the terms of the GNU General Public License.</span>
<a name="l00006"></a>00006 <span class="comment">*/</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="comment">// namespace McMd</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;System.h&quot;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;Simulation.h&quot;</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;mcMd/species/Species.h&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;util/ensembles/EnergyEnsemble.h&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;util/ensembles/BoundaryEnsemble.h&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;mcMd/configIos/ConfigIo.h&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;mcMd/configIos/McConfigIo.h&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;mcMd/configIos/ConfigIoFactory.h&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;mcMd/trajectoryIos/TrajectoryIo.h&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;mcMd/trajectoryIos/TrajectoryIoFactory.h&gt;</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#ifndef INTER_NOPAIR</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span><span class="preprocessor">#include &lt;mcMd/potentials/pair/PairFactory.h&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#endif</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span><span class="preprocessor">#include &lt;mcMd/potentials/bond/BondFactory.h&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#ifdef INTER_ANGLE</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span><span class="preprocessor">#include &lt;mcMd/potentials/angle/AngleFactory.h&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#endif</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span><span class="preprocessor">#ifdef INTER_DIHEDRAL</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="preprocessor">#include &lt;mcMd/potentials/dihedral/DihedralFactory.h&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#endif</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span><span class="preprocessor">#ifdef INTER_EXTERNAL</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span><span class="preprocessor">#include &lt;mcMd/potentials/external/ExternalFactory.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#endif</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#ifdef MCMD_LINK</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor">#include &lt;mcMd/potentials/link/LinkFactory.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;mcMd/links/LinkMaster.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#endif</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#ifdef INTER_TETHER</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#include &lt;mcMd/potentials/tether/tetherFactory.h&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;mcMd/tethers/TetherMaster.h&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#endif</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span>
<a name="l00043"></a>00043 <span class="preprocessor">#ifdef MCMD_PERTURB</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">#include &lt;mcMd/perturb/Perturbation.h&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#ifdef UTIL_MPI</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span><span class="preprocessor">#include &lt;mcMd/perturb/ReplicaMove.h&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#endif // UTIL_MPI</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span><span class="preprocessor">#endif // MCMD_PERTURB</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span>
<a name="l00050"></a>00050 <span class="comment">// namespace Util</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;util/misc/FileMaster.h&gt;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &lt;util/param/Factory.h&gt;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &lt;util/archives/Serializable_includes.h&gt;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &lt;util/archives/serialize.h&gt;</span>
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="keyword">namespace </span>McMd
<a name="l00060"></a>00060 {
<a name="l00061"></a>00061 
<a name="l00062"></a>00062    <span class="keyword">using namespace </span>Util;
<a name="l00063"></a>00063 
<a name="l00064"></a>00064    <span class="comment">/*</span>
<a name="l00065"></a>00065 <span class="comment">   * Default constructor.</span>
<a name="l00066"></a>00066 <span class="comment">   */</span>
<a name="l00067"></a><a class="code" href="classMcMd_1_1System.html#a0ec997bb3fe2d96921d933fbc8129608">00067</a>    <a class="code" href="classMcMd_1_1System.html#a0ec997bb3fe2d96921d933fbc8129608" title="Default constructor.">System::System</a>()
<a name="l00068"></a>00068     : moleculeSetsPtr_(0),
<a name="l00069"></a>00069       boundaryPtr_(0),
<a name="l00070"></a>00070       #ifdef MCMD_LINK
<a name="l00071"></a>00071       linkMasterPtr_(0),
<a name="l00072"></a>00072       #endif
<a name="l00073"></a>00073       #ifdef INTER_TETHER
<a name="l00074"></a>00074       tetherMasterPtr_(0),
<a name="l00075"></a>00075       #endif
<a name="l00076"></a>00076       simulationPtr_(0),
<a name="l00077"></a>00077       energyEnsemblePtr_(0),
<a name="l00078"></a>00078       boundaryEnsemblePtr_(0),
<a name="l00079"></a>00079       #ifndef INTER_NOPAIR
<a name="l00080"></a>00080       pairFactoryPtr_(0),
<a name="l00081"></a>00081       #endif
<a name="l00082"></a>00082       bondFactoryPtr_(0),
<a name="l00083"></a>00083       #ifdef INTER_ANGLE
<a name="l00084"></a>00084       angleFactoryPtr_(0),
<a name="l00085"></a>00085       #endif
<a name="l00086"></a>00086       #ifdef INTER_DIHEDRAL
<a name="l00087"></a>00087       dihedralFactoryPtr_(0),
<a name="l00088"></a>00088       #endif
<a name="l00089"></a>00089       #ifdef INTER_EXTERNAL
<a name="l00090"></a>00090       externalFactoryPtr_(0),
<a name="l00091"></a>00091       #endif
<a name="l00092"></a>00092       #ifdef MCMD_LINK
<a name="l00093"></a>00093       linkFactoryPtr_(0),
<a name="l00094"></a>00094       #endif
<a name="l00095"></a>00095       #ifdef INTER_TETHER
<a name="l00096"></a>00096       tetherFactoryPtr_(0),
<a name="l00097"></a>00097       #endif
<a name="l00098"></a>00098       configIoPtr_(0),
<a name="l00099"></a>00099       configIoFactoryPtr_(0),
<a name="l00100"></a>00100       trajectoryIoFactoryPtr_(0),
<a name="l00101"></a>00101       fileMasterPtr_(0),
<a name="l00102"></a>00102       #ifdef MCMD_PERTURB
<a name="l00103"></a>00103       perturbationPtr_(0),
<a name="l00104"></a>00104       perturbationFactoryPtr_(0),
<a name="l00105"></a>00105       #ifdef UTIL_MPI
<a name="l00106"></a>00106       replicaMovePtr_(0),
<a name="l00107"></a>00107       hasReplicaMove_(false),
<a name="l00108"></a>00108       #endif <span class="comment">// UTIL_MPI</span>
<a name="l00109"></a>00109       #endif <span class="comment">// MCMD_PERTURB</span>
<a name="l00110"></a>00110       #ifndef INTER_NOPAIR
<a name="l00111"></a>00111       pairStyle_(),
<a name="l00112"></a>00112       #endif
<a name="l00113"></a>00113       bondStyle_(),
<a name="l00114"></a>00114       #ifdef INTER_ANGLE
<a name="l00115"></a>00115       angleStyle_(),
<a name="l00116"></a>00116       #endif
<a name="l00117"></a>00117       #ifdef INTER_DIHEDRAL
<a name="l00118"></a>00118       dihedralStyle_(),
<a name="l00119"></a>00119       #endif
<a name="l00120"></a>00120       #ifdef INTER_EXTERNAL
<a name="l00121"></a>00121       externalStyle_(),
<a name="l00122"></a>00122       #endif
<a name="l00123"></a>00123       #ifdef MCMD_LINK
<a name="l00124"></a>00124       linkStyle_(),
<a name="l00125"></a>00125       #endif
<a name="l00126"></a>00126       #ifdef INTER_TETHER
<a name="l00127"></a>00127       tetherStyle_(),
<a name="l00128"></a>00128       #endif
<a name="l00129"></a>00129       id_(0),
<a name="l00130"></a>00130       isCopy_(false),
<a name="l00131"></a>00131       createdFileMaster_(false)
<a name="l00132"></a>00132       #ifdef MCMD_PERTURB
<a name="l00133"></a>00133       , createdPerturbation_(false)
<a name="l00134"></a>00134       , createdPerturbationFactory_(false)
<a name="l00135"></a>00135       #ifdef UTIL_MPI
<a name="l00136"></a>00136       , createdReplicaMove_(false)
<a name="l00137"></a>00137       #endif <span class="comment">// UTIL_MPI</span>
<a name="l00138"></a>00138       #endif <span class="comment">// MCMD_PERTURB</span>
<a name="l00139"></a>00139    {
<a name="l00140"></a>00140       moleculeSetsPtr_ = <span class="keyword">new</span> <a class="code" href="classUtil_1_1DArray.html">DArray&lt;MoleculeSet&gt;</a>;
<a name="l00141"></a>00141       boundaryPtr_     = <span class="keyword">new</span> <a class="code" href="group__Boundary__Module.html#ga71421cd7b35b357699d30161edb9a53c" title="Boundary is an alias for the periodic boundary condition class.">Boundary</a>;
<a name="l00142"></a>00142       energyEnsemblePtr_   = <span class="keyword">new</span> <a class="code" href="classUtil_1_1EnergyEnsemble.html" title="A statistical ensemble for energy.">EnergyEnsemble</a>;
<a name="l00143"></a>00143       boundaryEnsemblePtr_ = <span class="keyword">new</span> <a class="code" href="classUtil_1_1BoundaryEnsemble.html" title="Statistical ensemble for changes in the periodic unit cell size.">BoundaryEnsemble</a>;
<a name="l00144"></a>00144    }
<a name="l00145"></a>00145 
<a name="l00146"></a>00146    <span class="comment">/*</span>
<a name="l00147"></a>00147 <span class="comment">   * Copy constructor.</span>
<a name="l00148"></a>00148 <span class="comment">   */</span>
<a name="l00149"></a><a class="code" href="classMcMd_1_1System.html#a8102ff0f3160f30246496df5e9a8b8fe">00149</a>    <a class="code" href="classMcMd_1_1System.html#a0ec997bb3fe2d96921d933fbc8129608" title="Default constructor.">System::System</a>(<span class="keyword">const</span> <a class="code" href="classMcMd_1_1System.html" title="A set of interacting Molecules enclosed by a Boundary.">System</a>&amp; other)
<a name="l00150"></a>00150     : <a class="code" href="classUtil_1_1ParamComposite.html" title="An object that can read multiple parameters from file.">ParamComposite</a>(other),
<a name="l00151"></a>00151       moleculeSetsPtr_(other.moleculeSetsPtr_),
<a name="l00152"></a>00152       boundaryPtr_(other.boundaryPtr_),
<a name="l00153"></a>00153       #ifdef MCMD_LINK
<a name="l00154"></a>00154       linkMasterPtr_(other.linkMasterPtr_),
<a name="l00155"></a>00155       #endif
<a name="l00156"></a>00156       #ifdef INTER_TETHER
<a name="l00157"></a>00157       tetherMasterPtr_(other.tetherMasterPtr_),
<a name="l00158"></a>00158       #endif
<a name="l00159"></a>00159       simulationPtr_(other.simulationPtr_),
<a name="l00160"></a>00160       energyEnsemblePtr_(other.energyEnsemblePtr_),
<a name="l00161"></a>00161       boundaryEnsemblePtr_(other.boundaryEnsemblePtr_),
<a name="l00162"></a>00162       #ifndef INTER_NOPAIR
<a name="l00163"></a>00163       pairFactoryPtr_(other.pairFactoryPtr_),
<a name="l00164"></a>00164       #endif
<a name="l00165"></a>00165       bondFactoryPtr_(other.bondFactoryPtr_),
<a name="l00166"></a>00166       #ifdef INTER_ANGLE
<a name="l00167"></a>00167       angleFactoryPtr_(other.angleFactoryPtr_),
<a name="l00168"></a>00168       #endif
<a name="l00169"></a>00169       #ifdef INTER_DIHEDRAL
<a name="l00170"></a>00170       dihedralFactoryPtr_(other.dihedralFactoryPtr_),
<a name="l00171"></a>00171       #endif
<a name="l00172"></a>00172       #ifdef INTER_EXTERNAL
<a name="l00173"></a>00173       externalFactoryPtr_(other.externalFactoryPtr_),
<a name="l00174"></a>00174       #endif
<a name="l00175"></a>00175       #ifdef MCMD_LINK
<a name="l00176"></a>00176       linkFactoryPtr_(other.linkFactoryPtr_),
<a name="l00177"></a>00177       #endif
<a name="l00178"></a>00178       #ifdef INTER_TETHER
<a name="l00179"></a>00179       tetherFactoryPtr_(other.tetherFactoryPtr_),
<a name="l00180"></a>00180       #endif
<a name="l00181"></a>00181       configIoPtr_(other.configIoPtr_),
<a name="l00182"></a>00182       configIoFactoryPtr_(other.configIoFactoryPtr_),
<a name="l00183"></a>00183       trajectoryIoFactoryPtr_(other.trajectoryIoFactoryPtr_),
<a name="l00184"></a>00184       fileMasterPtr_(other.fileMasterPtr_),
<a name="l00185"></a>00185       #ifdef MCMD_PERTURB
<a name="l00186"></a>00186       perturbationPtr_(other.perturbationPtr_),
<a name="l00187"></a>00187       perturbationFactoryPtr_(other.perturbationFactoryPtr_),
<a name="l00188"></a>00188       #ifdef UTIL_MPI
<a name="l00189"></a>00189       replicaMovePtr_(other.replicaMovePtr_),
<a name="l00190"></a>00190       hasReplicaMove_(other.hasReplicaMove_),
<a name="l00191"></a>00191       #endif <span class="comment">// ifdef UTIL_MPI</span>
<a name="l00192"></a>00192       #endif <span class="comment">// ifdef MCMD_PERTURB</span>
<a name="l00193"></a>00193       #ifndef INTER_NOPAIR
<a name="l00194"></a>00194       pairStyle_(other.pairStyle_),
<a name="l00195"></a>00195       #endif 
<a name="l00196"></a>00196       bondStyle_(other.bondStyle_),
<a name="l00197"></a>00197       #ifdef INTER_ANGLE
<a name="l00198"></a>00198       angleStyle_(other.angleStyle_),
<a name="l00199"></a>00199       #endif
<a name="l00200"></a>00200       #ifdef INTER_DIHEDRAL
<a name="l00201"></a>00201       dihedralStyle_(other.dihedralStyle_),
<a name="l00202"></a>00202       #endif
<a name="l00203"></a>00203       #ifdef INTER_EXTERNAL
<a name="l00204"></a>00204       externalStyle_(other.externalStyle_),
<a name="l00205"></a>00205       #endif
<a name="l00206"></a>00206       #ifdef MCMD_LINK
<a name="l00207"></a>00207       linkStyle_(other.linkStyle_),
<a name="l00208"></a>00208       #endif
<a name="l00209"></a>00209       #ifdef INTER_TETHER
<a name="l00210"></a>00210       tetherStyle_(other.tetherStyle_),
<a name="l00211"></a>00211       #endif
<a name="l00212"></a>00212       id_(other.id_),
<a name="l00213"></a>00213       isCopy_(true),
<a name="l00214"></a>00214       createdFileMaster_(false)
<a name="l00215"></a>00215       #ifdef MCMD_PERTURB
<a name="l00216"></a>00216       , createdPerturbation_(false)
<a name="l00217"></a>00217       , createdPerturbationFactory_(false)
<a name="l00218"></a>00218       #ifdef UTIL_MPI
<a name="l00219"></a>00219       , createdReplicaMove_(false)
<a name="l00220"></a>00220       #endif <span class="comment">// UTIL_MPI</span>
<a name="l00221"></a>00221       #endif <span class="comment">// MCMD_PERTURB</span>
<a name="l00222"></a>00222    {}
<a name="l00223"></a>00223 
<a name="l00224"></a>00224    <span class="comment">/*</span>
<a name="l00225"></a>00225 <span class="comment">   * Destructor.</span>
<a name="l00226"></a>00226 <span class="comment">   */</span>
<a name="l00227"></a><a class="code" href="classMcMd_1_1System.html#adcc2b453130064946874ea29940de439">00227</a>    <a class="code" href="classMcMd_1_1System.html#adcc2b453130064946874ea29940de439" title="Destructor.">System::~System</a>()
<a name="l00228"></a>00228    {
<a name="l00229"></a>00229       <span class="keywordflow">if</span> (!<a class="code" href="classMcMd_1_1System.html#a4c774921858ef5a9c09a2cf52c78c8b3" title="Was this System instantiated with the copy constructor?">isCopy</a>()) {
<a name="l00230"></a>00230          <span class="keywordflow">if</span> (moleculeSetsPtr_) {
<a name="l00231"></a>00231             <span class="keyword">delete</span> moleculeSetsPtr_;
<a name="l00232"></a>00232          }
<a name="l00233"></a>00233          <span class="keywordflow">if</span> (boundaryPtr_) {
<a name="l00234"></a>00234             <span class="keyword">delete</span> boundaryPtr_;
<a name="l00235"></a>00235          }
<a name="l00236"></a>00236 <span class="preprocessor">         #ifndef INTER_NOPAIR</span>
<a name="l00237"></a>00237 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (pairFactoryPtr_) {
<a name="l00238"></a>00238             <span class="keyword">delete</span> pairFactoryPtr_;
<a name="l00239"></a>00239          }
<a name="l00240"></a>00240 <span class="preprocessor">         #endif</span>
<a name="l00241"></a>00241 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (bondFactoryPtr_) {
<a name="l00242"></a>00242             <span class="keyword">delete</span> bondFactoryPtr_;
<a name="l00243"></a>00243          }
<a name="l00244"></a>00244 <span class="preprocessor">         #ifdef INTER_ANGLE</span>
<a name="l00245"></a>00245 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (angleFactoryPtr_) {
<a name="l00246"></a>00246             <span class="keyword">delete</span> angleFactoryPtr_;
<a name="l00247"></a>00247          }
<a name="l00248"></a>00248 <span class="preprocessor">         #endif</span>
<a name="l00249"></a>00249 <span class="preprocessor"></span><span class="preprocessor">         #ifdef INTER_DIHEDRAL</span>
<a name="l00250"></a>00250 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (dihedralFactoryPtr_) {
<a name="l00251"></a>00251             <span class="keyword">delete</span> dihedralFactoryPtr_;
<a name="l00252"></a>00252          }
<a name="l00253"></a>00253 <span class="preprocessor">         #endif</span>
<a name="l00254"></a>00254 <span class="preprocessor"></span><span class="preprocessor">         #ifdef INTER_EXTERNAL</span>
<a name="l00255"></a>00255 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (externalFactoryPtr_) {
<a name="l00256"></a>00256             <span class="keyword">delete</span> externalFactoryPtr_;
<a name="l00257"></a>00257          }
<a name="l00258"></a>00258 <span class="preprocessor">         #endif</span>
<a name="l00259"></a>00259 <span class="preprocessor"></span><span class="preprocessor">         #ifdef MCMD_LINK</span>
<a name="l00260"></a>00260 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (linkMasterPtr_) {
<a name="l00261"></a>00261             <span class="keyword">delete</span> linkMasterPtr_;
<a name="l00262"></a>00262          }
<a name="l00263"></a>00263 <span class="preprocessor">         #endif</span>
<a name="l00264"></a>00264 <span class="preprocessor"></span><span class="preprocessor">         #ifdef INTER_TETHER</span>
<a name="l00265"></a>00265 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (tetherMasterPtr_) {
<a name="l00266"></a>00266             <span class="keyword">delete</span> tetherMasterPtr_;
<a name="l00267"></a>00267          }
<a name="l00268"></a>00268          <span class="keywordflow">if</span> (tetherFactoryPtr_) {
<a name="l00269"></a>00269             <span class="keyword">delete</span> tetherFactoryPtr_;
<a name="l00270"></a>00270          }
<a name="l00271"></a>00271 <span class="preprocessor">         #endif</span>
<a name="l00272"></a>00272 <span class="preprocessor"></span>
<a name="l00273"></a>00273 <span class="preprocessor">         #ifdef MCMD_PERTURB</span>
<a name="l00274"></a>00274 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (perturbationPtr_ &amp;&amp; createdPerturbation_) {
<a name="l00275"></a>00275             <span class="keyword">delete</span> perturbationPtr_;
<a name="l00276"></a>00276          }
<a name="l00277"></a>00277          <span class="keywordflow">if</span> (perturbationFactoryPtr_ &amp;&amp; createdPerturbationFactory_) {
<a name="l00278"></a>00278             <span class="keyword">delete</span> perturbationFactoryPtr_;
<a name="l00279"></a>00279          }
<a name="l00280"></a>00280 <span class="preprocessor">         #ifdef UTIL_MPI</span>
<a name="l00281"></a>00281 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (replicaMovePtr_ &amp;&amp; createdReplicaMove_) {
<a name="l00282"></a>00282             <span class="keyword">delete</span> replicaMovePtr_;
<a name="l00283"></a>00283          }
<a name="l00284"></a>00284 <span class="preprocessor">         #endif // UTIL_MPI</span>
<a name="l00285"></a>00285 <span class="preprocessor"></span><span class="preprocessor">         #endif // MCMD_PERTURB</span>
<a name="l00286"></a>00286 <span class="preprocessor"></span>      
<a name="l00287"></a>00287          <span class="keywordflow">if</span> (energyEnsemblePtr_) {
<a name="l00288"></a>00288             <span class="keyword">delete</span> energyEnsemblePtr_;
<a name="l00289"></a>00289          }
<a name="l00290"></a>00290          <span class="keywordflow">if</span> (boundaryEnsemblePtr_) {
<a name="l00291"></a>00291             <span class="keyword">delete</span> boundaryEnsemblePtr_;
<a name="l00292"></a>00292          }
<a name="l00293"></a>00293          <span class="keywordflow">if</span> (configIoPtr_) {
<a name="l00294"></a>00294             <span class="keyword">delete</span> configIoPtr_;
<a name="l00295"></a>00295          }
<a name="l00296"></a>00296          <span class="keywordflow">if</span> (configIoFactoryPtr_) {
<a name="l00297"></a>00297             <span class="keyword">delete</span> configIoFactoryPtr_;
<a name="l00298"></a>00298          }
<a name="l00299"></a>00299          <span class="keywordflow">if</span> (trajectoryIoFactoryPtr_) {
<a name="l00300"></a>00300             <span class="keyword">delete</span> trajectoryIoFactoryPtr_;
<a name="l00301"></a>00301          }
<a name="l00302"></a>00302          <span class="keywordflow">if</span> (fileMasterPtr_ &amp;&amp; createdFileMaster_) {
<a name="l00303"></a>00303             <span class="keyword">delete</span> fileMasterPtr_;
<a name="l00304"></a>00304          }
<a name="l00305"></a>00305       }
<a name="l00306"></a>00306    }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308    <span class="comment">/*</span>
<a name="l00309"></a>00309 <span class="comment">   * Read parameters from file.</span>
<a name="l00310"></a>00310 <span class="comment">   */</span>
<a name="l00311"></a><a class="code" href="classMcMd_1_1System.html#a0e997e8fef481f695628e826242bdf78">00311</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a0e997e8fef481f695628e826242bdf78" title="Read parameter file.">System::readParameters</a>(std::istream &amp;in)
<a name="l00312"></a>00312    {
<a name="l00313"></a>00313 
<a name="l00314"></a>00314       <span class="comment">// Only read parameters if this is not a copy.</span>
<a name="l00315"></a>00315       <span class="keywordflow">if</span> (!<a class="code" href="classMcMd_1_1System.html#a4c774921858ef5a9c09a2cf52c78c8b3" title="Was this System instantiated with the copy constructor?">isCopy</a>()) {
<a name="l00316"></a>00316          <a class="code" href="classMcMd_1_1System.html#a9219c6451b47144c7bf0eb18383e443e" title="Allocate and initialize molecule sets for all species.">allocateMoleculeSets</a>();
<a name="l00317"></a>00317          <a class="code" href="classMcMd_1_1System.html#a90361ca70761e3d5ab17feca7276aa53" title="Read FileMaster parameters, if none yet exists.">readFileMaster</a>(in);
<a name="l00318"></a>00318          <a class="code" href="classMcMd_1_1System.html#a212525b8073fd6427cade45d6b1b88af" title="Read potential style parameter strings.">readPotentialStyles</a>(in);
<a name="l00319"></a>00319 <span class="preprocessor">         #ifdef MCMD_LINK</span>
<a name="l00320"></a>00320 <span class="preprocessor"></span>         <a class="code" href="classMcMd_1_1System.html#a9d5d81775f07969d42bc2c7d3d6a807a" title="Read the LinkMaster parameters.">readLinkMaster</a>(in);
<a name="l00321"></a>00321 <span class="preprocessor">         #endif</span>
<a name="l00322"></a>00322 <span class="preprocessor"></span><span class="preprocessor">         #ifdef INTER_TETHER</span>
<a name="l00323"></a>00323 <span class="preprocessor"></span>         readTetherMaster(in);
<a name="l00324"></a>00324 <span class="preprocessor">         #endif</span>
<a name="l00325"></a>00325 <span class="preprocessor"></span>         <a class="code" href="classMcMd_1_1System.html#a0485e882991974c6fa4d48dbd693074b" title="Read energy and boundary ensemble parameters.">readEnsembles</a>(in);
<a name="l00326"></a>00326       }
<a name="l00327"></a>00327 
<a name="l00328"></a>00328    }
<a name="l00329"></a>00329 
<a name="l00330"></a>00330    <span class="comment">/*</span>
<a name="l00331"></a>00331 <span class="comment">   * Load internal state from an archive.</span>
<a name="l00332"></a>00332 <span class="comment">   */</span>
<a name="l00333"></a><a class="code" href="classMcMd_1_1System.html#a183e65233d3ab1b40dc00e94c10f6810">00333</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a183e65233d3ab1b40dc00e94c10f6810" title="Load internal state from an archive.">System::loadParameters</a>(<a class="code" href="classUtil_1_1BinaryFileIArchive.html" title="Saving archive for binary istream.">Serializable::IArchive</a> &amp;ar)
<a name="l00334"></a>00334    {
<a name="l00335"></a>00335       <span class="keywordflow">if</span> (!<a class="code" href="classMcMd_1_1System.html#a4c774921858ef5a9c09a2cf52c78c8b3" title="Was this System instantiated with the copy constructor?">isCopy</a>()) {
<a name="l00336"></a>00336          <a class="code" href="classMcMd_1_1System.html#a9219c6451b47144c7bf0eb18383e443e" title="Allocate and initialize molecule sets for all species.">allocateMoleculeSets</a>();
<a name="l00337"></a>00337          <a class="code" href="classMcMd_1_1System.html#a4ad94fc2f28ff1223ca4ca2f8cbaa59c" title="Load FileMaster data from archive, if necessary.">loadFileMaster</a>(ar);
<a name="l00338"></a>00338          <a class="code" href="classMcMd_1_1System.html#abe60770795735d135d40acda99fe90df" title="Load potential style strings from an archive.">loadPotentialStyles</a>(ar);
<a name="l00339"></a>00339 <span class="preprocessor">         #ifdef MCMD_LINK</span>
<a name="l00340"></a>00340 <span class="preprocessor"></span>         <a class="code" href="classMcMd_1_1System.html#a44a8acc06d592f7fff187b3397a419ae" title="Load the LinkMaster.">loadLinkMaster</a>(ar);
<a name="l00341"></a>00341 <span class="preprocessor">         #endif</span>
<a name="l00342"></a>00342 <span class="preprocessor"></span><span class="preprocessor">         #ifdef INTER_TETHER</span>
<a name="l00343"></a>00343 <span class="preprocessor"></span>         loadTetherMaster(ar);
<a name="l00344"></a>00344 <span class="preprocessor">         #endif</span>
<a name="l00345"></a>00345 <span class="preprocessor"></span>         <a class="code" href="classMcMd_1_1System.html#a8d793a2ab317ebfea04ae86482ec8227" title="Load energy and boundary ensembles from archive.">loadEnsembles</a>(ar);
<a name="l00346"></a>00346       }
<a name="l00347"></a>00347    }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349    <span class="comment">/*</span>
<a name="l00350"></a>00350 <span class="comment">   * Load parameters to an archive.</span>
<a name="l00351"></a>00351 <span class="comment">   */</span>
<a name="l00352"></a><a class="code" href="classMcMd_1_1System.html#a17f9f162042b433de29cfd4094770855">00352</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a17f9f162042b433de29cfd4094770855" title="Save internal state from an archive.">System::saveParameters</a>(<a class="code" href="classUtil_1_1BinaryFileOArchive.html" title="Saving / output archive for binary ostream.">Serializable::OArchive</a> &amp;ar)
<a name="l00353"></a>00353    {
<a name="l00354"></a>00354       <span class="keywordflow">if</span> (!<a class="code" href="classMcMd_1_1System.html#a4c774921858ef5a9c09a2cf52c78c8b3" title="Was this System instantiated with the copy constructor?">isCopy</a>()) {
<a name="l00355"></a>00355          <a class="code" href="classMcMd_1_1System.html#aba255f45f3bb7fc19a99f7ed5f778fa7" title="If necessary, save FileMaster to archive.">saveFileMaster</a>(ar);
<a name="l00356"></a>00356          <a class="code" href="classMcMd_1_1System.html#ad6d5123678a23c87acb18aed568a5feb" title="Save potential style strings.">savePotentialStyles</a>(ar);
<a name="l00357"></a>00357 <span class="preprocessor">         #ifdef MCMD_LINK</span>
<a name="l00358"></a>00358 <span class="preprocessor"></span>         <a class="code" href="classMcMd_1_1System.html#a221038c42e0ed4a76d87328b45dd8302" title="Save the LinkMaster.">saveLinkMaster</a>(ar);
<a name="l00359"></a>00359 <span class="preprocessor">         #endif</span>
<a name="l00360"></a>00360 <span class="preprocessor"></span><span class="preprocessor">         #ifdef INTER_TETHER</span>
<a name="l00361"></a>00361 <span class="preprocessor"></span>         saveTetherMaster(ar);
<a name="l00362"></a>00362 <span class="preprocessor">         #endif</span>
<a name="l00363"></a>00363 <span class="preprocessor"></span>         <a class="code" href="classMcMd_1_1System.html#afaa643cf2ddc34bd6669f6f10e7c09b3" title="Save energy and boundary ensembles.">saveEnsembles</a>(ar);
<a name="l00364"></a>00364       }
<a name="l00365"></a>00365    }
<a name="l00366"></a>00366 
<a name="l00370"></a><a class="code" href="classMcMd_1_1System.html#a90361ca70761e3d5ab17feca7276aa53">00370</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a90361ca70761e3d5ab17feca7276aa53" title="Read FileMaster parameters, if none yet exists.">System::readFileMaster</a>(std::istream &amp;in)
<a name="l00371"></a>00371    {
<a name="l00372"></a>00372       <span class="comment">// Create and read FileMaster if necessary</span>
<a name="l00373"></a>00373       <span class="keywordflow">if</span> (!fileMasterPtr_) {
<a name="l00374"></a>00374          fileMasterPtr_ = <span class="keyword">new</span> <a class="code" href="classUtil_1_1FileMaster.html" title="A FileMaster manages input and output files for a simulation.">FileMaster</a>();
<a name="l00375"></a>00375          createdFileMaster_ = <span class="keyword">true</span>;
<a name="l00376"></a>00376          <a class="code" href="classUtil_1_1ParamComposite.html#ab2372dcc5d7d8db632b2b9844caf206e" title="Add and read a required child ParamComposite.">readParamComposite</a>(in, *fileMasterPtr_);
<a name="l00377"></a>00377       }
<a name="l00378"></a>00378    }
<a name="l00379"></a>00379 
<a name="l00380"></a>00380    <span class="comment">/*</span>
<a name="l00381"></a>00381 <span class="comment">   * If no FileMaster exists, create and load one. </span>
<a name="l00382"></a>00382 <span class="comment">   *</span>
<a name="l00383"></a>00383 <span class="comment">   * This is called by System::loadParameters(). Except during unit testing, </span>
<a name="l00384"></a>00384 <span class="comment">   * a FileMaster will normally already exist when this is called, either </span>
<a name="l00385"></a>00385 <span class="comment">   * because the FileMaster has been set to that of a paranet Simulation </span>
<a name="l00386"></a>00386 <span class="comment">   * by calling setFileMaster(), or because the System was constructed by </span>
<a name="l00387"></a>00387 <span class="comment">   * copying another, for HMC.</span>
<a name="l00388"></a>00388 <span class="comment">   */</span>
<a name="l00389"></a><a class="code" href="classMcMd_1_1System.html#a4ad94fc2f28ff1223ca4ca2f8cbaa59c">00389</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a4ad94fc2f28ff1223ca4ca2f8cbaa59c" title="Load FileMaster data from archive, if necessary.">System::loadFileMaster</a>(<a class="code" href="classUtil_1_1BinaryFileIArchive.html" title="Saving archive for binary istream.">Serializable::IArchive</a>&amp; ar)
<a name="l00390"></a>00390    {
<a name="l00391"></a>00391       <span class="keywordflow">if</span> (!fileMasterPtr_) {
<a name="l00392"></a>00392          fileMasterPtr_ = <span class="keyword">new</span> <a class="code" href="classUtil_1_1FileMaster.html" title="A FileMaster manages input and output files for a simulation.">FileMaster</a>();
<a name="l00393"></a>00393          createdFileMaster_ = <span class="keyword">true</span>;
<a name="l00394"></a>00394          <a class="code" href="classUtil_1_1ParamComposite.html#a5f0b72c058b5a9913cfc289a3d4586ed" title="Add and load a required child ParamComposite.">loadParamComposite</a>(ar, *fileMasterPtr_);
<a name="l00395"></a>00395       }
<a name="l00396"></a>00396    }
<a name="l00397"></a>00397 
<a name="l00398"></a>00398    <span class="comment">/*</span>
<a name="l00399"></a>00399 <span class="comment">   * If createdFileMaster_, save to archive.</span>
<a name="l00400"></a>00400 <span class="comment">   *</span>
<a name="l00401"></a>00401 <span class="comment">   * A System normally creates its own FileMaster only in unit tests.</span>
<a name="l00402"></a>00402 <span class="comment">   * In a simulation, the FileMaster is normally set to that of either</span>
<a name="l00403"></a>00403 <span class="comment">   * a parent Simulation or that of another System from which this was</span>
<a name="l00404"></a>00404 <span class="comment">   * copied.</span>
<a name="l00405"></a>00405 <span class="comment">   */</span>
<a name="l00406"></a><a class="code" href="classMcMd_1_1System.html#aba255f45f3bb7fc19a99f7ed5f778fa7">00406</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#aba255f45f3bb7fc19a99f7ed5f778fa7" title="If necessary, save FileMaster to archive.">System::saveFileMaster</a>(<a class="code" href="classUtil_1_1BinaryFileOArchive.html" title="Saving / output archive for binary ostream.">Serializable::OArchive</a>&amp; ar)
<a name="l00407"></a>00407    {
<a name="l00408"></a>00408       <span class="keywordflow">if</span> (createdFileMaster_) {
<a name="l00409"></a>00409          fileMasterPtr_-&gt;<a class="code" href="classUtil_1_1FileMaster.html#a242dce8b12bc4a5d8539308f2a702500" title="Save internal state to file.">save</a>(ar);
<a name="l00410"></a>00410       }
<a name="l00411"></a>00411    }
<a name="l00412"></a>00412 
<a name="l00413"></a>00413    <span class="comment">/*</span>
<a name="l00414"></a>00414 <span class="comment">   * Read potential style strings from parameter file.</span>
<a name="l00415"></a>00415 <span class="comment">   */</span>
<a name="l00416"></a><a class="code" href="classMcMd_1_1System.html#a212525b8073fd6427cade45d6b1b88af">00416</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a212525b8073fd6427cade45d6b1b88af" title="Read potential style parameter strings.">System::readPotentialStyles</a>(std::istream &amp;in)
<a name="l00417"></a>00417    {
<a name="l00418"></a>00418 <span class="preprocessor">      #ifndef INTER_NOPAIR</span>
<a name="l00419"></a>00419 <span class="preprocessor"></span>      read&lt;std::string&gt;(in, <span class="stringliteral">&quot;pairStyle&quot;</span>, pairStyle_);
<a name="l00420"></a>00420 <span class="preprocessor">      #endif</span>
<a name="l00421"></a>00421 <span class="preprocessor"></span>
<a name="l00422"></a>00422       <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#a0b5203494fb8b9fbd429909bec54c440" title="Get the number of bond types.">nBondType</a>() &gt; 0) {
<a name="l00423"></a>00423          read&lt;std::string&gt;(in, <span class="stringliteral">&quot;bondStyle&quot;</span>, bondStyle_);
<a name="l00424"></a>00424       }
<a name="l00425"></a>00425 
<a name="l00426"></a>00426 <span class="preprocessor">      #ifdef INTER_ANGLE</span>
<a name="l00427"></a>00427 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#afd10fd14bf9f99e39b0fbdb8babf4b7e" title="Get the number of angle types.">nAngleType</a>() &gt; 0) {
<a name="l00428"></a>00428          read&lt;std::string&gt;(in, <span class="stringliteral">&quot;angleStyle&quot;</span>, angleStyle_);
<a name="l00429"></a>00429       }
<a name="l00430"></a>00430 <span class="preprocessor">      #endif</span>
<a name="l00431"></a>00431 <span class="preprocessor"></span><span class="preprocessor">      #ifdef INTER_DIHEDRAL</span>
<a name="l00432"></a>00432 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#a91db70bd00bf448254fc0a34a9c3d40a" title="Get the number of dihedral types.">nDihedralType</a>() &gt; 0) {
<a name="l00433"></a>00433          read&lt;std::string&gt;(in, <span class="stringliteral">&quot;dihedralStyle&quot;</span>, dihedralStyle_);
<a name="l00434"></a>00434       }
<a name="l00435"></a>00435 <span class="preprocessor">      #endif</span>
<a name="l00436"></a>00436 <span class="preprocessor"></span><span class="preprocessor">      #ifdef INTER_EXTERNAL</span>
<a name="l00437"></a>00437 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#a84b380cfe058e530a597b1040b77611c" title="Does an external potential exist?">hasExternal</a>()) {
<a name="l00438"></a>00438          read&lt;std::string&gt;(in, <span class="stringliteral">&quot;externalStyle&quot;</span>, externalStyle_);
<a name="l00439"></a>00439       }
<a name="l00440"></a>00440 <span class="preprocessor">      #endif</span>
<a name="l00441"></a>00441 <span class="preprocessor"></span><span class="preprocessor">      #ifdef MCMD_LINK</span>
<a name="l00442"></a>00442 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#af044562a4427a42d14b27923528c6237" title="Get the number of link types.">nLinkType</a>() &gt; 0) {
<a name="l00443"></a>00443          read&lt;std::string&gt;(in, <span class="stringliteral">&quot;linkStyle&quot;</span>, linkStyle_);
<a name="l00444"></a>00444       }
<a name="l00445"></a>00445 <span class="preprocessor">      #endif</span>
<a name="l00446"></a>00446 <span class="preprocessor"></span><span class="preprocessor">      #ifdef INTER_TETHER</span>
<a name="l00447"></a>00447 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().hasTether()) {
<a name="l00448"></a>00448          read&lt;std::string&gt;(in, <span class="stringliteral">&quot;tetherStyle&quot;</span>, tetherStyle_);
<a name="l00449"></a>00449       }
<a name="l00450"></a>00450 <span class="preprocessor">      #endif</span>
<a name="l00451"></a>00451 <span class="preprocessor"></span>   }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453    <span class="comment">/*</span>
<a name="l00454"></a>00454 <span class="comment">   * Load potential style strings.</span>
<a name="l00455"></a>00455 <span class="comment">   */</span>
<a name="l00456"></a><a class="code" href="classMcMd_1_1System.html#abe60770795735d135d40acda99fe90df">00456</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#abe60770795735d135d40acda99fe90df" title="Load potential style strings from an archive.">System::loadPotentialStyles</a>(<a class="code" href="classUtil_1_1BinaryFileIArchive.html" title="Saving archive for binary istream.">Serializable::IArchive</a>&amp; ar)
<a name="l00457"></a>00457    {
<a name="l00458"></a>00458 <span class="preprocessor">      #ifndef INTER_NOPAIR</span>
<a name="l00459"></a>00459 <span class="preprocessor"></span>      loadParameter&lt;std::string&gt;(ar, <span class="stringliteral">&quot;pairStyle&quot;</span>, pairStyle_);
<a name="l00460"></a>00460 <span class="preprocessor">      #endif</span>
<a name="l00461"></a>00461 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#a0b5203494fb8b9fbd429909bec54c440" title="Get the number of bond types.">nBondType</a>() &gt; 0) {
<a name="l00462"></a>00462          loadParameter&lt;std::string&gt;(ar, <span class="stringliteral">&quot;bondStyle&quot;</span>, bondStyle_);
<a name="l00463"></a>00463       }
<a name="l00464"></a>00464 <span class="preprocessor">      #ifdef INTER_ANGLE</span>
<a name="l00465"></a>00465 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#afd10fd14bf9f99e39b0fbdb8babf4b7e" title="Get the number of angle types.">nAngleType</a>() &gt; 0) {
<a name="l00466"></a>00466          loadParameter&lt;std::string&gt;(ar, <span class="stringliteral">&quot;angleStyle&quot;</span>, angleStyle_);
<a name="l00467"></a>00467       }
<a name="l00468"></a>00468 <span class="preprocessor">      #endif</span>
<a name="l00469"></a>00469 <span class="preprocessor"></span><span class="preprocessor">      #ifdef INTER_DIHEDRAL</span>
<a name="l00470"></a>00470 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#a91db70bd00bf448254fc0a34a9c3d40a" title="Get the number of dihedral types.">nDihedralType</a>() &gt; 0) {
<a name="l00471"></a>00471          loadParameter&lt;std::string&gt;(ar, <span class="stringliteral">&quot;dihedralStyle&quot;</span>, dihedralStyle_);
<a name="l00472"></a>00472       }
<a name="l00473"></a>00473 <span class="preprocessor">      #endif</span>
<a name="l00474"></a>00474 <span class="preprocessor"></span><span class="preprocessor">      #ifdef INTER_EXTERNAL</span>
<a name="l00475"></a>00475 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#a84b380cfe058e530a597b1040b77611c" title="Does an external potential exist?">hasExternal</a>()) {
<a name="l00476"></a>00476          loadParameter&lt;std::string&gt;(ar, <span class="stringliteral">&quot;externalStyle&quot;</span>, externalStyle_);
<a name="l00477"></a>00477       }
<a name="l00478"></a>00478 <span class="preprocessor">      #endif</span>
<a name="l00479"></a>00479 <span class="preprocessor"></span><span class="preprocessor">      #ifdef MCMD_LINK</span>
<a name="l00480"></a>00480 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#af044562a4427a42d14b27923528c6237" title="Get the number of link types.">nLinkType</a>() &gt; 0) {
<a name="l00481"></a>00481          loadParameter&lt;std::string&gt;(ar, <span class="stringliteral">&quot;linkStyle&quot;</span>, linkStyle_);
<a name="l00482"></a>00482       }
<a name="l00483"></a>00483 <span class="preprocessor">      #endif</span>
<a name="l00484"></a>00484 <span class="preprocessor"></span><span class="preprocessor">      #ifdef INTER_TETHER</span>
<a name="l00485"></a>00485 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().hasTether()) {
<a name="l00486"></a>00486          loadParameter&lt;std::string&gt;(ar, <span class="stringliteral">&quot;tetherStyle&quot;</span>, tetherStyle_);
<a name="l00487"></a>00487       }
<a name="l00488"></a>00488 <span class="preprocessor">      #endif</span>
<a name="l00489"></a>00489 <span class="preprocessor"></span>   }
<a name="l00490"></a>00490 
<a name="l00491"></a>00491    <span class="comment">/*</span>
<a name="l00492"></a>00492 <span class="comment">   * Save potential style strings.</span>
<a name="l00493"></a>00493 <span class="comment">   */</span>
<a name="l00494"></a><a class="code" href="classMcMd_1_1System.html#ad6d5123678a23c87acb18aed568a5feb">00494</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#ad6d5123678a23c87acb18aed568a5feb" title="Save potential style strings.">System::savePotentialStyles</a>(<a class="code" href="classUtil_1_1BinaryFileOArchive.html" title="Saving / output archive for binary ostream.">Serializable::OArchive</a>&amp; ar)
<a name="l00495"></a>00495    {
<a name="l00496"></a>00496 <span class="preprocessor">      #ifndef INTER_NOPAIR</span>
<a name="l00497"></a>00497 <span class="preprocessor"></span>      ar &lt;&lt; pairStyle_;
<a name="l00498"></a>00498 <span class="preprocessor">      #endif</span>
<a name="l00499"></a>00499 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().nBondType() &gt; 0) {
<a name="l00500"></a>00500          ar &lt;&lt; bondStyle_;
<a name="l00501"></a>00501       }
<a name="l00502"></a>00502 <span class="preprocessor">      #ifdef INTER_ANGLE</span>
<a name="l00503"></a>00503 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().nAngleType() &gt; 0) {
<a name="l00504"></a>00504          ar &lt;&lt; angleStyle_;
<a name="l00505"></a>00505       }
<a name="l00506"></a>00506 <span class="preprocessor">      #endif</span>
<a name="l00507"></a>00507 <span class="preprocessor"></span><span class="preprocessor">      #ifdef INTER_DIHEDRAL</span>
<a name="l00508"></a>00508 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().nDihedralType() &gt; 0) {
<a name="l00509"></a>00509          ar &lt;&lt; dihedralStyle_;
<a name="l00510"></a>00510       }
<a name="l00511"></a>00511 <span class="preprocessor">      #endif</span>
<a name="l00512"></a>00512 <span class="preprocessor"></span><span class="preprocessor">      #ifdef INTER_EXTERNAL</span>
<a name="l00513"></a>00513 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().hasExternal()) {
<a name="l00514"></a>00514          ar &lt;&lt; externalStyle_;
<a name="l00515"></a>00515       }
<a name="l00516"></a>00516 <span class="preprocessor">      #endif</span>
<a name="l00517"></a>00517 <span class="preprocessor"></span><span class="preprocessor">      #ifdef MCMD_LINK</span>
<a name="l00518"></a>00518 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().nLinkType() &gt; 0) {
<a name="l00519"></a>00519          ar &lt;&lt; linkStyle_;
<a name="l00520"></a>00520       }
<a name="l00521"></a>00521 <span class="preprocessor">      #endif</span>
<a name="l00522"></a>00522 <span class="preprocessor"></span><span class="preprocessor">      #ifdef INTER_TETHER</span>
<a name="l00523"></a>00523 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().hasTether()) {
<a name="l00524"></a>00524          ar &lt;&lt; tetherStyle_;
<a name="l00525"></a>00525       }
<a name="l00526"></a>00526 <span class="preprocessor">      #endif</span>
<a name="l00527"></a>00527 <span class="preprocessor"></span>   }
<a name="l00528"></a>00528 
<a name="l00529"></a>00529    <span class="comment">/*</span>
<a name="l00530"></a>00530 <span class="comment">   * Create EnergyEnsemble and BoundaryEnsemble</span>
<a name="l00531"></a>00531 <span class="comment">   */</span>
<a name="l00532"></a><a class="code" href="classMcMd_1_1System.html#a0485e882991974c6fa4d48dbd693074b">00532</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a0485e882991974c6fa4d48dbd693074b" title="Read energy and boundary ensemble parameters.">System::readEnsembles</a>(std::istream &amp;in)
<a name="l00533"></a>00533    {
<a name="l00534"></a>00534       <a class="code" href="classUtil_1_1ParamComposite.html#ab2372dcc5d7d8db632b2b9844caf206e" title="Add and read a required child ParamComposite.">readParamComposite</a>(in, *energyEnsemblePtr_);
<a name="l00535"></a>00535       <a class="code" href="classUtil_1_1ParamComposite.html#ab2372dcc5d7d8db632b2b9844caf206e" title="Add and read a required child ParamComposite.">readParamComposite</a>(in, *boundaryEnsemblePtr_);
<a name="l00536"></a>00536    }
<a name="l00537"></a>00537 
<a name="l00538"></a>00538    <span class="comment">/*</span>
<a name="l00539"></a>00539 <span class="comment">   * Load EnergyEnsemble and BoundaryEnsemble.</span>
<a name="l00540"></a>00540 <span class="comment">   */</span>
<a name="l00541"></a><a class="code" href="classMcMd_1_1System.html#a8d793a2ab317ebfea04ae86482ec8227">00541</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a8d793a2ab317ebfea04ae86482ec8227" title="Load energy and boundary ensembles from archive.">System::loadEnsembles</a>(<a class="code" href="classUtil_1_1BinaryFileIArchive.html" title="Saving archive for binary istream.">Serializable::IArchive</a>&amp; ar)
<a name="l00542"></a>00542    {
<a name="l00543"></a>00543       <a class="code" href="classUtil_1_1ParamComposite.html#a5f0b72c058b5a9913cfc289a3d4586ed" title="Add and load a required child ParamComposite.">loadParamComposite</a>(ar, *energyEnsemblePtr_);
<a name="l00544"></a>00544       <a class="code" href="classUtil_1_1ParamComposite.html#a5f0b72c058b5a9913cfc289a3d4586ed" title="Add and load a required child ParamComposite.">loadParamComposite</a>(ar, *boundaryEnsemblePtr_);
<a name="l00545"></a>00545    }
<a name="l00546"></a>00546 
<a name="l00547"></a>00547    <span class="comment">/*</span>
<a name="l00548"></a>00548 <span class="comment">   * Save EnergyEnsemble and BoundaryEnsemble.</span>
<a name="l00549"></a>00549 <span class="comment">   */</span>
<a name="l00550"></a><a class="code" href="classMcMd_1_1System.html#afaa643cf2ddc34bd6669f6f10e7c09b3">00550</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#afaa643cf2ddc34bd6669f6f10e7c09b3" title="Save energy and boundary ensembles.">System::saveEnsembles</a>(<a class="code" href="classUtil_1_1BinaryFileOArchive.html" title="Saving / output archive for binary ostream.">Serializable::OArchive</a>&amp; ar)
<a name="l00551"></a>00551    {
<a name="l00552"></a>00552       energyEnsemblePtr_-&gt;<a class="code" href="classUtil_1_1EnergyEnsemble.html#a05adb7e0160a988acf01ecb573fc1ed6" title="Save internal state to an archive.">save</a>(ar);
<a name="l00553"></a>00553       boundaryEnsemblePtr_-&gt;<a class="code" href="classUtil_1_1BoundaryEnsemble.html#adec79b405dd98407c3a70ca57ef0e96a" title="Save internal state to an archive.">save</a>(ar);
<a name="l00554"></a>00554    }
<a name="l00555"></a>00555 
<a name="l00556"></a>00556 <span class="preprocessor">   #ifdef MCMD_LINK</span>
<a name="l00557"></a><a class="code" href="classMcMd_1_1System.html#a9d5d81775f07969d42bc2c7d3d6a807a">00557</a> <span class="preprocessor"></span>   <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a9d5d81775f07969d42bc2c7d3d6a807a" title="Read the LinkMaster parameters.">System::readLinkMaster</a>(std::istream&amp; in)
<a name="l00558"></a>00558    {
<a name="l00559"></a>00559       <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().nLinkType() &gt; 0) {
<a name="l00560"></a>00560          linkMasterPtr_ = <span class="keyword">new</span> <a class="code" href="classMcMd_1_1LinkMaster.html" title="Manages all Link objects in a System.">LinkMaster</a>();
<a name="l00561"></a>00561          <a class="code" href="classUtil_1_1ParamComposite.html#ab2372dcc5d7d8db632b2b9844caf206e" title="Add and read a required child ParamComposite.">readParamComposite</a>(in, *linkMasterPtr_);
<a name="l00562"></a>00562       }
<a name="l00563"></a>00563    }
<a name="l00564"></a>00564 
<a name="l00565"></a><a class="code" href="classMcMd_1_1System.html#a44a8acc06d592f7fff187b3397a419ae">00565</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a44a8acc06d592f7fff187b3397a419ae" title="Load the LinkMaster.">System::loadLinkMaster</a>(<a class="code" href="classUtil_1_1BinaryFileIArchive.html" title="Saving archive for binary istream.">Serializable::IArchive</a>&amp; ar)
<a name="l00566"></a>00566    {
<a name="l00567"></a>00567       <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().nLinkType() &gt; 0) {
<a name="l00568"></a>00568          linkMasterPtr_ = <span class="keyword">new</span> <a class="code" href="classMcMd_1_1LinkMaster.html" title="Manages all Link objects in a System.">LinkMaster</a>();
<a name="l00569"></a>00569          <a class="code" href="classUtil_1_1ParamComposite.html#a5f0b72c058b5a9913cfc289a3d4586ed" title="Add and load a required child ParamComposite.">loadParamComposite</a>(ar, *linkMasterPtr_);
<a name="l00570"></a>00570       }
<a name="l00571"></a>00571    }
<a name="l00572"></a>00572 
<a name="l00573"></a><a class="code" href="classMcMd_1_1System.html#a221038c42e0ed4a76d87328b45dd8302">00573</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a221038c42e0ed4a76d87328b45dd8302" title="Save the LinkMaster.">System::saveLinkMaster</a>(<a class="code" href="classUtil_1_1BinaryFileOArchive.html" title="Saving / output archive for binary ostream.">Serializable::OArchive</a>&amp; ar)
<a name="l00574"></a>00574    {
<a name="l00575"></a>00575       <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().nLinkType() &gt; 0) {
<a name="l00576"></a>00576          linkMasterPtr_-&gt;<a class="code" href="classUtil_1_1ParamComposite.html#a3c430a4e31a9573eadb06ab89d3bf780" title="Saves all parameters to an archive.">save</a>(ar);
<a name="l00577"></a>00577       }
<a name="l00578"></a>00578    }
<a name="l00579"></a>00579 <span class="preprocessor">   #endif </span>
<a name="l00580"></a>00580 <span class="preprocessor"></span>
<a name="l00581"></a>00581 <span class="preprocessor">   #ifdef INTER_TETHER</span>
<a name="l00582"></a>00582 <span class="preprocessor"></span>   <span class="keywordtype">void</span> System::readTetherMaster(std::istream &amp;in)
<a name="l00583"></a>00583    {
<a name="l00584"></a>00584       <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().hasTether()) {
<a name="l00585"></a>00585          tetherMasterPtr_ = <span class="keyword">new</span> TetherMaster();
<a name="l00586"></a>00586          <a class="code" href="classUtil_1_1ParamComposite.html#ab2372dcc5d7d8db632b2b9844caf206e" title="Add and read a required child ParamComposite.">readParamComposite</a>(in, *tetherMasterPtr_);
<a name="l00587"></a>00587       }
<a name="l00588"></a>00588    }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590    <span class="keywordtype">void</span> System::loadTetherMaster(<a class="code" href="classUtil_1_1BinaryFileIArchive.html" title="Saving archive for binary istream.">Serializable::IArchive</a> &amp;ar)
<a name="l00591"></a>00591    {
<a name="l00592"></a>00592       <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().hasTether()) {
<a name="l00593"></a>00593          tetherMasterPtr_ = <span class="keyword">new</span> TetherMaster();
<a name="l00594"></a>00594          <a class="code" href="classUtil_1_1ParamComposite.html#a5f0b72c058b5a9913cfc289a3d4586ed" title="Add and load a required child ParamComposite.">loadParamComposite</a>(ar, *tetherMasterPtr_);
<a name="l00595"></a>00595       }
<a name="l00596"></a>00596    }
<a name="l00597"></a>00597 
<a name="l00598"></a>00598    <span class="keywordtype">void</span> System::saveTetherMaster(<a class="code" href="classUtil_1_1BinaryFileOArchive.html" title="Saving / output archive for binary ostream.">Serializable::OArchive</a>&amp; ar)
<a name="l00599"></a>00599    {
<a name="l00600"></a>00600       <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().hasTether() &gt; 0) {
<a name="l00601"></a>00601          tetherMasterPtr_-&gt;save(ar);
<a name="l00602"></a>00602       }
<a name="l00603"></a>00603    }
<a name="l00604"></a>00604 <span class="preprocessor">   #endif </span>
<a name="l00605"></a>00605 <span class="preprocessor"></span>
<a name="l00606"></a>00606    <span class="comment">/*</span>
<a name="l00607"></a>00607 <span class="comment">   * Load configuration from an archive.</span>
<a name="l00608"></a>00608 <span class="comment">   */</span>
<a name="l00609"></a><a class="code" href="classMcMd_1_1System.html#a3b5c904a54721ab0fd35a8edd3f2d37c">00609</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a3b5c904a54721ab0fd35a8edd3f2d37c" title="Load configuration.">System::loadConfig</a>(<a class="code" href="classUtil_1_1BinaryFileIArchive.html" title="Saving archive for binary istream.">Serializable::IArchive</a> &amp;ar)
<a name="l00610"></a>00610    {
<a name="l00611"></a>00611       ar &gt;&gt; <a class="code" href="classMcMd_1_1System.html#ace1b2b95dc094767d218e1dcf520b5ca" title="Get the Boundary by reference.">boundary</a>();
<a name="l00612"></a>00612 
<a name="l00613"></a>00613       <a class="code" href="classMcMd_1_1Species.html" title="A Species represents a set of chemically similar molecules.">Species</a>* speciesPtr;
<a name="l00614"></a>00614       <span class="keywordtype">int</span> nSpecies = <a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#afa700c2440413cd98a8d47900c4bdc8d" title="Get the number of Species in this Simulation.">nSpecies</a>();
<a name="l00615"></a>00615       <a class="code" href="classMcMd_1_1Molecule.html" title="A physical molecule (a set of covalently bonded Atoms).">Molecule</a>* molPtr;
<a name="l00616"></a>00616       <a class="code" href="classUtil_1_1ArrayIterator.html" title="Forward iterator for an Array or a C array.">Molecule::AtomIterator</a> atomIter;
<a name="l00617"></a>00617       <span class="keywordtype">int</span> iSpeciesIn, nMoleculeIn;
<a name="l00618"></a>00618 
<a name="l00619"></a>00619       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iSpecies = 0; iSpecies &lt; nSpecies; ++iSpecies) {
<a name="l00620"></a>00620          speciesPtr = &amp;<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#a8d54e049a2fe0266fc26fbe9bc8441d5" title="Get a specific Species by reference.">species</a>(iSpecies);
<a name="l00621"></a>00621          ar &gt;&gt; iSpeciesIn;
<a name="l00622"></a>00622          <span class="keywordflow">if</span> (iSpeciesIn != iSpecies) {
<a name="l00623"></a>00623             <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Error: iSpeciesIn != iSpecies&quot;</span>);
<a name="l00624"></a>00624          }
<a name="l00625"></a>00625          ar &gt;&gt; nMoleculeIn;
<a name="l00626"></a>00626          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iMol = 0; iMol &lt; nMoleculeIn; ++iMol) {
<a name="l00627"></a>00627             molPtr = &amp;(speciesPtr-&gt;<a class="code" href="classMcMd_1_1Species.html#a00aaeb56269e3aefcc38f0bf4a788f62" title="Get the reservoir for this Species by reference.">reservoir</a>().<a class="code" href="classUtil_1_1ArrayStack.html#a0465b9e61f008e56b8e6a83c13c3598a" title="Pop an element off the stack.">pop</a>());
<a name="l00628"></a>00628             <a class="code" href="classMcMd_1_1System.html#a5311d7245d55b3efa0848ed040b053b3" title="Add a Molecule to this System.">addMolecule</a>(*molPtr);
<a name="l00629"></a>00629             <span class="keywordflow">if</span> (molPtr != &amp;<a class="code" href="classMcMd_1_1System.html#a5b439fee621a22ebf5e98ee540c2a92f" title="Get a specific Molecule in this System, by integer index.">molecule</a>(iSpecies, iMol)) {
<a name="l00630"></a>00630                <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Molecule index error&quot;</span>);
<a name="l00631"></a>00631             }
<a name="l00632"></a>00632             molPtr-&gt;<a class="code" href="classMcMd_1_1Molecule.html#aae40ce6fcc1df34548da1d9bd72b458c" title="Set an Molecule::AtomIterator to first Atom in this Molecule.">begin</a>(atomIter); 
<a name="l00633"></a>00633             <span class="keywordflow">for</span> ( ; atomIter.<a class="code" href="classUtil_1_1ArrayIterator.html#a7632e032938bf2cebe26c06d28cbc36c" title="Is the current pointer not at the end of the array?">notEnd</a>(); ++atomIter) {
<a name="l00634"></a>00634                ar &gt;&gt; atomIter-&gt;position();
<a name="l00635"></a>00635                ar &gt;&gt; atomIter-&gt;velocity();
<a name="l00636"></a>00636 <span class="preprocessor">               #ifdef MCMD_SHIFT</span>
<a name="l00637"></a>00637 <span class="preprocessor"></span>               ar &gt;&gt; atomIter-&gt;shift();
<a name="l00638"></a>00638                <a class="code" href="classMcMd_1_1System.html#ace1b2b95dc094767d218e1dcf520b5ca" title="Get the Boundary by reference.">boundary</a>().<a class="code" href="classUtil_1_1OrthorhombicBoundary.html#aca92298f4ac913d09c0845db21e55712" title="Shift Cartesian Vector r to its primary image.">shift</a>(atomIter-&gt;position(), atom.shift());
<a name="l00639"></a>00639 <span class="preprocessor">               #else</span>
<a name="l00640"></a>00640 <span class="preprocessor"></span>               <a class="code" href="classMcMd_1_1System.html#ace1b2b95dc094767d218e1dcf520b5ca" title="Get the Boundary by reference.">boundary</a>().<a class="code" href="classUtil_1_1OrthorhombicBoundary.html#aca92298f4ac913d09c0845db21e55712" title="Shift Cartesian Vector r to its primary image.">shift</a>(atomIter-&gt;position());
<a name="l00641"></a>00641 <span class="preprocessor">               #endif</span>
<a name="l00642"></a>00642 <span class="preprocessor"></span>            }
<a name="l00643"></a>00643          }
<a name="l00644"></a>00644       }
<a name="l00645"></a>00645    }
<a name="l00646"></a>00646 
<a name="l00647"></a>00647    <span class="comment">/*</span>
<a name="l00648"></a>00648 <span class="comment">   * Save configuration to an archive.</span>
<a name="l00649"></a>00649 <span class="comment">   */</span>
<a name="l00650"></a><a class="code" href="classMcMd_1_1System.html#ad37bf7f3fe103a492868193ce5c1b0a9">00650</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#ad37bf7f3fe103a492868193ce5c1b0a9" title="Save configuration.">System::saveConfig</a>(<a class="code" href="classUtil_1_1BinaryFileOArchive.html" title="Saving / output archive for binary ostream.">Serializable::OArchive</a>&amp; ar)
<a name="l00651"></a>00651    {
<a name="l00652"></a>00652       ar &lt;&lt; <a class="code" href="classMcMd_1_1System.html#ace1b2b95dc094767d218e1dcf520b5ca" title="Get the Boundary by reference.">boundary</a>();
<a name="l00653"></a>00653 
<a name="l00654"></a>00654       <span class="keywordtype">int</span> nSpecies = <a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#afa700c2440413cd98a8d47900c4bdc8d" title="Get the number of Species in this Simulation.">nSpecies</a>();
<a name="l00655"></a>00655       <a class="code" href="classUtil_1_1PArrayIterator.html" title="Forward iterator for a PArray.">System::MoleculeIterator</a> molIter;
<a name="l00656"></a>00656       <a class="code" href="classUtil_1_1ArrayIterator.html" title="Forward iterator for an Array or a C array.">Molecule::AtomIterator</a>   atomIter;
<a name="l00657"></a>00657       <span class="keywordtype">int</span> nMoleculeOut;
<a name="l00658"></a>00658 
<a name="l00659"></a>00659       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iSpecies = 0; iSpecies &lt; nSpecies; ++iSpecies) {
<a name="l00660"></a>00660          ar &lt;&lt; iSpecies;
<a name="l00661"></a>00661          nMoleculeOut = <a class="code" href="classMcMd_1_1System.html#a8784ff471540e53f5c1e40a55cabf6c6" title="Get the number of molecules of one Species in this System.">nMolecule</a>(iSpecies);
<a name="l00662"></a>00662          ar &lt;&lt; nMoleculeOut;
<a name="l00663"></a>00663          <a class="code" href="classMcMd_1_1System.html#adca6960d9c73e165193b039fdc205ac9" title="Initialize an iterator for molecules of one species in this System.">begin</a>(iSpecies, molIter); 
<a name="l00664"></a>00664          <span class="keywordflow">for</span> ( ; molIter.<a class="code" href="classUtil_1_1PArrayIterator.html#a9a108a1b20ef4c09353b96ad5b29cc4d" title="Is the current pointer not at the end of the PArray?">notEnd</a>(); ++molIter) {
<a name="l00665"></a>00665             molIter-&gt;begin(atomIter); 
<a name="l00666"></a>00666             <span class="keywordflow">for</span> ( ; atomIter.<a class="code" href="classUtil_1_1ArrayIterator.html#a7632e032938bf2cebe26c06d28cbc36c" title="Is the current pointer not at the end of the array?">notEnd</a>(); ++atomIter) {
<a name="l00667"></a>00667 <span class="preprocessor">               #ifdef MCMD_SHIFT</span>
<a name="l00668"></a>00668 <span class="preprocessor"></span>               <a class="code" href="classMcMd_1_1System.html#ace1b2b95dc094767d218e1dcf520b5ca" title="Get the Boundary by reference.">boundary</a>().<a class="code" href="classUtil_1_1OrthorhombicBoundary.html#aca92298f4ac913d09c0845db21e55712" title="Shift Cartesian Vector r to its primary image.">shift</a>(atomIter-&gt;position(), atomIter-&gt;shift());
<a name="l00669"></a>00669 <span class="preprocessor">               #else</span>
<a name="l00670"></a>00670 <span class="preprocessor"></span>               <a class="code" href="classMcMd_1_1System.html#ace1b2b95dc094767d218e1dcf520b5ca" title="Get the Boundary by reference.">boundary</a>().<a class="code" href="classUtil_1_1OrthorhombicBoundary.html#aca92298f4ac913d09c0845db21e55712" title="Shift Cartesian Vector r to its primary image.">shift</a>(atomIter-&gt;position());
<a name="l00671"></a>00671 <span class="preprocessor">               #endif</span>
<a name="l00672"></a>00672 <span class="preprocessor"></span>               ar &lt;&lt; atomIter-&gt;position();
<a name="l00673"></a>00673                ar &lt;&lt; atomIter-&gt;velocity();
<a name="l00674"></a>00674 <span class="preprocessor">               #ifdef MCMD_SHIFT</span>
<a name="l00675"></a>00675 <span class="preprocessor"></span>               ar &lt;&lt; atomIter-&gt;shift();
<a name="l00676"></a>00676 <span class="preprocessor">               #endif</span>
<a name="l00677"></a>00677 <span class="preprocessor"></span>            }
<a name="l00678"></a>00678          }
<a name="l00679"></a>00679       }
<a name="l00680"></a>00680    }
<a name="l00681"></a>00681 
<a name="l00682"></a>00682    <span class="comment">/*</span>
<a name="l00683"></a>00683 <span class="comment">   * Return a pointer to a new default ConfigIo.</span>
<a name="l00684"></a>00684 <span class="comment">   */</span>
<a name="l00685"></a><a class="code" href="classMcMd_1_1System.html#a9bb12b1c1c60d8b444900e03e8f3d8e0">00685</a>    <a class="code" href="classMcMd_1_1ConfigIo.html" title="System configuration file reader and writer.">ConfigIo</a>* <a class="code" href="classMcMd_1_1System.html#a9bb12b1c1c60d8b444900e03e8f3d8e0" title="Return a pointer to a new default ConfigIo.">System::newDefaultConfigIo</a>()
<a name="l00686"></a>00686    {  <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classMcMd_1_1McConfigIo.html" title="ConfigIo for MC simulations (no atom velocities).">McConfigIo</a>(*<span class="keyword">this</span>); }
<a name="l00687"></a>00687 
<a name="l00688"></a>00688    <span class="comment">/*</span>
<a name="l00689"></a>00689 <span class="comment">   * Read configuration from a specific input stream.</span>
<a name="l00690"></a>00690 <span class="comment">   */</span>
<a name="l00691"></a><a class="code" href="classMcMd_1_1System.html#a6a369e52ffa04b81f54e367a8a296a0f">00691</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a6a369e52ffa04b81f54e367a8a296a0f" title="Read system configuration from file.">System::readConfig</a>(std::istream &amp;in)
<a name="l00692"></a>00692    {
<a name="l00693"></a>00693       <span class="keywordflow">if</span> (!<a class="code" href="classMcMd_1_1System.html#a8845dbc0a53f5062a5d751c5fa2cab28" title="Is this an empty System (i.e., one with no molecules) ?">isEmpty</a>()) <a class="code" href="classMcMd_1_1System.html#a8efaa338ca09fc4d4f08fa1526601ea7" title="Remove all molecules from this System.">removeAllMolecules</a>();
<a name="l00694"></a>00694 
<a name="l00695"></a>00695       <span class="keywordflow">if</span> (configIoPtr_ == 0) {
<a name="l00696"></a>00696          configIoPtr_ = <a class="code" href="classMcMd_1_1System.html#a9bb12b1c1c60d8b444900e03e8f3d8e0" title="Return a pointer to a new default ConfigIo.">newDefaultConfigIo</a>();
<a name="l00697"></a>00697       }
<a name="l00698"></a>00698       configIoPtr_-&gt;<a class="code" href="classMcMd_1_1ConfigIo.html#ab9c732ce238078432a29fd6878068c23" title="Read configuration (particle positions) from file.">read</a>(in);
<a name="l00699"></a>00699 
<a name="l00700"></a>00700 <span class="preprocessor">      #ifdef UTIL_DEBUG</span>
<a name="l00701"></a>00701 <span class="preprocessor"></span>      <a class="code" href="classMcMd_1_1System.html#ac066e1e75e661009a1524f7996f1e07a" title="Return true if valid, or throw Exception.">isValid</a>();
<a name="l00702"></a>00702 <span class="preprocessor">      #endif</span>
<a name="l00703"></a>00703 <span class="preprocessor"></span>   }
<a name="l00704"></a>00704 
<a name="l00705"></a>00705    <span class="comment">/*</span>
<a name="l00706"></a>00706 <span class="comment">   * Write configuration to specified output stream.</span>
<a name="l00707"></a>00707 <span class="comment">   */</span>
<a name="l00708"></a><a class="code" href="classMcMd_1_1System.html#a84cad7f19715a1541e9a9f28b7fc0985">00708</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a84cad7f19715a1541e9a9f28b7fc0985" title="Write system configuration to a specified ostream.">System::writeConfig</a>(std::ostream &amp;out)
<a name="l00709"></a>00709    {
<a name="l00710"></a>00710       <span class="keywordflow">if</span> (configIoPtr_ == 0) {
<a name="l00711"></a>00711          configIoPtr_ = <a class="code" href="classMcMd_1_1System.html#a9bb12b1c1c60d8b444900e03e8f3d8e0" title="Return a pointer to a new default ConfigIo.">newDefaultConfigIo</a>();
<a name="l00712"></a>00712       }
<a name="l00713"></a>00713       configIoPtr_-&gt;<a class="code" href="classMcMd_1_1ConfigIo.html#ae785af21f8a28abd4c63c8e5f4655db9" title="Write configuration (particle positions) to file.">write</a>(out);
<a name="l00714"></a>00714    }
<a name="l00715"></a>00715 
<a name="l00716"></a>00716    <span class="comment">/*</span>
<a name="l00717"></a>00717 <span class="comment">   * Set System integer Id.</span>
<a name="l00718"></a>00718 <span class="comment">   *</span>
<a name="l00719"></a>00719 <span class="comment">   * Should be set immediately after the System is instantiated. If the System</span>
<a name="l00720"></a>00720 <span class="comment">   * is a member of the parent Simulation, setId() should be called in the</span>
<a name="l00721"></a>00721 <span class="comment">   * Simulation constructor.</span>
<a name="l00722"></a>00722 <span class="comment">   */</span>
<a name="l00723"></a><a class="code" href="classMcMd_1_1System.html#a40b56e722a2cb54c23c13bc6c8fe622c">00723</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a40b56e722a2cb54c23c13bc6c8fe622c" title="Set the integer Id for this System.">System::setId</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>)
<a name="l00724"></a>00724    {  id_ = <a class="code" href="classMcMd_1_1System.html#a0e99bfe76fe6541c42770cd094e5fde2" title="Get integer index for this System.">id</a>; }
<a name="l00725"></a>00725 
<a name="l00726"></a>00726    <span class="comment">/*</span>
<a name="l00727"></a>00727 <span class="comment">   * Set pointer to the parent Simulation.</span>
<a name="l00728"></a>00728 <span class="comment">   *</span>
<a name="l00729"></a>00729 <span class="comment">   * Should be set immediately after System instantiation. If this System</span>
<a name="l00730"></a>00730 <span class="comment">   * is a member of the parent Simulation, setSimulation(*this) should be</span>
<a name="l00731"></a>00731 <span class="comment">   * called in the Simulation constructor.</span>
<a name="l00732"></a>00732 <span class="comment">   */</span>
<a name="l00733"></a><a class="code" href="classMcMd_1_1System.html#affc36b5cf495f1f0be6257a14d766a8d">00733</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#affc36b5cf495f1f0be6257a14d766a8d" title="Set the parent Simulation.">System::setSimulation</a>(<a class="code" href="classMcMd_1_1Simulation.html" title="The main object in a simulation, which coordinates others.">Simulation</a> &amp;simulation)
<a name="l00734"></a>00734    {
<a name="l00735"></a>00735       assert(!simulationPtr_);
<a name="l00736"></a>00736       simulationPtr_ = &amp;<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>;
<a name="l00737"></a>00737    }
<a name="l00738"></a>00738 
<a name="l00739"></a>00739    <span class="comment">/*</span>
<a name="l00740"></a>00740 <span class="comment">   * Set pointer to a FileMaster.</span>
<a name="l00741"></a>00741 <span class="comment">   */</span>
<a name="l00742"></a><a class="code" href="classMcMd_1_1System.html#a111542ad2b44bc97c73fd52a6afc77ac">00742</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a111542ad2b44bc97c73fd52a6afc77ac" title="Set the FileMaster.">System::setFileMaster</a>(<a class="code" href="classUtil_1_1FileMaster.html" title="A FileMaster manages input and output files for a simulation.">FileMaster</a> &amp;fileMaster)
<a name="l00743"></a>00743    {
<a name="l00744"></a>00744       assert(!fileMasterPtr_);
<a name="l00745"></a>00745       fileMasterPtr_ = &amp;<a class="code" href="classMcMd_1_1System.html#ae958567eddcdfb523d7af85f5bdc5cfe" title="Get the associated FileMaster by reference.">fileMaster</a>;
<a name="l00746"></a>00746    }
<a name="l00747"></a>00747 
<a name="l00748"></a>00748    <span class="comment">// ConfigIoIo Management</span>
<a name="l00749"></a>00749 
<a name="l00750"></a>00750    <span class="comment">/*</span>
<a name="l00751"></a>00751 <span class="comment">   * Get the ConfigIo factory by reference.</span>
<a name="l00752"></a>00752 <span class="comment">   */</span>
<a name="l00753"></a><a class="code" href="classMcMd_1_1System.html#a422a12fcd4c7d9da8d377afc58c3dd37">00753</a>    <a class="code" href="classUtil_1_1Factory.html">Factory&lt;ConfigIo&gt;</a>&amp; <a class="code" href="classMcMd_1_1System.html#a422a12fcd4c7d9da8d377afc58c3dd37" title="Get the configuration file reader/writer factory by reference.">System::configIoFactory</a>()
<a name="l00754"></a>00754    {
<a name="l00755"></a>00755       <span class="keywordflow">if</span> (!configIoFactoryPtr_) {
<a name="l00756"></a>00756          configIoFactoryPtr_ = <a class="code" href="classMcMd_1_1System.html#a0b3deeb2f61c0acafb8b79003d9f2e6f" title="Return a pointer to a new default ConfigIoFactory.">newDefaultConfigIoFactory</a>();
<a name="l00757"></a>00757       }
<a name="l00758"></a>00758       <span class="keywordflow">return</span> *configIoFactoryPtr_;
<a name="l00759"></a>00759    }
<a name="l00760"></a>00760 
<a name="l00761"></a>00761    <span class="comment">/*</span>
<a name="l00762"></a>00762 <span class="comment">   * Return a pointer to a new ConfigIoFactory.</span>
<a name="l00763"></a>00763 <span class="comment">   */</span>
<a name="l00764"></a><a class="code" href="classMcMd_1_1System.html#a0b3deeb2f61c0acafb8b79003d9f2e6f">00764</a>    <a class="code" href="classUtil_1_1Factory.html">Factory&lt;ConfigIo&gt;</a>* <a class="code" href="classMcMd_1_1System.html#a0b3deeb2f61c0acafb8b79003d9f2e6f" title="Return a pointer to a new default ConfigIoFactory.">System::newDefaultConfigIoFactory</a>()
<a name="l00765"></a>00765    {  <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classMcMd_1_1ConfigIoFactory.html" title="Default Factory for subclasses of ConfigIo.">ConfigIoFactory</a>(*<span class="keyword">this</span>); }
<a name="l00766"></a>00766 
<a name="l00767"></a>00767    <span class="comment">/*</span>
<a name="l00768"></a>00768 <span class="comment">   * Set the ConfigIo, identified by subclass name.</span>
<a name="l00769"></a>00769 <span class="comment">   */</span>
<a name="l00770"></a><a class="code" href="classMcMd_1_1System.html#a979ab115eb3647b8e0ee15c7416c2410">00770</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a979ab115eb3647b8e0ee15c7416c2410" title="Create a new configuration file reader/writer.">System::setConfigIo</a>(std::string&amp; classname)
<a name="l00771"></a>00771    {
<a name="l00772"></a>00772       <span class="keywordflow">if</span> (!configIoFactoryPtr_) {
<a name="l00773"></a>00773          configIoFactoryPtr_ = <a class="code" href="classMcMd_1_1System.html#a0b3deeb2f61c0acafb8b79003d9f2e6f" title="Return a pointer to a new default ConfigIoFactory.">newDefaultConfigIoFactory</a>();
<a name="l00774"></a>00774       }
<a name="l00775"></a>00775       <a class="code" href="classMcMd_1_1ConfigIo.html" title="System configuration file reader and writer.">ConfigIo</a>* ptr = configIoFactoryPtr_-&gt;<a class="code" href="classUtil_1_1Factory.html#a75ae49003fb0b92da58e370ceae64153" title="Returns a pointer to a new instance of specified subclass.">factory</a>(classname);
<a name="l00776"></a>00776       <span class="keywordflow">if</span> (!ptr) {
<a name="l00777"></a>00777          <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Unrecognized ConfigIo subclass name&quot;</span>);
<a name="l00778"></a>00778       } 
<a name="l00779"></a>00779       <span class="keywordflow">if</span> (configIoPtr_) {
<a name="l00780"></a>00780          <span class="keyword">delete</span> configIoPtr_;
<a name="l00781"></a>00781       }
<a name="l00782"></a>00782       configIoPtr_ = ptr;
<a name="l00783"></a>00783    }
<a name="l00784"></a>00784 
<a name="l00785"></a>00785    <span class="comment">// TrajectoryIo Management</span>
<a name="l00786"></a>00786 
<a name="l00787"></a>00787    <span class="comment">/*</span>
<a name="l00788"></a>00788 <span class="comment">   * Get the TrajectoryIo factory by reference.</span>
<a name="l00789"></a>00789 <span class="comment">   */</span>
<a name="l00790"></a><a class="code" href="classMcMd_1_1System.html#a19e7cc56a740995d0b999129c2f67a8b">00790</a>    <a class="code" href="classUtil_1_1Factory.html">Factory&lt;TrajectoryIo&gt;</a>&amp; <a class="code" href="classMcMd_1_1System.html#a19e7cc56a740995d0b999129c2f67a8b" title="Get the trajectory reader/writer factory by reference.">System::trajectoryIoFactory</a>()
<a name="l00791"></a>00791    {
<a name="l00792"></a>00792       <span class="keywordflow">if</span> (!trajectoryIoFactoryPtr_) {
<a name="l00793"></a>00793          trajectoryIoFactoryPtr_ = <a class="code" href="classMcMd_1_1System.html#a75c36da3b2a3a699122fd09f7e7bd5c4" title="Return a pointer to a new default TrajectoryIoFactory.">newDefaultTrajectoryIoFactory</a>();
<a name="l00794"></a>00794       }
<a name="l00795"></a>00795       <span class="keywordflow">return</span> *trajectoryIoFactoryPtr_;
<a name="l00796"></a>00796    }
<a name="l00797"></a>00797 
<a name="l00798"></a>00798    <span class="comment">/*</span>
<a name="l00799"></a>00799 <span class="comment">   * Return pointer to a new instance of default TrajectoryIo factory.</span>
<a name="l00800"></a>00800 <span class="comment">   */</span>
<a name="l00801"></a><a class="code" href="classMcMd_1_1System.html#a75c36da3b2a3a699122fd09f7e7bd5c4">00801</a>    <a class="code" href="classUtil_1_1Factory.html">Factory&lt;TrajectoryIo&gt;</a>* <a class="code" href="classMcMd_1_1System.html#a75c36da3b2a3a699122fd09f7e7bd5c4" title="Return a pointer to a new default TrajectoryIoFactory.">System::newDefaultTrajectoryIoFactory</a>()
<a name="l00802"></a>00802    {  <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classMcMd_1_1TrajectoryIoFactory.html" title="Default Factory for subclasses of TrajectoryIo.">TrajectoryIoFactory</a>(*<span class="keyword">this</span>); }
<a name="l00803"></a>00803 
<a name="l00804"></a>00804 <span class="preprocessor">   #ifdef MCMD_PERTURB</span>
<a name="l00805"></a>00805 <span class="preprocessor"></span>   <span class="comment">/*</span>
<a name="l00806"></a>00806 <span class="comment">   * Set this system to expect a Perturbation in the param file.</span>
<a name="l00807"></a>00807 <span class="comment">   * Also creates the perturbation factory.</span>
<a name="l00808"></a>00808 <span class="comment">   */</span>
<a name="l00809"></a><a class="code" href="classMcMd_1_1System.html#a3297a687a95c2d0addef02ef808ccbb8">00809</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a3297a687a95c2d0addef02ef808ccbb8" title="Set to expect a Perturbation in the parameter file.">System::setExpectPerturbation</a>()
<a name="l00810"></a>00810    {
<a name="l00811"></a>00811       <span class="comment">// Precondition</span>
<a name="l00812"></a>00812       <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#af22a614beee67925bac89dfeb4f9a5e6" title="Does this system have an associated Perturbation?">hasPerturbation</a>()) {
<a name="l00813"></a>00813          <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;A Perturbation is already set&quot;</span>);
<a name="l00814"></a>00814       }
<a name="l00815"></a>00815 
<a name="l00816"></a>00816       <span class="comment">// Create perturbation factory</span>
<a name="l00817"></a>00817       perturbationFactoryPtr_ = <a class="code" href="classMcMd_1_1System.html#ad092598759ad0929721d82eccc1b14ad" title="Return a pointer to the default perturbation Factory.">newDefaultPerturbationFactory</a>();
<a name="l00818"></a>00818       createdPerturbationFactory_ = <span class="keyword">true</span>;
<a name="l00819"></a>00819 
<a name="l00820"></a>00820       expectPerturbationParam_ = <span class="keyword">true</span>;
<a name="l00821"></a>00821    }
<a name="l00822"></a>00822 
<a name="l00823"></a>00823    <span class="comment">/*</span>
<a name="l00824"></a>00824 <span class="comment">   * If a perturbation is expected, read the polymorphic perturbation block. </span>
<a name="l00825"></a>00825 <span class="comment">   *</span>
<a name="l00826"></a>00826 <span class="comment">   * This function reads the array of perturbation parameters, and then</span>
<a name="l00827"></a>00827 <span class="comment">   * modifies the appropriate system parameters accordingly. This function</span>
<a name="l00828"></a>00828 <span class="comment">   * is not called by System::readParameters, but should be called by the </span>
<a name="l00829"></a>00829 <span class="comment">   * readParameters function of subclasses (e.g., MdSystem and McSystem). It </span>
<a name="l00830"></a>00830 <span class="comment">   * should be called after all of the potentials, ensmebles, and other </span>
<a name="l00831"></a>00831 <span class="comment">   * physical parameters, which provide a set of baseline parameters that </span>
<a name="l00832"></a>00832 <span class="comment">   * this function can then modify.</span>
<a name="l00833"></a>00833 <span class="comment">   *</span>
<a name="l00834"></a>00834 <span class="comment">   * The parameter value used for this system is determined by the rank</span>
<a name="l00835"></a>00835 <span class="comment">   * of this System, which is a parameter of the Perturbation constructor.</span>
<a name="l00836"></a>00836 <span class="comment">   * The rank must thus be known to the perturbation factory that creates </span>
<a name="l00837"></a>00837 <span class="comment">   * an instance of a subclass of Perturbation. Subclasses of system must</span>
<a name="l00838"></a>00838 <span class="comment">   * re-implement the virtual System::newDefaultPerturbationFactory()</span>
<a name="l00839"></a>00839 <span class="comment">   * function to create an appropriate Factory object.</span>
<a name="l00840"></a>00840 <span class="comment">   */</span>
<a name="l00841"></a><a class="code" href="classMcMd_1_1System.html#a2a331854b6c75921d059ae7180cbb0d2">00841</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a2a331854b6c75921d059ae7180cbb0d2" title="Read the perturbation parameter block (if any)">System::readPerturbation</a>(std::istream&amp; in) 
<a name="l00842"></a>00842    {
<a name="l00843"></a>00843       <span class="keywordflow">if</span> (!<a class="code" href="classMcMd_1_1System.html#af22a614beee67925bac89dfeb4f9a5e6" title="Does this system have an associated Perturbation?">hasPerturbation</a>() &amp;&amp; expectPerturbationParam_) {
<a name="l00844"></a>00844          std::string <a class="code" href="classUtil_1_1ParamComposite.html#a91607e45fdcacc919a9fe66418dd05a4" title="Get class name string.">className</a>;
<a name="l00845"></a>00845          <span class="keywordtype">bool</span>        isEnd;
<a name="l00846"></a>00846          perturbationPtr_ = 
<a name="l00847"></a>00847             perturbationFactoryPtr_-&gt;<a class="code" href="classUtil_1_1Factory.html#aff55a134e6b770ca6f656417f4519fd5" title="Read a class name, instantiate an object, and read its parameters.">readObject</a>(in, *<span class="keyword">this</span>, className, isEnd);
<a name="l00848"></a>00848          <span class="keywordflow">if</span> (!perturbationPtr_) {
<a name="l00849"></a>00849             std::string msg = <span class="stringliteral">&quot;Unrecognized Perturbation subclass name &quot;</span>;
<a name="l00850"></a>00850             msg += <a class="code" href="classUtil_1_1ParamComposite.html#a91607e45fdcacc919a9fe66418dd05a4" title="Get class name string.">className</a>;
<a name="l00851"></a>00851             <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(msg.c_str());
<a name="l00852"></a>00852          }
<a name="l00853"></a>00853          createdPerturbation_ = <span class="keyword">true</span>;
<a name="l00854"></a>00854       }
<a name="l00855"></a>00855    }
<a name="l00856"></a>00856 
<a name="l00857"></a>00857    <span class="comment">/*</span>
<a name="l00858"></a>00858 <span class="comment">   * Load Perturbation, if any, or do nothing. </span>
<a name="l00859"></a>00859 <span class="comment">   */</span>
<a name="l00860"></a><a class="code" href="classMcMd_1_1System.html#a38f1d6ed2abc98f3ab906a5e3e9690a0">00860</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a38f1d6ed2abc98f3ab906a5e3e9690a0" title="Load the perturbation parameter block (if any)">System::loadPerturbation</a>(<a class="code" href="classUtil_1_1BinaryFileIArchive.html" title="Saving archive for binary istream.">Serializable::IArchive</a>&amp; ar) 
<a name="l00861"></a>00861    {
<a name="l00862"></a>00862       <span class="keywordflow">if</span> (<a class="code" href="classUtil_1_1MpiFileIo.html#ab49bdab5027444f73e8dc60e12057b3e" title="Does this object have an associated MPI communicator?">hasIoCommunicator</a>()) {
<a name="l00863"></a>00863          <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;System has ioCommunicator in loadPerturbation&quot;</span>);
<a name="l00864"></a>00864       }
<a name="l00865"></a>00865 
<a name="l00866"></a>00866       <span class="keywordtype">bool</span> savedPerturbation;
<a name="l00867"></a>00867       ar &gt;&gt; savedPerturbation;
<a name="l00868"></a>00868       <span class="keywordflow">if</span> (savedPerturbation) {
<a name="l00869"></a>00869          <a class="code" href="classMcMd_1_1System.html#a3297a687a95c2d0addef02ef808ccbb8" title="Set to expect a Perturbation in the parameter file.">setExpectPerturbation</a>();
<a name="l00870"></a>00870          std::string <a class="code" href="classUtil_1_1ParamComposite.html#a91607e45fdcacc919a9fe66418dd05a4" title="Get class name string.">className</a> = <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l00871"></a>00871          perturbationPtr_ = 
<a name="l00872"></a>00872             perturbationFactoryPtr_-&gt;<a class="code" href="classUtil_1_1Factory.html#ac1b7f10f4dc2adae114c4bcadb0b1b44" title="Load a class name, instantiate an object, and load the object.">loadObject</a>(ar, *<span class="keyword">this</span>, className);
<a name="l00873"></a>00873          <span class="keywordflow">if</span> (!perturbationPtr_) {
<a name="l00874"></a>00874             std::string msg = <span class="stringliteral">&quot;Unrecognized Perturbation subclass name &quot;</span>;
<a name="l00875"></a>00875             msg += <a class="code" href="classUtil_1_1ParamComposite.html#a91607e45fdcacc919a9fe66418dd05a4" title="Get class name string.">className</a>;
<a name="l00876"></a>00876             <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(msg.c_str());
<a name="l00877"></a>00877          }
<a name="l00878"></a>00878          createdPerturbation_ = <span class="keyword">true</span>;
<a name="l00879"></a>00879       }
<a name="l00880"></a>00880    }
<a name="l00881"></a>00881 
<a name="l00882"></a>00882    <span class="comment">/*</span>
<a name="l00883"></a>00883 <span class="comment">   * Save Perturbation, if any, or do nothing. </span>
<a name="l00884"></a>00884 <span class="comment">   */</span>
<a name="l00885"></a><a class="code" href="classMcMd_1_1System.html#ad2852a28145d4178d7262e70196d167f">00885</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#ad2852a28145d4178d7262e70196d167f" title="Save the perturbation parameter block (if any)">System::savePerturbation</a>(<a class="code" href="classUtil_1_1BinaryFileOArchive.html" title="Saving / output archive for binary ostream.">Serializable::OArchive</a>&amp; ar) 
<a name="l00886"></a>00886    {
<a name="l00887"></a>00887       <span class="keywordtype">bool</span> savingPerturbation = <a class="code" href="classMcMd_1_1System.html#af22a614beee67925bac89dfeb4f9a5e6" title="Does this system have an associated Perturbation?">hasPerturbation</a>();
<a name="l00888"></a>00888       ar &lt;&lt; savingPerturbation;  
<a name="l00889"></a>00889       <span class="keywordflow">if</span> (savingPerturbation) {
<a name="l00890"></a>00890          std::string <a class="code" href="classUtil_1_1ParamComposite.html#a91607e45fdcacc919a9fe66418dd05a4" title="Get class name string.">className</a> = perturbationPtr_-&gt;<a class="code" href="classUtil_1_1ParamComposite.html#a91607e45fdcacc919a9fe66418dd05a4" title="Get class name string.">className</a>();
<a name="l00891"></a>00891          ar &lt;&lt; <a class="code" href="classUtil_1_1ParamComposite.html#a91607e45fdcacc919a9fe66418dd05a4" title="Get class name string.">className</a>;
<a name="l00892"></a>00892          perturbationPtr_-&gt;<a class="code" href="classMcMd_1_1Perturbation.html#adf3506263fffbd5aee7f82369a749d34" title="Save internal state to an archive.">save</a>(ar);
<a name="l00893"></a>00893       }
<a name="l00894"></a>00894    }
<a name="l00895"></a>00895 
<a name="l00896"></a>00896 <span class="preprocessor">   #ifdef UTIL_MPI  </span>
<a name="l00897"></a>00897 <span class="preprocessor"></span>   <span class="comment">/*</span>
<a name="l00898"></a>00898 <span class="comment">   * Read ReplicaMove, if any, or do nothing. </span>
<a name="l00899"></a>00899 <span class="comment">   */</span>
<a name="l00900"></a><a class="code" href="classMcMd_1_1System.html#ae66d97012b9fa5b49067d65819b2b189">00900</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#ae66d97012b9fa5b49067d65819b2b189" title="Read the ReplicaMove parameter block (if any)">System::readReplicaMove</a>(std::istream&amp; in) 
<a name="l00901"></a>00901    {
<a name="l00902"></a>00902       <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#af22a614beee67925bac89dfeb4f9a5e6" title="Does this system have an associated Perturbation?">hasPerturbation</a>()) {
<a name="l00903"></a>00903           read&lt;bool&gt;(in, <span class="stringliteral">&quot;hasReplicaMove&quot;</span>, hasReplicaMove_);
<a name="l00904"></a>00904           <span class="keywordflow">if</span> (hasReplicaMove_) {
<a name="l00905"></a>00905              replicaMovePtr_ = <span class="keyword">new</span> <a class="code" href="classMcMd_1_1ReplicaMove.html" title="Replica exchange Monte Carlo move using Gibbs sampling.">ReplicaMove</a>(*<span class="keyword">this</span>);
<a name="l00906"></a>00906              <a class="code" href="classUtil_1_1ParamComposite.html#ab2372dcc5d7d8db632b2b9844caf206e" title="Add and read a required child ParamComposite.">readParamComposite</a>(in, *replicaMovePtr_);
<a name="l00907"></a>00907           }
<a name="l00908"></a>00908           createdReplicaMove_ = <span class="keyword">true</span>;
<a name="l00909"></a>00909       } <span class="keywordflow">else</span> {
<a name="l00910"></a>00910          hasReplicaMove_ = <span class="keyword">false</span>;
<a name="l00911"></a>00911       }
<a name="l00912"></a>00912    }
<a name="l00913"></a>00913 
<a name="l00914"></a>00914    <span class="comment">/*</span>
<a name="l00915"></a>00915 <span class="comment">   * Load ReplicaMove, if any, or do nothing. </span>
<a name="l00916"></a>00916 <span class="comment">   */</span>
<a name="l00917"></a><a class="code" href="classMcMd_1_1System.html#ad76202896e3aac2382fa5043729ba8a2">00917</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#ad76202896e3aac2382fa5043729ba8a2" title="Read the ReplicaMove parameter block (if any)">System::loadReplicaMove</a>(<a class="code" href="classUtil_1_1BinaryFileIArchive.html" title="Saving archive for binary istream.">Serializable::IArchive</a>&amp; ar) 
<a name="l00918"></a>00918    {
<a name="l00919"></a>00919       <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#af22a614beee67925bac89dfeb4f9a5e6" title="Does this system have an associated Perturbation?">hasPerturbation</a>()) {
<a name="l00920"></a>00920           loadParameter&lt;bool&gt;(ar, <span class="stringliteral">&quot;hasReplicaMove&quot;</span>, hasReplicaMove_);
<a name="l00921"></a>00921           <span class="keywordflow">if</span> (hasReplicaMove_) {
<a name="l00922"></a>00922              replicaMovePtr_ = <span class="keyword">new</span> <a class="code" href="classMcMd_1_1ReplicaMove.html" title="Replica exchange Monte Carlo move using Gibbs sampling.">ReplicaMove</a>(*<span class="keyword">this</span>);
<a name="l00923"></a>00923              <a class="code" href="classUtil_1_1ParamComposite.html#a5f0b72c058b5a9913cfc289a3d4586ed" title="Add and load a required child ParamComposite.">loadParamComposite</a>(ar, *replicaMovePtr_);
<a name="l00924"></a>00924           }
<a name="l00925"></a>00925           createdReplicaMove_ = <span class="keyword">true</span>;
<a name="l00926"></a>00926       } <span class="keywordflow">else</span> {
<a name="l00927"></a>00927          hasReplicaMove_ = <span class="keyword">false</span>;
<a name="l00928"></a>00928       }
<a name="l00929"></a>00929    }
<a name="l00930"></a>00930 
<a name="l00931"></a>00931    <span class="comment">/*</span>
<a name="l00932"></a>00932 <span class="comment">   * Save ReplicaMove, if any, or do nothing. </span>
<a name="l00933"></a>00933 <span class="comment">   */</span>
<a name="l00934"></a><a class="code" href="classMcMd_1_1System.html#abb00803f229a43eb793f65f669e25343">00934</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#abb00803f229a43eb793f65f669e25343" title="Save the ReplicaMove parameter block (if any)">System::saveReplicaMove</a>(<a class="code" href="classUtil_1_1BinaryFileOArchive.html" title="Saving / output archive for binary ostream.">Serializable::OArchive</a>&amp; ar) 
<a name="l00935"></a>00935    {
<a name="l00936"></a>00936       <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#af22a614beee67925bac89dfeb4f9a5e6" title="Does this system have an associated Perturbation?">hasPerturbation</a>()) {
<a name="l00937"></a>00937           ar &amp; hasReplicaMove_;
<a name="l00938"></a>00938           <span class="keywordflow">if</span> (hasReplicaMove_) {
<a name="l00939"></a>00939              replicaMovePtr_-&gt;<a class="code" href="classMcMd_1_1ReplicaMove.html#a35e7510f957c2f6c83199031af25227c" title="Save internal state to an archive.">save</a>(ar);
<a name="l00940"></a>00940           }
<a name="l00941"></a>00941       }
<a name="l00942"></a>00942    }
<a name="l00943"></a>00943 <span class="preprocessor">   #endif // UTIL_MPI</span>
<a name="l00944"></a>00944 <span class="preprocessor"></span><span class="preprocessor">   #endif // MCMD_PERTURB</span>
<a name="l00945"></a>00945 <span class="preprocessor"></span>
<a name="l00946"></a>00946    <span class="comment">/*</span>
<a name="l00947"></a>00947 <span class="comment">   * Allocate and initialize a MoleculeSet for each Species.</span>
<a name="l00948"></a>00948 <span class="comment">   */</span>
<a name="l00949"></a><a class="code" href="classMcMd_1_1System.html#a9219c6451b47144c7bf0eb18383e443e">00949</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a9219c6451b47144c7bf0eb18383e443e" title="Allocate and initialize molecule sets for all species.">System::allocateMoleculeSets</a>()
<a name="l00950"></a>00950    {
<a name="l00951"></a>00951       <span class="comment">// Preconditions</span>
<a name="l00952"></a>00952       assert(simulationPtr_);
<a name="l00953"></a>00953 
<a name="l00954"></a>00954       <span class="comment">// Allocate an array of nSpecies empty MoleculeSet objects.</span>
<a name="l00955"></a>00955       <span class="keywordtype">int</span> nSpecies = simulationPtr_-&gt;<a class="code" href="classMcMd_1_1Simulation.html#afa700c2440413cd98a8d47900c4bdc8d" title="Get the number of Species in this Simulation.">nSpecies</a>();
<a name="l00956"></a>00956       moleculeSetsPtr_-&gt;<a class="code" href="classUtil_1_1DArray.html#a1ffe3de1a78d48c67fc0186dbb0c6f36" title="Allocate the underlying C array.">allocate</a>(nSpecies);
<a name="l00957"></a>00957 
<a name="l00958"></a>00958       <span class="comment">// Allocate and initialize the MoleculeSet for each species.</span>
<a name="l00959"></a>00959       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; nSpecies; ++i) {
<a name="l00960"></a>00960          <a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#a93298520214ebd61b618dea40ff99916" title="Allocate and initialize a molecule set for one Species.">allocateMoleculeSet</a>((*moleculeSetsPtr_)[i], i);
<a name="l00961"></a>00961       }
<a name="l00962"></a>00962    }
<a name="l00963"></a>00963 
<a name="l00964"></a>00964    <span class="comment">/*</span>
<a name="l00965"></a>00965 <span class="comment">   * Add a molecule to this System.</span>
<a name="l00966"></a>00966 <span class="comment">   */</span>
<a name="l00967"></a><a class="code" href="classMcMd_1_1System.html#a5311d7245d55b3efa0848ed040b053b3">00967</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a5311d7245d55b3efa0848ed040b053b3" title="Add a Molecule to this System.">System::addMolecule</a>(<a class="code" href="classMcMd_1_1Molecule.html" title="A physical molecule (a set of covalently bonded Atoms).">Molecule</a>&amp; molecule)
<a name="l00968"></a>00968    {
<a name="l00969"></a>00969       assert(moleculeSetsPtr_);
<a name="l00970"></a>00970 
<a name="l00971"></a>00971       <span class="keywordtype">int</span> speciesId = molecule.<a class="code" href="classMcMd_1_1Molecule.html#a70de9b3e9ce956c9597c28f36303b40d" title="Get the molecular Species by reference.">species</a>().<a class="code" href="classMcMd_1_1Species.html#acae83456c3717805ab81869e47c58614" title="Get integer id of this Species.">id</a>();
<a name="l00972"></a>00972       <span class="keywordflow">if</span> ( speciesId &gt;= moleculeSetsPtr_-&gt;<a class="code" href="classUtil_1_1Array.html#a013a928470d09a8dd11937c1b28a3d38" title="Return allocated size.">capacity</a>()) {
<a name="l00973"></a>00973          <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Error: speciesId &gt;= moleculeSetsPtr_-&gt;capacity()&quot;</span>);
<a name="l00974"></a>00974       }
<a name="l00975"></a>00975       (*moleculeSetsPtr_)[speciesId].append(molecule);
<a name="l00976"></a>00976       molecule.<a class="code" href="classMcMd_1_1Molecule.html#ade4cf5ba67243d4539ea6e4ba07dbf60" title="Set the parent System.">setSystem</a>(*<span class="keyword">this</span>);
<a name="l00977"></a>00977 
<a name="l00978"></a>00978       <span class="comment">// notify observers</span>
<a name="l00979"></a>00979       notifyMoleculeSetObservers();
<a name="l00980"></a>00980    }
<a name="l00981"></a>00981 
<a name="l00982"></a>00982    <span class="comment">/*</span>
<a name="l00983"></a>00983 <span class="comment">   * Remove a molecule from this System.</span>
<a name="l00984"></a>00984 <span class="comment">   */</span>
<a name="l00985"></a><a class="code" href="classMcMd_1_1System.html#a0c056ff999227b23dc5a6e6998c4b29b">00985</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a0c056ff999227b23dc5a6e6998c4b29b" title="Remove a specific molecule from this System.">System::removeMolecule</a>(<a class="code" href="classMcMd_1_1Molecule.html" title="A physical molecule (a set of covalently bonded Atoms).">Molecule</a>&amp; molecule)
<a name="l00986"></a>00986    {
<a name="l00987"></a>00987       assert(moleculeSetsPtr_);
<a name="l00988"></a>00988 
<a name="l00989"></a>00989       <span class="keywordflow">if</span> ( &amp;molecule.<a class="code" href="classMcMd_1_1Molecule.html#a0422a218ee4fd2fc2bf7563ae3ec6fbb" title="Get the parent System.">system</a>() != <span class="keyword">this</span>) {
<a name="l00990"></a>00990          <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Attempt to remove Molecule that is not in this System.&quot;</span>);
<a name="l00991"></a>00991       }
<a name="l00992"></a>00992       <span class="keywordtype">int</span> speciesId = molecule.<a class="code" href="classMcMd_1_1Molecule.html#a70de9b3e9ce956c9597c28f36303b40d" title="Get the molecular Species by reference.">species</a>().<a class="code" href="classMcMd_1_1Species.html#acae83456c3717805ab81869e47c58614" title="Get integer id of this Species.">id</a>();
<a name="l00993"></a>00993       (*moleculeSetsPtr_)[speciesId].remove(molecule);
<a name="l00994"></a>00994       molecule.<a class="code" href="classMcMd_1_1Molecule.html#a0d4447530054e10e21472d4761067c40" title="Set the parent System pointer to null (no System).">unsetSystem</a>();
<a name="l00995"></a>00995 
<a name="l00996"></a>00996       <span class="comment">// notify observers</span>
<a name="l00997"></a>00997       notifyMoleculeSetObservers();
<a name="l00998"></a>00998    }
<a name="l00999"></a>00999 
<a name="l01000"></a>01000    <span class="comment">/*</span>
<a name="l01001"></a>01001 <span class="comment">   * Is this System empty (i.e., devoid of Molecules) ?</span>
<a name="l01002"></a>01002 <span class="comment">   */</span>
<a name="l01003"></a><a class="code" href="classMcMd_1_1System.html#a8845dbc0a53f5062a5d751c5fa2cab28">01003</a>    <span class="keywordtype">bool</span> <a class="code" href="classMcMd_1_1System.html#a8845dbc0a53f5062a5d751c5fa2cab28" title="Is this an empty System (i.e., one with no molecules) ?">System::isEmpty</a>()<span class="keyword"> const</span>
<a name="l01004"></a>01004 <span class="keyword">   </span>{
<a name="l01005"></a>01005       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#afa700c2440413cd98a8d47900c4bdc8d" title="Get the number of Species in this Simulation.">nSpecies</a>(); ++i) {
<a name="l01006"></a>01006          <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a8784ff471540e53f5c1e40a55cabf6c6" title="Get the number of molecules of one Species in this System.">nMolecule</a>(i) != 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01007"></a>01007       }
<a name="l01008"></a>01008       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01009"></a>01009    }
<a name="l01010"></a>01010 
<a name="l01011"></a>01011    <span class="comment">/*</span>
<a name="l01012"></a>01012 <span class="comment">   * Return all molecules of all Species to their reservoirs.</span>
<a name="l01013"></a>01013 <span class="comment">   *</span>
<a name="l01014"></a>01014 <span class="comment">   * Ifdef MCMD_LINK, also clears the LinkMaster.</span>
<a name="l01015"></a>01015 <span class="comment">   */</span>
<a name="l01016"></a><a class="code" href="classMcMd_1_1System.html#a8efaa338ca09fc4d4f08fa1526601ea7">01016</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1System.html#a8efaa338ca09fc4d4f08fa1526601ea7" title="Remove all molecules from this System.">System::removeAllMolecules</a>()
<a name="l01017"></a>01017    {
<a name="l01018"></a>01018       <a class="code" href="classMcMd_1_1Species.html" title="A Species represents a set of chemically similar molecules.">Species</a>*  speciesPtr;
<a name="l01019"></a>01019       <a class="code" href="classMcMd_1_1Molecule.html" title="A physical molecule (a set of covalently bonded Atoms).">Molecule</a>* molPtr;
<a name="l01020"></a>01020       <span class="keywordtype">int</span>       iSpecies, nMol;
<a name="l01021"></a>01021       <span class="keywordflow">for</span> (iSpecies = 0; iSpecies &lt; <a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#afa700c2440413cd98a8d47900c4bdc8d" title="Get the number of Species in this Simulation.">nSpecies</a>(); ++iSpecies) {
<a name="l01022"></a>01022          speciesPtr = &amp;<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#a8d54e049a2fe0266fc26fbe9bc8441d5" title="Get a specific Species by reference.">species</a>(iSpecies);
<a name="l01023"></a>01023          nMol  = <a class="code" href="classMcMd_1_1System.html#a8784ff471540e53f5c1e40a55cabf6c6" title="Get the number of molecules of one Species in this System.">nMolecule</a>(iSpecies);
<a name="l01024"></a>01024          <span class="keywordflow">while</span> (nMol &gt; 0) {
<a name="l01025"></a>01025             molPtr = &amp;<a class="code" href="classMcMd_1_1System.html#a5b439fee621a22ebf5e98ee540c2a92f" title="Get a specific Molecule in this System, by integer index.">molecule</a>(iSpecies, nMol - 1);
<a name="l01026"></a>01026             <a class="code" href="classMcMd_1_1System.html#a0c056ff999227b23dc5a6e6998c4b29b" title="Remove a specific molecule from this System.">removeMolecule</a>(*molPtr);
<a name="l01027"></a>01027             speciesPtr-&gt;<a class="code" href="classMcMd_1_1Species.html#a00aaeb56269e3aefcc38f0bf4a788f62" title="Get the reservoir for this Species by reference.">reservoir</a>().<a class="code" href="classUtil_1_1ArrayStack.html#a7d20f6c7d2f067ba8f74d120ec8ce4d5" title="Push an element onto the Stack.">push</a>(*molPtr);
<a name="l01028"></a>01028             nMol = <a class="code" href="classMcMd_1_1System.html#a8784ff471540e53f5c1e40a55cabf6c6" title="Get the number of molecules of one Species in this System.">nMolecule</a>(iSpecies);
<a name="l01029"></a>01029          }
<a name="l01030"></a>01030       }
<a name="l01031"></a>01031 
<a name="l01032"></a>01032 <span class="preprocessor">      #ifdef MCMD_LINK</span>
<a name="l01033"></a>01033 <span class="preprocessor"></span>      <a class="code" href="classMcMd_1_1System.html#a4bf43e98368d84f161518c595a5b9709" title="Get the LinkMaster by reference.">linkMaster</a>().<a class="code" href="classMcMd_1_1LinkMaster.html#ade75a16154327c183a7d258ae06e3885" title="Clear LinkMaster.">clear</a>();
<a name="l01034"></a>01034 <span class="preprocessor">      #endif</span>
<a name="l01035"></a>01035 <span class="preprocessor"></span>
<a name="l01036"></a>01036       <span class="comment">// notify observers</span>
<a name="l01037"></a>01037       notifyMoleculeSetObservers();
<a name="l01038"></a>01038    }
<a name="l01039"></a>01039 
<a name="l01040"></a>01040    <span class="comment">/*</span>
<a name="l01041"></a>01041 <span class="comment">   * Get the index of a molecule within its Species in this System.</span>
<a name="l01042"></a>01042 <span class="comment">   */</span>
<a name="l01043"></a><a class="code" href="classMcMd_1_1System.html#a4dec0edee931590acc04de732c4dce33">01043</a>    <span class="keywordtype">int</span> <a class="code" href="classMcMd_1_1System.html#a4dec0edee931590acc04de732c4dce33" title="Get the index of a Molecule within its Species in this System.">System::moleculeId</a>(<span class="keyword">const</span> <a class="code" href="classMcMd_1_1Molecule.html" title="A physical molecule (a set of covalently bonded Atoms).">Molecule</a>&amp; molecule)<span class="keyword"> const</span>
<a name="l01044"></a>01044 <span class="keyword">   </span>{
<a name="l01045"></a>01045       assert(moleculeSetsPtr_);
<a name="l01046"></a>01046 
<a name="l01047"></a>01047       <span class="keywordtype">int</span> speciesId = molecule.<a class="code" href="classMcMd_1_1Molecule.html#a70de9b3e9ce956c9597c28f36303b40d" title="Get the molecular Species by reference.">species</a>().<a class="code" href="classMcMd_1_1Species.html#acae83456c3717805ab81869e47c58614" title="Get integer id of this Species.">id</a>();
<a name="l01048"></a>01048       <span class="keywordflow">return</span> (*moleculeSetsPtr_)[speciesId].index(molecule);
<a name="l01049"></a>01049    }
<a name="l01050"></a>01050 
<a name="l01051"></a>01051    <span class="comment">/* </span>
<a name="l01052"></a>01052 <span class="comment">   * Get a randomly chosen molecule of a specified Species.</span>
<a name="l01053"></a>01053 <span class="comment">   */</span>
<a name="l01054"></a><a class="code" href="classMcMd_1_1System.html#a04b9247341002c8d40f2133ed9136468">01054</a>    <a class="code" href="classMcMd_1_1Molecule.html" title="A physical molecule (a set of covalently bonded Atoms).">Molecule</a>&amp; <a class="code" href="classMcMd_1_1System.html#a04b9247341002c8d40f2133ed9136468" title="Get a random Molecule of a specified species in this System.">System::randomMolecule</a>(<span class="keywordtype">int</span> speciesId)
<a name="l01055"></a>01055    {
<a name="l01056"></a>01056       <span class="keywordtype">int</span> nMol, <a class="code" href="classMcMd_1_1System.html#a4dec0edee931590acc04de732c4dce33" title="Get the index of a Molecule within its Species in this System.">moleculeId</a>;
<a name="l01057"></a>01057       nMol = <a class="code" href="classMcMd_1_1System.html#a8784ff471540e53f5c1e40a55cabf6c6" title="Get the number of molecules of one Species in this System.">nMolecule</a>(speciesId); 
<a name="l01058"></a>01058       <span class="keywordflow">if</span> (nMol &lt;= 0) {
<a name="l01059"></a>01059          <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot;Number of molecules in species &quot;</span> &lt;&lt; speciesId
<a name="l01060"></a>01060                      &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; nMol &lt;&lt; std::endl;
<a name="l01061"></a>01061          <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Number of molecules in species &lt;= 0&quot;</span>);
<a name="l01062"></a>01062       }
<a name="l01063"></a>01063       moleculeId = <a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#afe4a8354b0ecaf6daf94ea9b8343b26b" title="Get the random number generator by reference.">random</a>().<a class="code" href="classUtil_1_1Random.html#a2a7f4c20d13a3ea0bc532c224aecc40e" title="Return random long int x uniformly distributed in range1 &lt;= x &lt; range2.">uniformInt</a>(0, nMol);
<a name="l01064"></a>01064       <span class="keywordflow">return</span> <a class="code" href="classMcMd_1_1System.html#a5b439fee621a22ebf5e98ee540c2a92f" title="Get a specific Molecule in this System, by integer index.">molecule</a>(speciesId, moleculeId); 
<a name="l01065"></a>01065    }
<a name="l01066"></a>01066 
<a name="l01067"></a>01067    <span class="comment">/*</span>
<a name="l01068"></a>01068 <span class="comment">   * Return the total number of atoms in this System.</span>
<a name="l01069"></a>01069 <span class="comment">   */</span>
<a name="l01070"></a><a class="code" href="classMcMd_1_1System.html#ac0788d3fc9bef45bb17903acb32e99ba">01070</a>    <span class="keywordtype">int</span> <a class="code" href="classMcMd_1_1System.html#ac0788d3fc9bef45bb17903acb32e99ba" title="Return the total number of atoms in this System.">System::nAtom</a>()<span class="keyword"> const</span>
<a name="l01071"></a>01071 <span class="keyword">   </span>{
<a name="l01072"></a>01072       <span class="keywordtype">int</span> sum = 0;
<a name="l01073"></a>01073       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#afa700c2440413cd98a8d47900c4bdc8d" title="Get the number of Species in this Simulation.">nSpecies</a>(); ++i) {
<a name="l01074"></a>01074          sum += <a class="code" href="classMcMd_1_1System.html#a8784ff471540e53f5c1e40a55cabf6c6" title="Get the number of molecules of one Species in this System.">nMolecule</a>(i)*<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#a8d54e049a2fe0266fc26fbe9bc8441d5" title="Get a specific Species by reference.">species</a>(i).<a class="code" href="classMcMd_1_1Species.html#a6652a1ce632f1e033011eb0f5b453409" title="Get number of atoms per molecule for this Species.">nAtom</a>();
<a name="l01075"></a>01075       }
<a name="l01076"></a>01076       <span class="keywordflow">return</span> sum;
<a name="l01077"></a>01077    }
<a name="l01078"></a>01078 
<a name="l01079"></a>01079 <span class="preprocessor">   #ifndef INTER_NOPAIR</span>
<a name="l01080"></a>01080 <span class="preprocessor"></span>   <span class="comment">/*</span>
<a name="l01081"></a>01081 <span class="comment">   * Return the PairFactory by reference.</span>
<a name="l01082"></a>01082 <span class="comment">   */</span>
<a name="l01083"></a><a class="code" href="classMcMd_1_1System.html#a7f28c02097251e76853562ab4a97c7de">01083</a>    <a class="code" href="classMcMd_1_1PairFactory.html" title="Factory for subclasses MdPairPotential or McPairPotential.">PairFactory</a>&amp; <a class="code" href="classMcMd_1_1System.html#a7f28c02097251e76853562ab4a97c7de" title="Get the PairFactory by reference.">System::pairFactory</a>()
<a name="l01084"></a>01084    {
<a name="l01085"></a>01085       <span class="keywordflow">if</span> (!pairFactoryPtr_) {
<a name="l01086"></a>01086          pairFactoryPtr_ = <span class="keyword">new</span> <a class="code" href="classMcMd_1_1PairFactory.html" title="Factory for subclasses MdPairPotential or McPairPotential.">PairFactory</a>;
<a name="l01087"></a>01087       }
<a name="l01088"></a>01088       assert(pairFactoryPtr_);
<a name="l01089"></a>01089       <span class="keywordflow">return</span> *pairFactoryPtr_;
<a name="l01090"></a>01090    }
<a name="l01091"></a>01091 
<a name="l01092"></a>01092    <span class="comment">/*</span>
<a name="l01093"></a>01093 <span class="comment">   * Get the pair style string.</span>
<a name="l01094"></a>01094 <span class="comment">   */</span>
<a name="l01095"></a><a class="code" href="classMcMd_1_1System.html#a2897ec304dcacc034aaa843915831a3f">01095</a>    std::string <a class="code" href="classMcMd_1_1System.html#a2897ec304dcacc034aaa843915831a3f" title="Return nonbonded pair style string.">System::pairStyle</a>()<span class="keyword"> const</span>
<a name="l01096"></a>01096 <span class="keyword">   </span>{  <span class="keywordflow">return</span> pairStyle_;  }
<a name="l01097"></a>01097 <span class="preprocessor">   #endif</span>
<a name="l01098"></a>01098 <span class="preprocessor"></span>
<a name="l01099"></a>01099    <span class="comment">/*</span>
<a name="l01100"></a>01100 <span class="comment">   * Return the BondFactory by reference.</span>
<a name="l01101"></a>01101 <span class="comment">   */</span>
<a name="l01102"></a><a class="code" href="classMcMd_1_1System.html#a48d6b4068d96167cd4c519e56058160d">01102</a>    <a class="code" href="classUtil_1_1Factory.html">Factory&lt;BondPotential&gt;</a>&amp; <a class="code" href="classMcMd_1_1System.html#a48d6b4068d96167cd4c519e56058160d" title="Get the associated Factory&lt;BondPotential&gt; by reference.">System::bondFactory</a>()
<a name="l01103"></a>01103    {
<a name="l01104"></a>01104       <span class="keywordflow">if</span> (!bondFactoryPtr_) {
<a name="l01105"></a>01105          bondFactoryPtr_ = <span class="keyword">new</span> <a class="code" href="classMcMd_1_1BondFactory.html" title="Factory for BondPotential objects.">BondFactory</a>(*<span class="keyword">this</span>);
<a name="l01106"></a>01106       }
<a name="l01107"></a>01107       assert(bondFactoryPtr_);
<a name="l01108"></a>01108       <span class="keywordflow">return</span> *bondFactoryPtr_;
<a name="l01109"></a>01109    }
<a name="l01110"></a>01110 
<a name="l01111"></a>01111    <span class="comment">/*</span>
<a name="l01112"></a>01112 <span class="comment">   * Get the bond style string.</span>
<a name="l01113"></a>01113 <span class="comment">   */</span>
<a name="l01114"></a><a class="code" href="classMcMd_1_1System.html#a5d9584664c1224832a0d54d58dd702e4">01114</a>    std::string <a class="code" href="classMcMd_1_1System.html#a5d9584664c1224832a0d54d58dd702e4" title="Return covalent bond style string.">System::bondStyle</a>()<span class="keyword"> const</span>
<a name="l01115"></a>01115 <span class="keyword">   </span>{  <span class="keywordflow">return</span> bondStyle_;  }
<a name="l01116"></a>01116 
<a name="l01117"></a>01117 <span class="preprocessor">   #ifdef INTER_ANGLE</span>
<a name="l01118"></a>01118 <span class="preprocessor"></span>   <span class="comment">/*</span>
<a name="l01119"></a>01119 <span class="comment">   * Return the AngleFactory by reference.</span>
<a name="l01120"></a>01120 <span class="comment">   */</span>
<a name="l01121"></a><a class="code" href="classMcMd_1_1System.html#a3fd031b5779c3b48d73d768ed815ea53">01121</a>    <a class="code" href="classUtil_1_1Factory.html">Factory&lt;AnglePotential&gt;</a>&amp; <a class="code" href="classMcMd_1_1System.html#a3fd031b5779c3b48d73d768ed815ea53" title="Get the associated AngleFactory by reference.">System::angleFactory</a>()
<a name="l01122"></a>01122    {
<a name="l01123"></a>01123       <span class="keywordflow">if</span> (angleFactoryPtr_ == 0) {
<a name="l01124"></a>01124          angleFactoryPtr_ = <span class="keyword">new</span> <a class="code" href="classMcMd_1_1AngleFactory.html" title="Factory for subclasses of AnglePotential.">AngleFactory</a>(*<span class="keyword">this</span>);
<a name="l01125"></a>01125       }
<a name="l01126"></a>01126       assert(angleFactoryPtr_);
<a name="l01127"></a>01127       <span class="keywordflow">return</span> *angleFactoryPtr_;
<a name="l01128"></a>01128    }
<a name="l01129"></a>01129 
<a name="l01130"></a>01130    <span class="comment">/*</span>
<a name="l01131"></a>01131 <span class="comment">   * Get the angle style string.</span>
<a name="l01132"></a>01132 <span class="comment">   */</span>
<a name="l01133"></a><a class="code" href="classMcMd_1_1System.html#aadb9f9fd39556ad5423dce3f69ac24d5">01133</a>    std::string <a class="code" href="classMcMd_1_1System.html#aadb9f9fd39556ad5423dce3f69ac24d5" title="Return angle potential style string.">System::angleStyle</a>()<span class="keyword"> const</span>
<a name="l01134"></a>01134 <span class="keyword">   </span>{  <span class="keywordflow">return</span> angleStyle_;  }
<a name="l01135"></a>01135 <span class="preprocessor">   #endif</span>
<a name="l01136"></a>01136 <span class="preprocessor"></span>
<a name="l01137"></a>01137 <span class="preprocessor">   #ifdef INTER_DIHEDRAL</span>
<a name="l01138"></a>01138 <span class="preprocessor"></span>   <span class="comment">/*</span>
<a name="l01139"></a>01139 <span class="comment">   * Return the DihedralFactory by reference.</span>
<a name="l01140"></a>01140 <span class="comment">   */</span>
<a name="l01141"></a><a class="code" href="classMcMd_1_1System.html#af983d7ff0ceca8768ea01347b7af0304">01141</a>    <a class="code" href="classUtil_1_1Factory.html">Factory&lt;DihedralPotential&gt;</a>&amp; <a class="code" href="classMcMd_1_1System.html#af983d7ff0ceca8768ea01347b7af0304" title="Get the associated Dihedral Factory by reference.">System::dihedralFactory</a>()
<a name="l01142"></a>01142    {
<a name="l01143"></a>01143       <span class="keywordflow">if</span> (dihedralFactoryPtr_ == 0) {
<a name="l01144"></a>01144          dihedralFactoryPtr_ = <span class="keyword">new</span> <a class="code" href="classMcMd_1_1DihedralFactory.html" title="Factory for subclasses of DihedralPotential.">DihedralFactory</a>(*<span class="keyword">this</span>);
<a name="l01145"></a>01145       }
<a name="l01146"></a>01146       assert(dihedralFactoryPtr_);
<a name="l01147"></a>01147       <span class="keywordflow">return</span> *dihedralFactoryPtr_;
<a name="l01148"></a>01148    }
<a name="l01149"></a>01149 
<a name="l01150"></a>01150    <span class="comment">/*</span>
<a name="l01151"></a>01151 <span class="comment">   * Get the dihedral style string.</span>
<a name="l01152"></a>01152 <span class="comment">   */</span>
<a name="l01153"></a><a class="code" href="classMcMd_1_1System.html#ab087e28a5e3c04e97ed5b3fdbd4a7061">01153</a>    std::string <a class="code" href="classMcMd_1_1System.html#ab087e28a5e3c04e97ed5b3fdbd4a7061" title="Return dihedral potential style string.">System::dihedralStyle</a>()<span class="keyword"> const</span>
<a name="l01154"></a>01154 <span class="keyword">   </span>{  <span class="keywordflow">return</span> dihedralStyle_;  }
<a name="l01155"></a>01155 
<a name="l01156"></a>01156 <span class="preprocessor">   #endif</span>
<a name="l01157"></a>01157 <span class="preprocessor"></span>
<a name="l01158"></a>01158 <span class="preprocessor">   #ifdef INTER_EXTERNAL</span>
<a name="l01159"></a>01159 <span class="preprocessor"></span>   <span class="comment">/*</span>
<a name="l01160"></a>01160 <span class="comment">   * Return the ExternalFactory by reference.</span>
<a name="l01161"></a>01161 <span class="comment">   */</span>
<a name="l01162"></a><a class="code" href="classMcMd_1_1System.html#ad3beac0f5ba061c0b05fcfa208b0cf70">01162</a>    <a class="code" href="classUtil_1_1Factory.html">Factory&lt;ExternalPotential&gt;</a>&amp; <a class="code" href="classMcMd_1_1System.html#ad3beac0f5ba061c0b05fcfa208b0cf70" title="Get the associated ExternalPotential factory by reference.">System::externalFactory</a>()
<a name="l01163"></a>01163    {
<a name="l01164"></a>01164       <span class="keywordflow">if</span> (externalFactoryPtr_ == 0) {
<a name="l01165"></a>01165          externalFactoryPtr_ = <span class="keyword">new</span> <a class="code" href="classMcMd_1_1ExternalFactory.html" title="Factory for subclasses MdExternalPotential or McExternalPotential.">ExternalFactory</a>(*<span class="keyword">this</span>);
<a name="l01166"></a>01166       }
<a name="l01167"></a>01167       assert(externalFactoryPtr_);
<a name="l01168"></a>01168       <span class="keywordflow">return</span> *externalFactoryPtr_;
<a name="l01169"></a>01169    }
<a name="l01170"></a>01170 
<a name="l01171"></a>01171    <span class="comment">/*</span>
<a name="l01172"></a>01172 <span class="comment">   * Get the external style string.</span>
<a name="l01173"></a>01173 <span class="comment">   */</span>
<a name="l01174"></a><a class="code" href="classMcMd_1_1System.html#a8de5fdc62be2c60f81c321be87c05bc4">01174</a>    std::string <a class="code" href="classMcMd_1_1System.html#a8de5fdc62be2c60f81c321be87c05bc4" title="Return external potential style string.">System::externalStyle</a>()<span class="keyword"> const</span>
<a name="l01175"></a>01175 <span class="keyword">   </span>{  <span class="keywordflow">return</span> externalStyle_;  }
<a name="l01176"></a>01176 <span class="preprocessor">   #endif</span>
<a name="l01177"></a>01177 <span class="preprocessor"></span>
<a name="l01178"></a>01178 <span class="preprocessor">   #ifdef MCMD_LINK</span>
<a name="l01179"></a>01179 <span class="preprocessor"></span>   <span class="comment">/*</span>
<a name="l01180"></a>01180 <span class="comment">   * Return the Link factory by reference.</span>
<a name="l01181"></a>01181 <span class="comment">   */</span>
<a name="l01182"></a><a class="code" href="classMcMd_1_1System.html#aa9c0fb2c5e81be12ee756bc939d01ea5">01182</a>    <a class="code" href="classUtil_1_1Factory.html">Factory&lt;BondPotential&gt;</a>&amp; <a class="code" href="classMcMd_1_1System.html#aa9c0fb2c5e81be12ee756bc939d01ea5" title="Get the associated Link factory by reference.">System::linkFactory</a>()
<a name="l01183"></a>01183    {
<a name="l01184"></a>01184       <span class="keywordflow">if</span> (linkFactoryPtr_ == 0) {
<a name="l01185"></a>01185          linkFactoryPtr_ = <span class="keyword">new</span> <a class="code" href="classMcMd_1_1LinkFactory.html" title="Factory for subclasses of MdBondPotential or McBondPotential.">LinkFactory</a>(*<span class="keyword">this</span>);
<a name="l01186"></a>01186       }
<a name="l01187"></a>01187       assert(linkFactoryPtr_);
<a name="l01188"></a>01188       <span class="keywordflow">return</span> *linkFactoryPtr_;
<a name="l01189"></a>01189    }
<a name="l01190"></a>01190 
<a name="l01191"></a>01191    <span class="comment">/*</span>
<a name="l01192"></a>01192 <span class="comment">   * Get the link style string.</span>
<a name="l01193"></a>01193 <span class="comment">   */</span>
<a name="l01194"></a><a class="code" href="classMcMd_1_1System.html#ac9fb7f3a0fcf8de5853d5f9ae4c0b1c4">01194</a>    std::string <a class="code" href="classMcMd_1_1System.html#ac9fb7f3a0fcf8de5853d5f9ae4c0b1c4" title="Return link potential style string.">System::linkStyle</a>()<span class="keyword"> const</span>
<a name="l01195"></a>01195 <span class="keyword">   </span>{  <span class="keywordflow">return</span> linkStyle_;  }
<a name="l01196"></a>01196 <span class="preprocessor">   #endif</span>
<a name="l01197"></a>01197 <span class="preprocessor"></span>
<a name="l01198"></a>01198 <span class="preprocessor">   #ifdef INTER_TETHER</span>
<a name="l01199"></a>01199 <span class="preprocessor"></span>   <span class="comment">/*</span>
<a name="l01200"></a>01200 <span class="comment">   * Return the TetherFactory by reference.</span>
<a name="l01201"></a>01201 <span class="comment">   */</span>
<a name="l01202"></a>01202    TetherFactory&amp; System::tetherFactory()
<a name="l01203"></a>01203    {
<a name="l01204"></a>01204       <span class="keywordflow">if</span> (tetherFactoryPtr_ == 0) {
<a name="l01205"></a>01205          tetherFactoryPtr_ = <span class="keyword">new</span> TetherFactory;
<a name="l01206"></a>01206       }
<a name="l01207"></a>01207       assert(tetherFactoryPtr_);
<a name="l01208"></a>01208       <span class="keywordflow">return</span> *tetherFactoryPtr_;
<a name="l01209"></a>01209    }
<a name="l01210"></a>01210 
<a name="l01211"></a>01211    <span class="comment">/*</span>
<a name="l01212"></a>01212 <span class="comment">   * Get the tether style string.</span>
<a name="l01213"></a>01213 <span class="comment">   */</span>
<a name="l01214"></a>01214    std::string System::tetherStyle()<span class="keyword"> const</span>
<a name="l01215"></a>01215 <span class="keyword">   </span>{  <span class="keywordflow">return</span> tetherStyle_;  }
<a name="l01216"></a>01216 <span class="preprocessor">   #endif</span>
<a name="l01217"></a>01217 <span class="preprocessor"></span>
<a name="l01218"></a>01218    <span class="comment">/*</span>
<a name="l01219"></a>01219 <span class="comment">   * Check validity of all data structures.</span>
<a name="l01220"></a>01220 <span class="comment">   */</span>
<a name="l01221"></a><a class="code" href="classMcMd_1_1System.html#ac066e1e75e661009a1524f7996f1e07a">01221</a>    <span class="keywordtype">bool</span> <a class="code" href="classMcMd_1_1System.html#ac066e1e75e661009a1524f7996f1e07a" title="Return true if valid, or throw Exception.">System::isValid</a>()<span class="keyword"> const</span>
<a name="l01222"></a>01222 <span class="keyword">   </span>{
<a name="l01223"></a>01223       <a class="code" href="classMcMd_1_1Molecule.html" title="A physical molecule (a set of covalently bonded Atoms).">Molecule</a>* molPtr;
<a name="l01224"></a>01224       <span class="keywordtype">int</span>       iSpecies, iMolecule;
<a name="l01225"></a>01225       <span class="keywordflow">if</span> (!simulationPtr_) {
<a name="l01226"></a>01226          <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Null simulationPtr_&quot;</span>);
<a name="l01227"></a>01227       }
<a name="l01228"></a>01228       <span class="keywordflow">if</span> (!moleculeSetsPtr_) {
<a name="l01229"></a>01229          <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Null moleculeSetsPtr_&quot;</span>);
<a name="l01230"></a>01230       }
<a name="l01231"></a>01231       <span class="keywordflow">for</span> (iSpecies =0; iSpecies &lt; simulationPtr_-&gt;<a class="code" href="classMcMd_1_1Simulation.html#afa700c2440413cd98a8d47900c4bdc8d" title="Get the number of Species in this Simulation.">nSpecies</a>(); ++iSpecies) {
<a name="l01232"></a>01232          (*moleculeSetsPtr_)[iSpecies].isValid();
<a name="l01233"></a>01233          <span class="keywordflow">for</span> (iMolecule = 0; iMolecule &lt; <a class="code" href="classMcMd_1_1System.html#a8784ff471540e53f5c1e40a55cabf6c6" title="Get the number of molecules of one Species in this System.">nMolecule</a>(iSpecies); ++iMolecule) {
<a name="l01234"></a>01234             molPtr = &amp;(*moleculeSetsPtr_)[iSpecies][iMolecule]; 
<a name="l01235"></a>01235             <span class="keywordflow">if</span> (&amp;molPtr-&gt;<a class="code" href="classMcMd_1_1Molecule.html#a0422a218ee4fd2fc2bf7563ae3ec6fbb" title="Get the parent System.">system</a>() != <span class="keyword">this</span>) {
<a name="l01236"></a>01236                <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Error in pointer to System in a Molecule&quot;</span>);
<a name="l01237"></a>01237             }
<a name="l01238"></a>01238          }
<a name="l01239"></a>01239       }
<a name="l01240"></a>01240 
<a name="l01241"></a>01241 <span class="preprocessor">      #ifdef MCMD_LINK</span>
<a name="l01242"></a>01242 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().nLinkType() &gt; 0) {
<a name="l01243"></a>01243          <span class="keywordflow">if</span> (!linkMasterPtr_) {
<a name="l01244"></a>01244             <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Null linkMasterPtr_&quot;</span>);
<a name="l01245"></a>01245          }
<a name="l01246"></a>01246          linkMasterPtr_-&gt;<a class="code" href="classMcMd_1_1LinkMaster.html#a529c6e5ebeafa633106d39abeb7e8a84" title="Return true if this LinkMaster is valid, or throw an Exception.">isValid</a>();
<a name="l01247"></a>01247       }
<a name="l01248"></a>01248 <span class="preprocessor">      #endif</span>
<a name="l01249"></a>01249 <span class="preprocessor"></span>
<a name="l01250"></a>01250 <span class="preprocessor">      #ifdef INTER_TETHER</span>
<a name="l01251"></a>01251 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classMcMd_1_1System.html#a6f12a4fbf4b23914b14f1fabc34a03f0" title="Get the parent Simulation by reference.">simulation</a>().hasTether() &gt; 0) {
<a name="l01252"></a>01252          <span class="keywordflow">if</span> (!tetherMasterPtr_) {
<a name="l01253"></a>01253             <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Null tetherMasterPtr_&quot;</span>);
<a name="l01254"></a>01254          }
<a name="l01255"></a>01255          tetherMasterPtr_-&gt;isValid();
<a name="l01256"></a>01256       }
<a name="l01257"></a>01257 <span class="preprocessor">      #endif</span>
<a name="l01258"></a>01258 <span class="preprocessor"></span>
<a name="l01259"></a>01259       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01260"></a>01260    }
<a name="l01261"></a>01261 
<a name="l01262"></a>01262 }
</pre></div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.3-->
<!-- start footer part -->


<hr class="footer"/><address class="footer"><small>
Generated on Mon Dec 1 2014 21:48:01 for Simpatico by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
