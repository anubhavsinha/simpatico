<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Simpatico: Parallel Operation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Simpatico&#160;<span id="projectnumber">v0.8</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="index.html">Simpatico - Simulation Package for Polymer and Molecular Liquids</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Parallel Operation </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><p>The ddSim program is designed for use on multiple processors, using using MPI (Message Passing Interface) for interprocess communication. The mdSim and mcSim programs can also be compiled for operation on multiple processors. The multi-processor versions of mcSim and mdSim do not divide a single system among multiple processors, but simply allows a different system to be simulated on each processor. The multi-processor versions of mcSim and mdSim are useful primarily for replica exchange and free energy perturbation simulations, and as a way to submit multiple independent simulations as an MPI job.</p>
<h2><a class="anchor" id="Compiling"></a>
Compiling with MPI</h2>
<p>To compile a parallel MPI version of any of the programs, one must either choose one of the compiler blocks that enables MPI in the compiler.mk file, all of which have names that end in _mpi, or write such a block for a new compiler and/or MPI library. To enable the parts of the code that use MPI, this block must define a makefile variable UTIL_MPI=1. Defining this makefile variable causes the compiler to be passed a string "-DUTIL_MPI" that defines a preprocessor macro of the same name, UTIL_MPI, when compiling all source files. Defining the UTIL_MPI also cause a string "_m" to be included in a suffix that is added to the names of all of the static libraries and to the names of mcSim and mdSim executable files.</p>
<p>To compile versions of mcSim and mdSim that can carry out replica exchange and free energy perturbation calculations, one must also uncomment the line "MCMD_PERTURB=1" in the file mcMd/defines.mk, which is commented out by default. Defining the makefile variable MCMD_PERTURB causes a C++ preprocessor macro of the same name to be defined (via a string passed to the compiler), and causes a suffix "_f" (for "free energy perturbation") to be added to the name of the mcMd library and to the mcSim and mdSim executables.</p>
<p>When Simpatico is compiled with mpi and free energy perturbation enabled, but no other preprocessor macros defined, the default names of the resulting MC and MD executables are thus mcSim_m_f and mdSim_m_f.</p>
<h2><a class="anchor" id="File"></a>
Directory Structure Conventions</h2>
<p>Conventions for paths to input and ouput file names are different in the multiprocessor version of mcSim and mdSim (compiled with UTIL_MPI defined) from those used in the default single processor versions.</p>
<p>Each processor in MPI job involving np processors is assigned a integer "rank" in the range n = 0, ..., np-1. In the multiprocessor version of mcSim and mdSim, the input config file and all output files associated with a processor with rank "n" are put in a subdirectory named "n/", e.g., in a directory named "3/" for the processor with rank 3 in the MPI communicator. To do this, the <a class="el" href="classMcMd_1_1FileMaster.html" title="A FileMaster manages a set of input and output files.">FileMaster</a> class for processor 3 prepends the string "3/" to the paths for all of the input and and output configuration and data files used by that processor, with an analogous convention for other processors.</p>
<p>The treatment of parameter and command files in an MPI mcSim or mdSim job depends upon whether or not the executable is invoked with the "-p" command line, which enables free energy perturbation. This command line option is only valid if the executable was compiled with MCMD_PERTURB defined.</p>
<h2><a class="anchor" id="Independent"></a>
Independent Simulations</h2>
<p>Invoking a parallel version of mcSim or mdSim without the "-p" option runs a series of completely independent simulations on different processor, in which each simulation is controlled by a different parameter and command file. In this mode, it is not possible to read the parameter file from standard input, as done in the single-processor version, because that would not allow different processors to read different parameter files. By convention, the parameter file for processor n is instead read from the file "n/param". The command file is read from a file name obtained by adding "n/" as a prefix to the commandFileName given in this parameter file. The paths to input and ouput files are also obtained by adding a string "n/" before the inputPrefix or outputPrefix. Thus if the inputPrefix is set to "in/" and the outputPrefix is set to "out/" in the file "n/param", the command "WRITE_CONFIG config" for processor 3 will read the file "3/in/config", and all of the output files for processor 3 will be written to the directory "3/out".</p>
<p>For example, to run independent MC simulations on 3 processors, using an executable mcSim_m, one might thus enter </p>
<div class="fragment"><pre class="fragment">    mpirun -np 3 mSim_m 
</pre></div><p> from the root directory of a directory tree (i.e., the directory above the numbered subdirectories) with a structure </p>
<div class="fragment"><pre class="fragment">    0/
      param
      commands
      in/
        config
      out/
    1/
      param
      commands
      in/
        config
      out/
    2/ 
      param
      commands
      in/
        config
      out/
</pre></div><p> We have assumed here that the commandFileName pararameter is set to the string "commands" in each of the param files.</p>
<h2><a class="anchor" id="Pertubation"></a>
Perturbation Simulations</h2>
<p>Invoking the MC or MD executable with the "-p" option instead enables the definition of a free energy perturbation or replica exchange simulation In this mode, "replicas" on several processors are controlled by a single parameter file and a single command file, but different parameter values are assigned to different processors. This mode of operation is required for replica exchange and free energy perturbation simulations.</p>
<p>For example, to run a MC program in this mode on 3 processors, using an executable whose name includes the suffixes _m and _f to denote that it was compiled with MPI and MCMD_PERTURB defined, one might thus enter </p>
<div class="fragment"><pre class="fragment">    mpirun -np 2 mSim_m_p -p &lt; param
</pre></div><p> from the root directory of a directory tree with a structure </p>
<div class="fragment"><pre class="fragment">    param
    commands
    0/
      in/
        config
      out/
    1/
      in/
        config
      out/
    2/ 
      in/
        config
      out/
</pre></div><p> assuming that commandFileName=="commands" in the param file. Note that the parameter file is read from standard input in this case, like the single processor version, but unlike the parallel mode for independent simulations.</p>
<p>The use of free energy perturbation and replica exchange is discussed in more detail on the following page.</p>
<ul>
<li>
<a class="el" href="restart_page.html">Restarting</a> (Prev)  </li>
<li>
<a class="el" href="guide_page.html">User Guide</a> (Up)  </li>
<li>
<a class="el" href="perturb_page.html">Free Energy Perturbation</a> (Next)  </li>
</ul>
</div></div>
<hr class="footer"/><address class="footer"><small>Generated on Sun Jun 17 2012 08:44:50 for Simpatico by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
