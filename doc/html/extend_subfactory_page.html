<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3"/>
<title>Simpatico: 4.5 Sub-Factories</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Simpatico
   &#160;<span id="projectnumber">v1.05</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Simpatico - Simulation Package for Polymer and Molecular Liquids</a></li><li class="navelem"><a class="el" href="extend_page.html">4 Extending Simpatico</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">4.5 Sub-Factories </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="extend_potential_page.html">4.4 Potential Energy Classes</a> (Prev) &#160; &#160; &#160; &#160; <a class="el" href="extend_module_page.html">4.6 Modules</a> (Next) <br/>
</p>
<p>A Factory may contain one or more subfactories. Creating a subfactories is an alternative way of adding new classes to the set that can be recognized by a Factory, without modifying the Factory implementation. The main use of subfactories is in the construction of <a class="el" href="extend_module_page.html">modules</a>, which are classes that encapsulate a set of related classes that are needed for an application area.</p>
<p>Every subfactory of a Factory&lt;Base&gt; object is another Factory&lt;Base&gt; object. A factory and its subfactories (if any) form a tree that is searched in a depth first manner: The factory() method of the parent calls the factory method of each subfactory in a attempt to match a class name, before attempting to match it against its own explicit list of names.</p>
<p>A subfactory may be added to a parent factory by calling the <a class="el" href="classUtil_1_1Factory.html#acc4e596c0a8636a5553ada58dfe898ce" title="Add a new subfactory to the list.">Factory&lt;Base&gt;::addSubfactory()</a> method of the Factory class template. This has a signature: </p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> Base&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classUtil_1_1Factory.html#acc4e596c0a8636a5553ada58dfe898ce" title="Add a new subfactory to the list.">Factory&lt;Base&gt;::addSubfactory</a>(Factory&lt;Base&gt;&amp; subfactory);</div>
</div><!-- fragment --><p> Any number of subfactories can be added to a parent factory class.</p>
<p>A recursive, depth-first search of subfactories is implemented by the trySubfactories() method. This has a signature: </p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> Base&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classUtil_1_1Factory.html#a0ed7025e8764a29d33ab446c25ae4554" title="Search through subfactories for match.">Factory&lt;Base&gt;::trySubfactories</a>(std::string&amp; classname);</div>
</div><!-- fragment --><p> The value of the "classname" parameter is the name of a subclass of Base. This method should be called by the factory() method of every factory class. It calls the factory() method of every subfactory that has been added to that factory, passing the classname string as argument. The factory() method of each subfactory attempts to match this class name, and creates a new object of the desired subclass if it recognizes the name. If a match is found by any subfactory, trySubfactories() immediately stops the search and returns a Base* pointer to the new object. If no match is found by any subfactory, trySubfactories() returns a null pointer.</p>
<p>As an example, imagine that you have written an NvtLangevinIntegrator subclass of <a class="el" href="classMcMd_1_1MdIntegrator.html" title="Abstract base for molecular dynamics integrators.">MdIntegrator</a>, because no Langevin integrator is (thus far) distributed with Simpatico. You would then also define a subclass of <a class="el" href="classUtil_1_1Factory.html">Factory&lt;MdIntegrator&gt;</a>, which we will called "MyMdIntegratorFactory", with a factory() method that can recognize the name "NvtLangevinIntegrator" and instantiate an object of this new class. Here is an example of the required class definition: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;MdIntegratorFactory.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;NvtLangevinIntegrator.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span>McMd </div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">   <span class="keyword">class </span>MyMdIntegratorFactory : <span class="keyword">public</span> Factory&lt;MdIntegrator&gt;</div>
<div class="line">   {</div>
<div class="line">   <span class="keyword">public</span>:</div>
<div class="line"></div>
<div class="line">      <span class="keyword">virtual</span> MdIntegrator* factory(std::string &amp;classname)</div>
<div class="line">      {</div>
<div class="line">         <span class="comment">// Initialize ptr to null</span></div>
<div class="line">         MdIntegrator *ptr = 0;</div>
<div class="line"></div>
<div class="line">         <span class="comment">// Search subfactories (if any), return if matched.</span></div>
<div class="line">         ptr = trySubfactories(classname);</div>
<div class="line">         <span class="keywordflow">if</span> (ptr) <span class="keywordflow">return</span> ptr;</div>
<div class="line"></div>
<div class="line">         <span class="comment">// Attempt to explicitly match classname </span></div>
<div class="line">         <span class="keywordflow">if</span> (classname == <span class="stringliteral">&quot;NvtLangevinIntegrator&quot;</span>) {</div>
<div class="line">            ptr = <span class="keyword">new</span> NvtLangevinIntegrator(*systemPtr_);</div>
<div class="line">         }</div>
<div class="line">         <span class="keywordflow">return</span> ptr;</div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">   };</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --><p> The factory method for this subclass returns a pointer to a new NvtLangevinIntegrator, if the subclassName string is "NvtLangevinIntegrator". It returns a null pointer otherwise.</p>
<h1><a class="anchor" id="set_factory_extend_sec"></a>
Adding a Custom Factory</h1>
<p>After writing a custom factory, one must invoke the addSubfactory() method of the default factory to register the new Factory as a subfactory of the default Factory. This must be done in the main program, before the readParam() method is invoked.</p>
<p>Below, we show an example of a main program for an <a class="el" href="classMcMd_1_1MdSimulation.html" title="A molecular dynamics simulation of a single MdSystem.">MdSimulation</a> that adds a custom factory MyMdIntegratorFactory as a subfactory to the <a class="el" href="classMcMd_1_1MdIntegratorFactory.html" title="Default Factory for subclasses of MdIntegrator.">MdIntegratorFactory</a>. </p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>McMd</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">   <span class="keywordtype">int</span> main </div>
<div class="line">   {</div>
<div class="line">      MdSimulation sim;</div>
<div class="line">      MyMdIntegratorFactory myFactory;</div>
<div class="line"> </div>
<div class="line">      \\ Register the custom Factory with the MdSystem</div>
<div class="line">      sim.system().mdIntegratorFactory().addSubfactory(myFactory);</div>
<div class="line"></div>
<div class="line">      \\ Read the parameter file from standard input.</div>
<div class="line">      sim.readParam();</div>
<div class="line">  </div>
<div class="line">      \\ Read and execute the command script.</div>
<div class="line">      sim.readCommands();</div>
<div class="line">  </div>
<div class="line">   }</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --><p> The addSubfactory() method must be invoked before <a class="el" href="classMcMd_1_1MdSimulation.html#aa16156cd700993f491f09c0caee6ce2f" title="Read parameters from the default parameter istream.">MdSimulation::readParam()</a> in order for the subfactory to be available for use when the parameter file is read. A similar pattern is used to set user defined Factory classes for subclasses of <a class="el" href="classMcMd_1_1Species.html" title="A Species represents a set of chemically similar molecules.">Species</a>, <a class="el" href="classMcMd_1_1McMove.html" title="McMove is an abstract base class for Monte Carlo moves.">McMove</a>, and <a class="el" href="classMcMd_1_1Diagnostic.html" title="Abstract base for periodic output and/or analysis actions.">Diagnostic</a>. The <a class="el" href="classMcMd_1_1SpeciesFactory.html" title="Default Factory for subclasses of Species.">SpeciesFactory</a> and DiagnosticFactory are accessed through methods of the <a class="el" href="classMcMd_1_1Simulation.html" title="The main object in a simulation, which coordinates others.">Simulation</a> class. The <a class="el" href="classMcMd_1_1McMoveFactory.html" title="McMoveFactory for an McSimulation.">McMoveFactory</a> is accessible through a method of <a class="el" href="classMcMd_1_1McSimulation.html" title="A Monte-Carlo simulation of one McSystem.">McSimulation</a>.</p>
<h1><a class="anchor" id="custom_factory_accessor_sec"></a>
Access to Factory Classes</h1>
<p>The default Factory object for each of the polymorphic base classes in an mcSim or mdSim simulation can be accessed by reference via a method of either the <a class="el" href="classMcMd_1_1Simulation.html" title="The main object in a simulation, which coordinates others.">Simulation</a> or <a class="el" href="classMcMd_1_1System.html" title="A set of interacting Molecules enclosed by a Boundary.">McMd::System</a> classes, or of the <a class="el" href="classMcMd_1_1McSimulation.html" title="A Monte-Carlo simulation of one McSystem.">McSimulation</a>, <a class="el" href="classMcMd_1_1MdSimulation.html" title="A molecular dynamics simulation of a single MdSystem.">MdSimulation</a>, <a class="el" href="classMcMd_1_1McSystem.html" title="A System for use in a Markov chain Monte Carlo simulation.">McSystem</a> or <a class="el" href="classMcMd_1_1MdSystem.html" title="A System for Molecular Dynamics simulation.">MdSystem</a> subclasses. The required accessor methods for the factory classes used by mcSim and mdSim are:</p>
<ul>
<li>McMd::Factory&lt;Species&gt;&amp; <a class="el" href="classMcMd_1_1Simulation.html#a8086af0046abf289da3cc1a85da97020" title="Return the Species Factory by reference.">McMd::Simulation::speciesFactory()</a></li>
</ul>
<ul>
<li>McMd::Factory&lt;Diagnostic&gt;&amp; <a class="el" href="classMcMd_1_1Simulation.html#ac95779326ad13ccdf35178cc4ffad987" title="Return the Diagnostic factory by reference.">McMd::Simulation::diagnosticFactory()</a></li>
</ul>
<ul>
<li>McMd::Factory&lt;McMove&gt;&amp; <a class="el" href="classMcMd_1_1McSimulation.html#a1e77cead3141ff5bfaa00a5fb38b06c1" title="Get the McMove factory by reference.">McMd::McSimulation::mcMoveFactory()</a></li>
</ul>
<ul>
<li>McMd::Factory&lt;MdIntegrator&gt;&amp; <a class="el" href="classMcMd_1_1MdSystem.html#a2464533e36432fb77fe080b3224cfa9c" title="Return the MdIntegrator Factory by reference.">McMd::MdSystem::mdIntegratorFactory()</a></li>
</ul>
<ul>
<li>McMd::Factory&lt;ConfigIo&gt;&amp; <a class="el" href="classMcMd_1_1System.html#a422a12fcd4c7d9da8d377afc58c3dd37" title="Get the configuration file reader/writer factory by reference.">McMd::System::configIoFactory()</a></li>
</ul>
<ul>
<li>McMd::Factory&lt;TrajectoryIo&gt;&amp; <a class="el" href="classMcMd_1_1System.html#a19e7cc56a740995d0b999129c2f67a8b" title="Get the trajectory reader/writer factory by reference.">McMd::MdSystem::trajectoryIoFactory()</a></li>
</ul>
<ul>
<li>McMd::Factory&lt;Perturbation&gt;&amp; <a class="el" href="classMcMd_1_1System.html#a4108e1167ab8a74c302cf533374f564a" title="Get the perturbation factory by reference.">McMd::System::perturbationFactory()</a></li>
</ul>
<ul>
<li><a class="el" href="classMcMd_1_1PairFactory.html" title="Factory for subclasses MdPairPotential or McPairPotential.">McMd::PairFactory</a>&amp; <a class="el" href="classMcMd_1_1System.html#a7f28c02097251e76853562ab4a97c7de" title="Get the PairFactory by reference.">McMd::System::pairFactory()</a></li>
</ul>
<ul>
<li>McMd::Factory&lt;BondPotential&gt;&amp; <a class="el" href="classMcMd_1_1System.html#a48d6b4068d96167cd4c519e56058160d" title="Get the associated Factory&lt;BondPotential&gt; by reference.">McMd::System::bondFactory()</a></li>
</ul>
<ul>
<li>McMd::Factory&lt;AnglePotential&gt;&amp; <a class="el" href="classMcMd_1_1System.html#a3fd031b5779c3b48d73d768ed815ea53" title="Get the associated AngleFactory by reference.">McMd::System::angleFactory()</a></li>
</ul>
<ul>
<li>McMd::Factory&lt;DihedralPotential&gt;&amp; <a class="el" href="classMcMd_1_1System.html#af983d7ff0ceca8768ea01347b7af0304" title="Get the associated Dihedral Factory by reference.">McMd::System::dihedralFactory()</a></li>
</ul>
<ul>
<li>McMd::Factory&lt;BondPotential&gt;&amp; <a class="el" href="classMcMd_1_1System.html#aa9c0fb2c5e81be12ee756bc939d01ea5" title="Get the associated Link factory by reference.">McMd::System::linkFactory()</a></li>
</ul>
<ul>
<li>McMd::Factory&lt;ExternalPotential&gt;&amp; <a class="el" href="classMcMd_1_1System.html#ad3beac0f5ba061c0b05fcfa208b0cf70" title="Get the associated ExternalPotential factory by reference.">McMd::System::externalFactory()</a></li>
</ul>
<p>Methods of <a class="el" href="classMcMd_1_1Simulation.html" title="The main object in a simulation, which coordinates others.">Simulation</a> and <a class="el" href="classMcMd_1_1System.html" title="A set of interacting Molecules enclosed by a Boundary.">System</a> are also available in the MC and MD subclasses of these classes, and so can be used in either MC or MD simulations. See the page about <a class="el" href="extend_potential_page.html">4.4 Potential Energy Classes</a> for a more detailed discussion of the potential energy and potential energy factory classes.</p>
<p>When a factory must be accessed via an instance of <a class="el" href="classMcMd_1_1System.html" title="A set of interacting Molecules enclosed by a Boundary.">System</a> or one of its subclasesses, a reference to the required <a class="el" href="classMcMd_1_1McSystem.html" title="A System for use in a Markov chain Monte Carlo simulation.">McSystem</a> or <a class="el" href="classMcMd_1_1MdSystem.html" title="A System for Molecular Dynamics simulation.">MdSystem</a> object can be obtained using the system() method of the parent <a class="el" href="classMcMd_1_1McSimulation.html" title="A Monte-Carlo simulation of one McSystem.">McSimulation</a> or <a class="el" href="classMcMd_1_1MdSimulation.html" title="A molecular dynamics simulation of a single MdSystem.">MdSimulation</a> object. This is done in the above example, in which the <a class="el" href="classMcMd_1_1MdIntegratorFactory.html" title="Default Factory for subclasses of MdIntegrator.">MdIntegratorFactory</a> is accessed via the line </p>
<div class="fragment"><div class="line">sim.system().mdIntegratorFactory().addSubfactory(myFactory);</div>
</div><!-- fragment --><p> Here, sim is an instance of <a class="el" href="classMcMd_1_1MdSimulation.html" title="A molecular dynamics simulation of a single MdSystem.">MdSimulation</a>. The method <a class="el" href="classMcMd_1_1MdSimulation.html#a10d21bd8717ff9722f56230435b576c9" title="Get the MdSystem being simulated by reference.">MdSimulation::system()</a> returns a reference to the associated <a class="el" href="classMcMd_1_1MdSystem.html" title="A System for Molecular Dynamics simulation.">MdSystem</a> object. The method <a class="el" href="classMcMd_1_1MdSystem.html#a2464533e36432fb77fe080b3224cfa9c" title="Return the MdIntegrator Factory by reference.">MdSystem::mdIntegratorFactory()</a> then returns a reference to the default <a class="el" href="classUtil_1_1Factory.html">Factory&lt;MdIntegrator&gt;</a>. Invoking the method Factory&lt;MdIntegrator&gt;::addSubFactory() of this factory object then adds the user-defined subfactory to the default <a class="el" href="classMcMd_1_1MdIntegratorFactory.html" title="Default Factory for subclasses of MdIntegrator.">MdIntegratorFactory</a>.</p>
<p><br/>
 <a class="el" href="extend_potential_page.html">4.4 Potential Energy Classes</a> (Prev) &#160; &#160; &#160; &#160; <a class="el" href="extend_page.html">4 Extending Simpatico</a> (Up) &#160; &#160; &#160; &#160; <a class="el" href="extend_module_page.html">4.6 Modules</a> (Next) </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.3-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat May 18 2013 15:58:36 for Simpatico by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3
</small></address>
</body>
</html>
