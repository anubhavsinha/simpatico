<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Simpatico: McMdConfigIo.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Simpatico
   &#160;<span id="projectnumber">v1.10</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">McMdConfigIo.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">* Simpatico - Simulation Package for Polymeric and Molecular Liquids</span>
<a name="l00003"></a>00003 <span class="comment">*</span>
<a name="l00004"></a>00004 <span class="comment">* Copyright 2010 - 2014, The Regents of the University of Minnesota</span>
<a name="l00005"></a>00005 <span class="comment">* Distributed under the terms of the GNU General Public License.</span>
<a name="l00006"></a>00006 <span class="comment">*/</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="preprocessor">#include &quot;McMdConfigIo.h&quot;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;mcMd/simulation/Simulation.h&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;mcMd/simulation/System.h&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;mcMd/species/Species.h&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;mcMd/species/SpeciesMutator.h&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;mcMd/chemistry/Molecule.h&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;mcMd/chemistry/Atom.h&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#ifdef INTER_TETHER</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span><span class="preprocessor">#include &lt;mcMd/tethers/TetherMaster.h&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#endif</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span><span class="preprocessor">#ifdef MCMD_LINK</span>
<a name="l00019"></a>00019 <span class="preprocessor"></span><span class="preprocessor">#include &lt;mcMd/links/LinkMaster.h&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#endif</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span><span class="preprocessor">#include &lt;util/param/Label.h&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;util/format/Int.h&gt;</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="keyword">namespace </span>McMd
<a name="l00025"></a>00025 {
<a name="l00026"></a>00026 
<a name="l00027"></a>00027    <span class="keyword">using namespace </span>Util;
<a name="l00028"></a>00028 
<a name="l00029"></a>00029    <span class="comment">/*</span>
<a name="l00030"></a>00030 <span class="comment">   * Constructor. </span>
<a name="l00031"></a>00031 <span class="comment">   */</span>
<a name="l00032"></a><a class="code" href="classMcMd_1_1McMdConfigIo.html#a4b93b8c48c34307ab1b4ee6650c30da3">00032</a>    <a class="code" href="classMcMd_1_1McMdConfigIo.html#a4b93b8c48c34307ab1b4ee6650c30da3" title="Constructor.">McMdConfigIo::McMdConfigIo</a>(<a class="code" href="classMcMd_1_1System.html" title="A set of interacting Molecules enclosed by a Boundary.">System</a>&amp; system)
<a name="l00033"></a>00033     : <a class="code" href="classMcMd_1_1ConfigIo.html" title="System configuration file reader and writer.">ConfigIo</a>(system)
<a name="l00034"></a>00034    {}
<a name="l00035"></a>00035 
<a name="l00036"></a>00036    <span class="comment">/* </span>
<a name="l00037"></a>00037 <span class="comment">   * Destructor.   </span>
<a name="l00038"></a>00038 <span class="comment">   */</span>
<a name="l00039"></a><a class="code" href="classMcMd_1_1McMdConfigIo.html#adca7f4dcb8bda38d898f8ef481f160b8">00039</a>    <a class="code" href="classMcMd_1_1McMdConfigIo.html#adca7f4dcb8bda38d898f8ef481f160b8" title="Destructor.">McMdConfigIo::~McMdConfigIo</a>() 
<a name="l00040"></a>00040    {}
<a name="l00041"></a>00041 
<a name="l00042"></a>00042    <span class="comment">/* </span>
<a name="l00043"></a>00043 <span class="comment">   * Read the configuration file.</span>
<a name="l00044"></a>00044 <span class="comment">   */</span>
<a name="l00045"></a><a class="code" href="classMcMd_1_1McMdConfigIo.html#aad98b04b05d3a406681ea06c67599b9a">00045</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1McMdConfigIo.html#aad98b04b05d3a406681ea06c67599b9a" title="Read configuration (particle positions) from file.">McMdConfigIo::read</a>(std::istream &amp;in)
<a name="l00046"></a>00046    {
<a name="l00047"></a>00047 
<a name="l00048"></a>00048       <span class="comment">// Read and set dimensions of simulation Boundary.</span>
<a name="l00049"></a>00049       in &gt;&gt; <a class="code" href="classUtil_1_1Label.html" title="A label string in a file format.">Label</a>(<span class="stringliteral">&quot;BOUNDARY&quot;</span>);
<a name="l00050"></a>00050       in &gt;&gt; <a class="code" href="classMcMd_1_1ConfigIo.html#ab7939cdcfe6174017d8f6689a70230e6" title="Get the Boundary.">boundary</a>() ;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052       <span class="comment">// Get molecules and read atomic positions</span>
<a name="l00053"></a>00053       Label speciesLabel(<span class="stringliteral">&quot;species&quot;</span>);
<a name="l00054"></a>00054       Label nMoleculeLabel(<span class="stringliteral">&quot;nMolecule&quot;</span>);
<a name="l00055"></a>00055       Label moleculeLabel(<span class="stringliteral">&quot;molecule&quot;</span>);
<a name="l00056"></a>00056       <a class="code" href="classMcMd_1_1Species.html" title="A Species represents a set of chemically similar molecules.">Species</a>* speciesPtr;
<a name="l00057"></a>00057       <a class="code" href="classMcMd_1_1Molecule.html" title="A physical molecule (a set of covalently bonded Atoms).">Molecule</a>* molPtr;
<a name="l00058"></a>00058       <a class="code" href="classUtil_1_1ArrayIterator.html" title="Forward iterator for an Array or a C array.">Molecule::AtomIterator</a> atomIter;
<a name="l00059"></a>00059       <span class="keywordtype">int</span> iSpecies, iSpeciesIn, nMolecule, iMol, iMolIn;
<a name="l00060"></a>00060 
<a name="l00061"></a>00061       in &gt;&gt; Label(<span class="stringliteral">&quot;MOLECULES&quot;</span>);
<a name="l00062"></a>00062       <span class="keywordflow">for</span> (iSpecies = 0; iSpecies &lt; <a class="code" href="classMcMd_1_1ConfigIo.html#a2dba6a4e4d905af80bb8f5d782c3bfb8" title="Get a reference to the parent Simulation.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#afa700c2440413cd98a8d47900c4bdc8d" title="Get the number of Species in this Simulation.">nSpecies</a>(); ++iSpecies) {
<a name="l00063"></a>00063          speciesPtr = &amp;<a class="code" href="classMcMd_1_1ConfigIo.html#a2dba6a4e4d905af80bb8f5d782c3bfb8" title="Get a reference to the parent Simulation.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#a8d54e049a2fe0266fc26fbe9bc8441d5" title="Get a specific Species by reference.">species</a>(iSpecies);
<a name="l00064"></a>00064          in &gt;&gt; Label(<span class="stringliteral">&quot;species&quot;</span>) &gt;&gt; iSpeciesIn;
<a name="l00065"></a>00065          <span class="keywordflow">if</span> (iSpeciesIn != iSpecies) {
<a name="l00066"></a>00066             <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Error: iSpeciesIn != iSpecies&quot;</span>);
<a name="l00067"></a>00067          }
<a name="l00068"></a>00068          in &gt;&gt; Label(<span class="stringliteral">&quot;nMolecule&quot;</span>) &gt;&gt; nMolecule;
<a name="l00069"></a>00069          <span class="keywordflow">for</span> (iMol = 0; iMol &lt; nMolecule; ++iMol) {
<a name="l00070"></a>00070             in &gt;&gt; moleculeLabel &gt;&gt; iMolIn;
<a name="l00071"></a>00071             molPtr = &amp;(speciesPtr-&gt;<a class="code" href="classMcMd_1_1Species.html#a00aaeb56269e3aefcc38f0bf4a788f62" title="Get the reservoir for this Species by reference.">reservoir</a>().<a class="code" href="classUtil_1_1ArrayStack.html#a0465b9e61f008e56b8e6a83c13c3598a" title="Pop an element off the stack.">pop</a>());
<a name="l00072"></a>00072             <a class="code" href="classMcMd_1_1ConfigIo.html#a3f20f914433938f289522c221751c5aa" title="Get a reference to the parent System.">system</a>().<a class="code" href="classMcMd_1_1System.html#a5311d7245d55b3efa0848ed040b053b3" title="Add a Molecule to this System.">addMolecule</a>(*molPtr);
<a name="l00073"></a>00073 
<a name="l00074"></a>00074             <span class="keywordflow">if</span> (iMolIn != iMol) {
<a name="l00075"></a>00075                <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Error: iMolIn != iMol&quot;</span>);
<a name="l00076"></a>00076             }
<a name="l00077"></a>00077             <span class="keywordflow">if</span> (molPtr != &amp;<a class="code" href="classMcMd_1_1ConfigIo.html#a3f20f914433938f289522c221751c5aa" title="Get a reference to the parent System.">system</a>().molecule(iSpecies, iMol)) {
<a name="l00078"></a>00078                <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Molecule index error&quot;</span>);
<a name="l00079"></a>00079             }
<a name="l00080"></a>00080 
<a name="l00081"></a>00081             <span class="comment">// If mutable, read molecule state id</span>
<a name="l00082"></a>00082             <span class="keywordflow">if</span> (speciesPtr-&gt;<a class="code" href="classMcMd_1_1Species.html#a3713aef1064d4abd7a68589c2d2d2890" title="Is this a mutable Species?">isMutable</a>()) {
<a name="l00083"></a>00083                speciesPtr-&gt;<a class="code" href="classMcMd_1_1Species.html#a1f51fdc7a0b03e63f8d6ee82d3325b73" title="Return the species mutator object by reference.">mutator</a>().<a class="code" href="classMcMd_1_1SpeciesMutator.html#a6cdadfe436293f7ccdb2b43cb8f11051" title="Read the state id for one molecule from a configuration file stream.">readMoleculeState</a>(in, *molPtr);
<a name="l00084"></a>00084             }
<a name="l00085"></a>00085 
<a name="l00086"></a>00086             <span class="comment">// Read positions, shift into primary cell</span>
<a name="l00087"></a>00087             <span class="keywordflow">for</span> (molPtr-&gt;<a class="code" href="classMcMd_1_1Molecule.html#aae40ce6fcc1df34548da1d9bd72b458c" title="Set an Molecule::AtomIterator to first Atom in this Molecule.">begin</a>(atomIter); atomIter.<a class="code" href="classUtil_1_1ArrayIterator.html#a7632e032938bf2cebe26c06d28cbc36c" title="Is the current pointer not at the end of the array?">notEnd</a>(); ++atomIter) {
<a name="l00088"></a>00088                <a class="code" href="classMcMd_1_1McMdConfigIo.html#aa0720110c3de18f72795504dddf7a3c6" title="Read data for one atom.">readAtom</a>(in, *atomIter);
<a name="l00089"></a>00089             }
<a name="l00090"></a>00090 
<a name="l00091"></a>00091          }
<a name="l00092"></a>00092       }
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 <span class="preprocessor">      #ifdef INTER_TETHER</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span>      {  <span class="comment">// Scope block for variables </span>
<a name="l00096"></a>00096 
<a name="l00097"></a>00097          <span class="comment">// Read Tethers</span>
<a name="l00098"></a>00098          <a class="code" href="classUtil_1_1Vector.html" title="A Vector is a Cartesian vector.">Vector</a> anchor;
<a name="l00099"></a>00099          <a class="code" href="classMcMd_1_1Atom.html" title="A point particle within a Molecule.">Atom</a>*  atomPtr;
<a name="l00100"></a>00100          <span class="keywordtype">int</span>    iTether, nTether, iAtom;
<a name="l00101"></a>00101          in &gt;&gt; Label(<span class="stringliteral">&quot;TETHERS&quot;</span>);
<a name="l00102"></a>00102          in &gt;&gt; Label(<span class="stringliteral">&quot;nTether&quot;</span>) &gt;&gt; nTether;
<a name="l00103"></a>00103          <span class="keywordflow">for</span> (iTether = 0; iTether &lt; nTether; ++iTether) {
<a name="l00104"></a>00104             in &gt;&gt; iSpecies &gt;&gt; iMol &gt;&gt; iAtom &gt;&gt; anchor;
<a name="l00105"></a>00105             <span class="keywordflow">if</span> (iSpecies &gt;= <a class="code" href="classMcMd_1_1ConfigIo.html#a2dba6a4e4d905af80bb8f5d782c3bfb8" title="Get a reference to the parent Simulation.">simulation</a>().nSpecies()) {
<a name="l00106"></a>00106                <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Invalid species index for tether&quot;</span>);
<a name="l00107"></a>00107             }
<a name="l00108"></a>00108             <span class="keywordflow">if</span> (iMol &gt;= <a class="code" href="classMcMd_1_1ConfigIo.html#a3f20f914433938f289522c221751c5aa" title="Get a reference to the parent System.">system</a>().nMolecule(iSpecies)) {
<a name="l00109"></a>00109                <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Invalid molecule index for tether&quot;</span>);
<a name="l00110"></a>00110             }
<a name="l00111"></a>00111             molPtr  = &amp;<a class="code" href="classMcMd_1_1ConfigIo.html#a3f20f914433938f289522c221751c5aa" title="Get a reference to the parent System.">system</a>().<a class="code" href="classMcMd_1_1System.html#a5b439fee621a22ebf5e98ee540c2a92f" title="Get a specific Molecule in this System, by integer index.">molecule</a>(iSpecies, iMol);
<a name="l00112"></a>00112             <span class="keywordflow">if</span> (iAtom &gt;= molPtr-&gt;<a class="code" href="classMcMd_1_1Molecule.html#a3a3a58955a18ebeb266d328b605695e6" title="Get the number of Atoms in this Molecule.">nAtom</a>()) {
<a name="l00113"></a>00113                <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; iAtom &lt;&lt; <span class="stringliteral">&quot;   &quot;</span> &lt;&lt; molPtr-&gt;<a class="code" href="classMcMd_1_1Molecule.html#a3a3a58955a18ebeb266d328b605695e6" title="Get the number of Atoms in this Molecule.">nAtom</a>() &lt;&lt; std::endl;
<a name="l00114"></a>00114                <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Invalid atom index for tether&quot;</span>);
<a name="l00115"></a>00115             }
<a name="l00116"></a>00116             atomPtr = &amp;molPtr-&gt;<a class="code" href="classMcMd_1_1Molecule.html#a8df213a78659a4244a2914d796681071" title="Get a specific Atom in this Molecule.">atom</a>(iAtom);
<a name="l00117"></a>00117             <a class="code" href="classMcMd_1_1ConfigIo.html#a3f20f914433938f289522c221751c5aa" title="Get a reference to the parent System.">system</a>().tetherMaster().addTether(*atomPtr, anchor);
<a name="l00118"></a>00118          }
<a name="l00119"></a>00119 
<a name="l00120"></a>00120       }
<a name="l00121"></a>00121 <span class="preprocessor">      #endif</span>
<a name="l00122"></a>00122 <span class="preprocessor"></span>
<a name="l00123"></a>00123 <span class="preprocessor">      #ifdef MCMD_LINK</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span>      { <span class="comment">// Scope block for variables</span>
<a name="l00125"></a>00125 
<a name="l00126"></a>00126          <span class="comment">// Read Links</span>
<a name="l00127"></a>00127          <a class="code" href="classMcMd_1_1Atom.html" title="A point particle within a Molecule.">Atom</a>*  atom0Ptr;
<a name="l00128"></a>00128          <a class="code" href="classMcMd_1_1Atom.html" title="A point particle within a Molecule.">Atom</a>*  atom1Ptr;
<a name="l00129"></a>00129          <span class="keywordtype">int</span>    iLink, nLink, iAtom, linkType;
<a name="l00130"></a>00130 
<a name="l00131"></a>00131          in &gt;&gt; Label(<span class="stringliteral">&quot;LINKS&quot;</span>);
<a name="l00132"></a>00132          in &gt;&gt; Label(<span class="stringliteral">&quot;nLink&quot;</span>) &gt;&gt; nLink;
<a name="l00133"></a>00133          <span class="keywordflow">for</span> (iLink = 0; iLink &lt; nLink; ++iLink) {
<a name="l00134"></a>00134 
<a name="l00135"></a>00135             <span class="comment">// Read atom 0</span>
<a name="l00136"></a>00136             in &gt;&gt; iSpecies &gt;&gt; iMol &gt;&gt; iAtom;
<a name="l00137"></a>00137             <span class="keywordflow">if</span> (iSpecies &lt; 0 || iSpecies &gt;= <a class="code" href="classMcMd_1_1ConfigIo.html#a2dba6a4e4d905af80bb8f5d782c3bfb8" title="Get a reference to the parent Simulation.">simulation</a>().nSpecies()) {
<a name="l00138"></a>00138                <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot;iLink = &quot;</span> &lt;&lt; iLink &lt;&lt; std::endl;
<a name="l00139"></a>00139                <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Invalid iSpecies0 index in link&quot;</span>);
<a name="l00140"></a>00140             }
<a name="l00141"></a>00141             <span class="keywordflow">if</span> (iMol &lt; 0 || iMol &gt;= <a class="code" href="classMcMd_1_1ConfigIo.html#a3f20f914433938f289522c221751c5aa" title="Get a reference to the parent System.">system</a>().nMolecule(iSpecies)) {
<a name="l00142"></a>00142                <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot;iLink = &quot;</span> &lt;&lt; iLink &lt;&lt; std::endl;
<a name="l00143"></a>00143                <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Invalid iMol0 index in link&quot;</span>);
<a name="l00144"></a>00144             }
<a name="l00145"></a>00145             molPtr  = &amp;<a class="code" href="classMcMd_1_1ConfigIo.html#a3f20f914433938f289522c221751c5aa" title="Get a reference to the parent System.">system</a>().<a class="code" href="classMcMd_1_1System.html#a5b439fee621a22ebf5e98ee540c2a92f" title="Get a specific Molecule in this System, by integer index.">molecule</a>(iSpecies, iMol);
<a name="l00146"></a>00146             <span class="keywordflow">if</span> (iAtom &lt; 0 || iAtom &gt;= molPtr-&gt;<a class="code" href="classMcMd_1_1Molecule.html#a3a3a58955a18ebeb266d328b605695e6" title="Get the number of Atoms in this Molecule.">nAtom</a>()) {
<a name="l00147"></a>00147                <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot;iLink = &quot;</span> &lt;&lt; iLink &lt;&lt; std::endl;
<a name="l00148"></a>00148                <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Invalid iAtom0 index for link&quot;</span>);
<a name="l00149"></a>00149             }
<a name="l00150"></a>00150             atom0Ptr = &amp;molPtr-&gt;<a class="code" href="classMcMd_1_1Molecule.html#a8df213a78659a4244a2914d796681071" title="Get a specific Atom in this Molecule.">atom</a>(iAtom);
<a name="l00151"></a>00151 
<a name="l00152"></a>00152             <span class="comment">// Read atom 1</span>
<a name="l00153"></a>00153             in &gt;&gt; iSpecies &gt;&gt; iMol &gt;&gt; iAtom;
<a name="l00154"></a>00154             <span class="keywordflow">if</span> (iSpecies &lt; 0 || iSpecies &gt;= <a class="code" href="classMcMd_1_1ConfigIo.html#a2dba6a4e4d905af80bb8f5d782c3bfb8" title="Get a reference to the parent Simulation.">simulation</a>().nSpecies()) {
<a name="l00155"></a>00155                <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot;iLink = &quot;</span> &lt;&lt; iLink &lt;&lt; std::endl;
<a name="l00156"></a>00156                <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Invalid iSpecies1 index in link&quot;</span>);
<a name="l00157"></a>00157             }
<a name="l00158"></a>00158             <span class="keywordflow">if</span> (iMol &lt; 0 || iMol &gt;= <a class="code" href="classMcMd_1_1ConfigIo.html#a3f20f914433938f289522c221751c5aa" title="Get a reference to the parent System.">system</a>().nMolecule(iSpecies)) {
<a name="l00159"></a>00159                <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot;iLink = &quot;</span> &lt;&lt; iLink &lt;&lt; std::endl;
<a name="l00160"></a>00160                <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Invalid iMol1 index in link&quot;</span>);
<a name="l00161"></a>00161             }
<a name="l00162"></a>00162             molPtr  = &amp;<a class="code" href="classMcMd_1_1ConfigIo.html#a3f20f914433938f289522c221751c5aa" title="Get a reference to the parent System.">system</a>().<a class="code" href="classMcMd_1_1System.html#a5b439fee621a22ebf5e98ee540c2a92f" title="Get a specific Molecule in this System, by integer index.">molecule</a>(iSpecies, iMol);
<a name="l00163"></a>00163             <span class="keywordflow">if</span> (iAtom &lt; 0 || iAtom &gt;= molPtr-&gt;<a class="code" href="classMcMd_1_1Molecule.html#a3a3a58955a18ebeb266d328b605695e6" title="Get the number of Atoms in this Molecule.">nAtom</a>()) {
<a name="l00164"></a>00164                <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot;iLink = &quot;</span> &lt;&lt; iLink &lt;&lt; std::endl;
<a name="l00165"></a>00165                <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Invalid iAtom1 index for link&quot;</span>);
<a name="l00166"></a>00166             }
<a name="l00167"></a>00167             atom1Ptr = &amp;molPtr-&gt;<a class="code" href="classMcMd_1_1Molecule.html#a8df213a78659a4244a2914d796681071" title="Get a specific Atom in this Molecule.">atom</a>(iAtom);
<a name="l00168"></a>00168 
<a name="l00169"></a>00169             in &gt;&gt; linkType;
<a name="l00170"></a>00170             <a class="code" href="classMcMd_1_1ConfigIo.html#a3f20f914433938f289522c221751c5aa" title="Get a reference to the parent System.">system</a>().<a class="code" href="classMcMd_1_1System.html#a4bf43e98368d84f161518c595a5b9709" title="Get the LinkMaster by reference.">linkMaster</a>().<a class="code" href="classMcMd_1_1LinkMaster.html#a042a6537ef0e57306f9e312d07fcf453" title="Add a link betwen two specific Atoms.">addLink</a>(*atom0Ptr, *atom1Ptr, linkType);
<a name="l00171"></a>00171 
<a name="l00172"></a>00172          }
<a name="l00173"></a>00173 
<a name="l00174"></a>00174       }
<a name="l00175"></a>00175 <span class="preprocessor">      #endif</span>
<a name="l00176"></a>00176 <span class="preprocessor"></span>
<a name="l00177"></a>00177    }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179    <span class="comment">/* </span>
<a name="l00180"></a>00180 <span class="comment">   * Write the configuration file.</span>
<a name="l00181"></a>00181 <span class="comment">   */</span>
<a name="l00182"></a><a class="code" href="classMcMd_1_1McMdConfigIo.html#a0218e3279e4a4aae8273dea2f40ecf90">00182</a>    <span class="keywordtype">void</span> <a class="code" href="classMcMd_1_1McMdConfigIo.html#a0218e3279e4a4aae8273dea2f40ecf90" title="Write configuration (particle positions) to file.">McMdConfigIo::write</a>(std::ostream &amp;out)
<a name="l00183"></a>00183    {
<a name="l00184"></a>00184       <span class="keyword">using</span> std::endl;
<a name="l00185"></a>00185 
<a name="l00186"></a>00186       <span class="comment">// Write Boundary dimensions</span>
<a name="l00187"></a>00187       out &lt;&lt; <span class="stringliteral">&quot;BOUNDARY&quot;</span> &lt;&lt; endl &lt;&lt; endl;
<a name="l00188"></a>00188       out &lt;&lt; <a class="code" href="classMcMd_1_1ConfigIo.html#ab7939cdcfe6174017d8f6689a70230e6" title="Get the Boundary.">boundary</a>() &lt;&lt; endl;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190       <span class="comment">// Write atomic positions</span>
<a name="l00191"></a>00191       <a class="code" href="classUtil_1_1ConstPArrayIterator.html" title="Forward iterator for a PArray.">System::ConstMoleculeIterator</a> molIter;
<a name="l00192"></a>00192       <a class="code" href="classUtil_1_1ConstArrayIterator.html" title="Forward const iterator for an Array or a C array.">Molecule::ConstAtomIterator</a>   atomIter;
<a name="l00193"></a>00193       <a class="code" href="classMcMd_1_1Species.html" title="A Species represents a set of chemically similar molecules.">Species</a>* speciesPtr;
<a name="l00194"></a>00194       <span class="keywordtype">int</span> iSpecies, iMolecule;
<a name="l00195"></a>00195       out &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;MOLECULES&quot;</span> &lt;&lt; endl;
<a name="l00196"></a>00196       <span class="keywordflow">for</span> (iSpecies = 0; iSpecies &lt; <a class="code" href="classMcMd_1_1ConfigIo.html#a2dba6a4e4d905af80bb8f5d782c3bfb8" title="Get a reference to the parent Simulation.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#afa700c2440413cd98a8d47900c4bdc8d" title="Get the number of Species in this Simulation.">nSpecies</a>(); ++iSpecies) {
<a name="l00197"></a>00197          out &lt;&lt; endl;
<a name="l00198"></a>00198          out &lt;&lt; <span class="stringliteral">&quot;species    &quot;</span> &lt;&lt; iSpecies &lt;&lt; endl;
<a name="l00199"></a>00199          out &lt;&lt; <span class="stringliteral">&quot;nMolecule  &quot;</span> &lt;&lt; <a class="code" href="classMcMd_1_1ConfigIo.html#a3f20f914433938f289522c221751c5aa" title="Get a reference to the parent System.">system</a>().<a class="code" href="classMcMd_1_1System.html#a8784ff471540e53f5c1e40a55cabf6c6" title="Get the number of molecules of one Species in this System.">nMolecule</a>(iSpecies) &lt;&lt; endl;
<a name="l00200"></a>00200          speciesPtr = &amp;<a class="code" href="classMcMd_1_1ConfigIo.html#a2dba6a4e4d905af80bb8f5d782c3bfb8" title="Get a reference to the parent Simulation.">simulation</a>().<a class="code" href="classMcMd_1_1Simulation.html#a8d54e049a2fe0266fc26fbe9bc8441d5" title="Get a specific Species by reference.">species</a>(iSpecies);
<a name="l00201"></a>00201          iMolecule = 0;
<a name="l00202"></a>00202          <a class="code" href="classMcMd_1_1ConfigIo.html#a3f20f914433938f289522c221751c5aa" title="Get a reference to the parent System.">system</a>().<a class="code" href="classMcMd_1_1System.html#adca6960d9c73e165193b039fdc205ac9" title="Initialize an iterator for molecules of one species in this System.">begin</a>(iSpecies, molIter); 
<a name="l00203"></a>00203          <span class="keywordflow">for</span> ( ; molIter.<a class="code" href="classUtil_1_1ConstPArrayIterator.html#a7777ed8e777e44bc9ca01ad2f02043cc" title="Is the current pointer not at the end of the array?">notEnd</a>(); ++molIter) {
<a name="l00204"></a>00204             out &lt;&lt; endl;
<a name="l00205"></a>00205             out &lt;&lt; <span class="stringliteral">&quot;molecule   &quot;</span> &lt;&lt; iMolecule &lt;&lt; endl;
<a name="l00206"></a>00206             <span class="keywordflow">if</span> (speciesPtr-&gt;<a class="code" href="classMcMd_1_1Species.html#a3713aef1064d4abd7a68589c2d2d2890" title="Is this a mutable Species?">isMutable</a>()) {
<a name="l00207"></a>00207                speciesPtr-&gt;<a class="code" href="classMcMd_1_1Species.html#a1f51fdc7a0b03e63f8d6ee82d3325b73" title="Return the species mutator object by reference.">mutator</a>().<a class="code" href="classMcMd_1_1SpeciesMutator.html#aad874257d7554d3bd67c0418be01312b" title="Write the state id for one molecule to a configuration file stream.">writeMoleculeState</a>(out, *molIter);
<a name="l00208"></a>00208             }
<a name="l00209"></a>00209             <span class="keywordflow">for</span> (molIter-&gt;begin(atomIter); atomIter.<a class="code" href="classUtil_1_1ConstArrayIterator.html#acb367b83901ed37a6cbedd49f3b3080d" title="Is this not the end of the array?">notEnd</a>(); ++atomIter) {
<a name="l00210"></a>00210                <span class="comment">//out &lt;&lt; atomIter-&gt;position() &lt;&lt; endl;</span>
<a name="l00211"></a>00211                <a class="code" href="classMcMd_1_1McMdConfigIo.html#ad1e645d1c823f4049a88bd70dd71ac6b" title="Write data for one atom.">writeAtom</a>(out, *atomIter);
<a name="l00212"></a>00212             }
<a name="l00213"></a>00213             ++iMolecule;
<a name="l00214"></a>00214          }
<a name="l00215"></a>00215       }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 <span class="preprocessor">      #ifdef INTER_TETHER</span>
<a name="l00218"></a>00218 <span class="preprocessor"></span>      { <span class="comment">// Scope for local variables</span>
<a name="l00219"></a>00219 
<a name="l00220"></a>00220          <span class="comment">// Write Tethers</span>
<a name="l00221"></a>00221          Tether*   tetherPtr;
<a name="l00222"></a>00222          <a class="code" href="classMcMd_1_1Atom.html" title="A point particle within a Molecule.">Atom</a>*     atomPtr;
<a name="l00223"></a>00223          <a class="code" href="classMcMd_1_1Molecule.html" title="A physical molecule (a set of covalently bonded Atoms).">Molecule</a>* molPtr;
<a name="l00224"></a>00224          <span class="keywordtype">int</span>       iTether, nTether, iAtom;
<a name="l00225"></a>00225          out &lt;&lt; std::endl;
<a name="l00226"></a>00226          out &lt;&lt; <span class="stringliteral">&quot;TETHERS&quot;</span> &lt;&lt; endl &lt;&lt; endl;
<a name="l00227"></a>00227          nTether = <a class="code" href="classMcMd_1_1ConfigIo.html#a3f20f914433938f289522c221751c5aa" title="Get a reference to the parent System.">system</a>().tetherMaster().nTether();
<a name="l00228"></a>00228          out &lt;&lt; <a class="code" href="classUtil_1_1Label.html" title="A label string in a file format.">Label</a>(<span class="stringliteral">&quot;nTether&quot;</span>) &lt;&lt; nTether &lt;&lt; std::endl;
<a name="l00229"></a>00229          <span class="keywordflow">for</span> (iTether = 0; iTether &lt; nTether; ++iTether) {
<a name="l00230"></a>00230             tetherPtr = &amp;(<a class="code" href="classMcMd_1_1ConfigIo.html#a3f20f914433938f289522c221751c5aa" title="Get a reference to the parent System.">system</a>().tetherMaster().tether(iTether));
<a name="l00231"></a>00231             atomPtr   = &amp;tetherPtr-&gt;atom();
<a name="l00232"></a>00232             molPtr    = &amp;atomPtr-&gt;<a class="code" href="classMcMd_1_1Atom.html#a6c1e500fe698dc9ede1e58c261005304" title="Get the parent Molecule by reference.">molecule</a>();
<a name="l00233"></a>00233             iAtom     = atomPtr-&gt;<a class="code" href="classMcMd_1_1Atom.html#ad051dc3ce9d5a8535f03936e021a8e9c" title="Get local index for this Atom within the parent molecule;.">indexInMolecule</a>();
<a name="l00234"></a>00234             iMolecule = <a class="code" href="classMcMd_1_1ConfigIo.html#a3f20f914433938f289522c221751c5aa" title="Get a reference to the parent System.">system</a>().<a class="code" href="classMcMd_1_1System.html#a4dec0edee931590acc04de732c4dce33" title="Get the index of a Molecule within its Species in this System.">moleculeId</a>(*molPtr);
<a name="l00235"></a>00235             iSpecies  = molPtr-&gt;<a class="code" href="classMcMd_1_1Molecule.html#a70de9b3e9ce956c9597c28f36303b40d" title="Get the molecular Species by reference.">species</a>().<a class="code" href="classMcMd_1_1Species.html#acae83456c3717805ab81869e47c58614" title="Get integer id of this Species.">id</a>();
<a name="l00236"></a>00236             out &lt;&lt; <a class="code" href="classUtil_1_1Int.html" title="Wrapper for an int, for formatted ostream output.">Int</a>(iSpecies,5) &lt;&lt; <a class="code" href="classUtil_1_1Int.html" title="Wrapper for an int, for formatted ostream output.">Int</a>(iMolecule,9) &lt;&lt; <a class="code" href="classUtil_1_1Int.html" title="Wrapper for an int, for formatted ostream output.">Int</a>(iAtom,6) 
<a name="l00237"></a>00237                 &lt;&lt; tetherPtr-&gt;anchor() &lt;&lt; std::endl;
<a name="l00238"></a>00238          }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240       }
<a name="l00241"></a>00241 <span class="preprocessor">      #endif</span>
<a name="l00242"></a>00242 <span class="preprocessor"></span>
<a name="l00243"></a>00243 <span class="preprocessor">      #ifdef MCMD_LINK</span>
<a name="l00244"></a>00244 <span class="preprocessor"></span>      { <span class="comment">// Scope for local variables</span>
<a name="l00245"></a>00245 
<a name="l00246"></a>00246          <span class="comment">// Write Links</span>
<a name="l00247"></a>00247          <a class="code" href="classMcMd_1_1Link.html" title="A Link represents a crosslink between two Atoms.">Link</a>*      linkPtr;
<a name="l00248"></a>00248          <a class="code" href="classMcMd_1_1Atom.html" title="A point particle within a Molecule.">Atom</a>*      atomPtr;
<a name="l00249"></a>00249          <a class="code" href="classMcMd_1_1Molecule.html" title="A physical molecule (a set of covalently bonded Atoms).">Molecule</a>*  molPtr;
<a name="l00250"></a>00250          <span class="keywordtype">int</span>        iLink, nLink, iAtom;
<a name="l00251"></a>00251          out &lt;&lt; std::endl;
<a name="l00252"></a>00252          out &lt;&lt; <span class="stringliteral">&quot;LINKS&quot;</span> &lt;&lt; endl &lt;&lt; endl;
<a name="l00253"></a>00253          nLink = <a class="code" href="classMcMd_1_1ConfigIo.html#a3f20f914433938f289522c221751c5aa" title="Get a reference to the parent System.">system</a>().<a class="code" href="classMcMd_1_1System.html#a4bf43e98368d84f161518c595a5b9709" title="Get the LinkMaster by reference.">linkMaster</a>().<a class="code" href="classMcMd_1_1LinkMaster.html#a72530df0ae2f385c02932d518854e297" title="Get the total number of active Links.">nLink</a>();
<a name="l00254"></a>00254          out &lt;&lt; <a class="code" href="classUtil_1_1Label.html" title="A label string in a file format.">Label</a>(<span class="stringliteral">&quot;nLink&quot;</span>) &lt;&lt; nLink &lt;&lt; std::endl;
<a name="l00255"></a>00255          <span class="keywordflow">for</span> (iLink = 0; iLink &lt; nLink; ++iLink) {
<a name="l00256"></a>00256             linkPtr  = &amp;(<a class="code" href="classMcMd_1_1ConfigIo.html#a3f20f914433938f289522c221751c5aa" title="Get a reference to the parent System.">system</a>().<a class="code" href="classMcMd_1_1System.html#a4bf43e98368d84f161518c595a5b9709" title="Get the LinkMaster by reference.">linkMaster</a>().<a class="code" href="classMcMd_1_1LinkMaster.html#acc53f29278190d5662f1956751f106e0" title="Return an active link by an internal set index.">link</a>(iLink));
<a name="l00257"></a>00257 
<a name="l00258"></a>00258             <span class="comment">// Output species, molecule, atom ids for atom 0</span>
<a name="l00259"></a>00259             atomPtr   = &amp;(linkPtr-&gt;<a class="code" href="classMcMd_1_1Link.html#a14d15f5a16b26ce7bc96893f078a60a1" title="Get Atom0 connected to a Link.">atom0</a>());
<a name="l00260"></a>00260             molPtr    = &amp;atomPtr-&gt;<a class="code" href="classMcMd_1_1Atom.html#a6c1e500fe698dc9ede1e58c261005304" title="Get the parent Molecule by reference.">molecule</a>();
<a name="l00261"></a>00261             iAtom     = atomPtr-&gt;<a class="code" href="classMcMd_1_1Atom.html#ad051dc3ce9d5a8535f03936e021a8e9c" title="Get local index for this Atom within the parent molecule;.">indexInMolecule</a>();
<a name="l00262"></a>00262             iMolecule = <a class="code" href="classMcMd_1_1ConfigIo.html#a3f20f914433938f289522c221751c5aa" title="Get a reference to the parent System.">system</a>().<a class="code" href="classMcMd_1_1System.html#a4dec0edee931590acc04de732c4dce33" title="Get the index of a Molecule within its Species in this System.">moleculeId</a>(*molPtr);
<a name="l00263"></a>00263             iSpecies  = molPtr-&gt;<a class="code" href="classMcMd_1_1Molecule.html#a70de9b3e9ce956c9597c28f36303b40d" title="Get the molecular Species by reference.">species</a>().<a class="code" href="classMcMd_1_1Species.html#acae83456c3717805ab81869e47c58614" title="Get integer id of this Species.">id</a>();
<a name="l00264"></a>00264             out &lt;&lt; <a class="code" href="classUtil_1_1Int.html" title="Wrapper for an int, for formatted ostream output.">Int</a>(iSpecies,8) &lt;&lt; <a class="code" href="classUtil_1_1Int.html" title="Wrapper for an int, for formatted ostream output.">Int</a>(iMolecule,8) &lt;&lt; <a class="code" href="classUtil_1_1Int.html" title="Wrapper for an int, for formatted ostream output.">Int</a>(iAtom,8);
<a name="l00265"></a>00265             out &lt;&lt; <span class="stringliteral">&quot;   &quot;</span>;
<a name="l00266"></a>00266 
<a name="l00267"></a>00267             <span class="comment">// Output species, molecule, atom ids for atom 1</span>
<a name="l00268"></a>00268             atomPtr   = &amp;(linkPtr-&gt;<a class="code" href="classMcMd_1_1Link.html#af638a0ca7c5ec545d7af4ea976d61e18" title="Get Atom1 connected to a Link.">atom1</a>());
<a name="l00269"></a>00269             molPtr    = &amp;atomPtr-&gt;<a class="code" href="classMcMd_1_1Atom.html#a6c1e500fe698dc9ede1e58c261005304" title="Get the parent Molecule by reference.">molecule</a>();
<a name="l00270"></a>00270             iAtom     = atomPtr-&gt;<a class="code" href="classMcMd_1_1Atom.html#ad051dc3ce9d5a8535f03936e021a8e9c" title="Get local index for this Atom within the parent molecule;.">indexInMolecule</a>();
<a name="l00271"></a>00271             iMolecule = <a class="code" href="classMcMd_1_1ConfigIo.html#a3f20f914433938f289522c221751c5aa" title="Get a reference to the parent System.">system</a>().<a class="code" href="classMcMd_1_1System.html#a4dec0edee931590acc04de732c4dce33" title="Get the index of a Molecule within its Species in this System.">moleculeId</a>(*molPtr);
<a name="l00272"></a>00272             iSpecies  = molPtr-&gt;<a class="code" href="classMcMd_1_1Molecule.html#a70de9b3e9ce956c9597c28f36303b40d" title="Get the molecular Species by reference.">species</a>().<a class="code" href="classMcMd_1_1Species.html#acae83456c3717805ab81869e47c58614" title="Get integer id of this Species.">id</a>();
<a name="l00273"></a>00273             out &lt;&lt; Int(iSpecies,8) &lt;&lt; Int(iMolecule,8) &lt;&lt; Int(iAtom,8);
<a name="l00274"></a>00274             out &lt;&lt; <span class="stringliteral">&quot;   &quot;</span>;
<a name="l00275"></a>00275 
<a name="l00276"></a>00276             out &lt;&lt; Int(linkPtr-&gt;<a class="code" href="classMcMd_1_1Link.html#a5594032e6b1961e7c0ed53cfcc407b49" title="Get the typeId for this Link.">typeId</a>(),8) &lt;&lt; std::endl;
<a name="l00277"></a>00277          }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279       }
<a name="l00280"></a>00280 <span class="preprocessor">      #endif</span>
<a name="l00281"></a>00281 <span class="preprocessor"></span>
<a name="l00282"></a>00282    }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 } 
</pre></div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.3-->
<!-- start footer part -->


<hr class="footer"/><address class="footer"><small>
Generated on Mon Dec 1 2014 21:47:58 for Simpatico by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
