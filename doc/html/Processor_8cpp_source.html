<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Simpatico: Processor.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Simpatico
   &#160;<span id="projectnumber">v1.10</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Processor.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">* Simpatico - Simulation Package for Polymeric and Molecular Liquids</span>
<a name="l00003"></a>00003 <span class="comment">*</span>
<a name="l00004"></a>00004 <span class="comment">* Copyright 2010 - 2014, The Regents of the University of Minnesota</span>
<a name="l00005"></a>00005 <span class="comment">* Distributed under the terms of the GNU General Public License.</span>
<a name="l00006"></a>00006 <span class="comment">*/</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="preprocessor">#include &quot;Processor.h&quot;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;tools/config/DdMdConfigReader.h&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;tools/config/DdMdConfigWriter.h&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;tools/trajectory/LammpsDumpReader.h&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;util/format/Str.h&gt;</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="comment">// std headers</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="keyword">namespace </span>Tools 
<a name="l00020"></a>00020 {
<a name="l00021"></a>00021 
<a name="l00022"></a>00022    <span class="comment">/*</span>
<a name="l00023"></a>00023 <span class="comment">   * Constructor.</span>
<a name="l00024"></a>00024 <span class="comment">   */</span>
<a name="l00025"></a><a class="code" href="classTools_1_1Processor.html#ab4a4137f4f25c0f96eebae64e3b868e8">00025</a>    <a class="code" href="classTools_1_1Processor.html#ab4a4137f4f25c0f96eebae64e3b868e8" title="Constructor.">Processor::Processor</a>()
<a name="l00026"></a>00026     : configReaderPtr_(0),
<a name="l00027"></a>00027       trajectoryReaderPtr_(0),
<a name="l00028"></a>00028       configReaderFactory_(*this),
<a name="l00029"></a>00029       configWriterFactory_(*this),
<a name="l00030"></a>00030       trajectoryReaderFactory_(*this),
<a name="l00031"></a>00031       analyzerManager_(*this)
<a name="l00032"></a>00032    {  <a class="code" href="classUtil_1_1ParamComposite.html#a30752567fd7b8b93e5c8476bbe8592c5" title="Set class name string.">setClassName</a>(<span class="stringliteral">&quot;Processor&quot;</span>); }
<a name="l00033"></a>00033 
<a name="l00034"></a>00034    <span class="comment">/*</span>
<a name="l00035"></a>00035 <span class="comment">   * Destructor.</span>
<a name="l00036"></a>00036 <span class="comment">   */</span>
<a name="l00037"></a><a class="code" href="classTools_1_1Processor.html#a57b9849b5dfe7a239d67588d2ebf1ff2">00037</a>    <a class="code" href="classTools_1_1Processor.html#a57b9849b5dfe7a239d67588d2ebf1ff2" title="Destructor.">Processor::~Processor</a>()
<a name="l00038"></a>00038    {
<a name="l00039"></a>00039       <span class="keywordflow">if</span> (configReaderPtr_) {
<a name="l00040"></a>00040          <span class="keyword">delete</span> configReaderPtr_;
<a name="l00041"></a>00041       }
<a name="l00042"></a>00042       <span class="keywordflow">if</span> (trajectoryReaderPtr_) {
<a name="l00043"></a>00043          <span class="keyword">delete</span> trajectoryReaderPtr_;
<a name="l00044"></a>00044       }
<a name="l00045"></a>00045    }
<a name="l00046"></a>00046 
<a name="l00047"></a>00047    <span class="comment">/*</span>
<a name="l00048"></a>00048 <span class="comment">   * Process command line options.</span>
<a name="l00049"></a>00049 <span class="comment">   */</span>
<a name="l00050"></a><a class="code" href="classTools_1_1Processor.html#ad7bd5ce04d3a6053e214b0b5de3eca0d">00050</a>    <span class="keywordtype">void</span> <a class="code" href="classTools_1_1Processor.html#ad7bd5ce04d3a6053e214b0b5de3eca0d" title="Process command line options.">Processor::setOptions</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * <span class="keyword">const</span> * argv)
<a name="l00051"></a>00051    {
<a name="l00052"></a>00052 
<a name="l00053"></a>00053       <span class="keywordtype">int</span> c;
<a name="l00054"></a>00054       opterr = 0;
<a name="l00055"></a>00055       <span class="keywordflow">while</span> ((c = getopt(argc, argv, <span class="stringliteral">&quot;ep:c:&quot;</span>)) != -1) {
<a name="l00056"></a>00056          <span class="keywordflow">switch</span> (c) {
<a name="l00057"></a>00057          <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>:
<a name="l00058"></a>00058            <a class="code" href="classUtil_1_1ParamComponent.html#add72ad7add98e0b90979ee2638c7468d" title="Enable or disable echoing for all subclasses of ParamComponent.">ParamComponent::setEcho</a>(<span class="keyword">true</span>);
<a name="l00059"></a>00059            <span class="keywordflow">break</span>;
<a name="l00060"></a>00060          <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:
<a name="l00061"></a>00061            fileMaster_.<a class="code" href="classUtil_1_1FileMaster.html#aaa8beea67ced5beb8f92d8bba48a6bae" title="Set the parameter file name.">setParamFileName</a>(std::string(optarg));
<a name="l00062"></a>00062            <span class="keywordflow">break</span>;
<a name="l00063"></a>00063          <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:
<a name="l00064"></a>00064            fileMaster_.<a class="code" href="classUtil_1_1FileMaster.html#ade669815f45d05b720302848be13a316" title="Set the command file name.">setCommandFileName</a>(std::string(optarg));
<a name="l00065"></a>00065            <span class="keywordflow">break</span>;
<a name="l00066"></a>00066          <span class="keywordflow">case</span> <span class="charliteral">&#39;?&#39;</span>:
<a name="l00067"></a>00067            <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot;Unknown option -&quot;</span> &lt;&lt; optopt &lt;&lt; std::endl;
<a name="l00068"></a>00068          }
<a name="l00069"></a>00069       }
<a name="l00070"></a>00070 
<a name="l00071"></a>00071    }
<a name="l00072"></a>00072 
<a name="l00073"></a>00073    <span class="comment">/*</span>
<a name="l00074"></a>00074 <span class="comment">   * Read default param file.</span>
<a name="l00075"></a>00075 <span class="comment">   */</span>
<a name="l00076"></a><a class="code" href="classTools_1_1Processor.html#ad0e390a25b80b05f3b01200969bd3a42">00076</a>    <span class="keywordtype">void</span> <a class="code" href="classTools_1_1Processor.html#ad0e390a25b80b05f3b01200969bd3a42" title="Read parameter file specified in command line.">Processor::readParam</a>()
<a name="l00077"></a>00077    {
<a name="l00078"></a>00078       <span class="keywordflow">if</span> (fileMaster_.<a class="code" href="classUtil_1_1FileMaster.html#af03b29b868aed38b1e94e5af0e6f4308" title="Return the param file name, if any.">paramFileName</a>().empty()) {
<a name="l00079"></a>00079          <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;Empty param file name&quot;</span>);
<a name="l00080"></a>00080       }
<a name="l00081"></a>00081       <a class="code" href="classTools_1_1Processor.html#ad0e390a25b80b05f3b01200969bd3a42" title="Read parameter file specified in command line.">readParam</a>(fileMaster_.<a class="code" href="classUtil_1_1FileMaster.html#aa6e2bee2242001a0eeadc50d1a0a3837" title="Get a default parameter stream by reference.">paramFile</a>());
<a name="l00082"></a>00082    }
<a name="l00083"></a>00083 
<a name="l00084"></a>00084    <span class="comment">/*</span>
<a name="l00085"></a>00085 <span class="comment">   * Open, read and close a parameter file.</span>
<a name="l00086"></a>00086 <span class="comment">   */</span>
<a name="l00087"></a><a class="code" href="classTools_1_1Processor.html#a25ed64756636b3520e6e109bbd264ca9">00087</a>    <span class="keywordtype">void</span> <a class="code" href="classTools_1_1Processor.html#ad0e390a25b80b05f3b01200969bd3a42" title="Read parameter file specified in command line.">Processor::readParam</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename)
<a name="l00088"></a>00088    {
<a name="l00089"></a>00089       std::ifstream in;
<a name="l00090"></a>00090       in.open(filename);
<a name="l00091"></a>00091       <a class="code" href="classTools_1_1Processor.html#ad0e390a25b80b05f3b01200969bd3a42" title="Read parameter file specified in command line.">readParam</a>(in);
<a name="l00092"></a>00092       in.close();
<a name="l00093"></a>00093    }
<a name="l00094"></a>00094 
<a name="l00095"></a>00095    <span class="comment">/*</span>
<a name="l00096"></a>00096 <span class="comment">   * Read parameters from file.</span>
<a name="l00097"></a>00097 <span class="comment">   */</span>
<a name="l00098"></a><a class="code" href="classTools_1_1Processor.html#a165d102673263d141dba344db8112f87">00098</a>    <span class="keywordtype">void</span> <a class="code" href="classTools_1_1Processor.html#a165d102673263d141dba344db8112f87" title="Read parameters.">Processor::readParameters</a>(std::istream&amp; in)
<a name="l00099"></a>00099    {
<a name="l00100"></a>00100       <a class="code" href="classTools_1_1Processor.html#a165d102673263d141dba344db8112f87" title="Read parameters.">Configuration::readParameters</a>(in);
<a name="l00101"></a>00101       <a class="code" href="classUtil_1_1ParamComposite.html#ac7f91287ff57b0cd8180b9ac18c4368d" title="Add and attempt to read an optional child ParamComposite.">readParamCompositeOptional</a>(in, fileMaster_);
<a name="l00102"></a>00102       <a class="code" href="classUtil_1_1ParamComposite.html#ab2372dcc5d7d8db632b2b9844caf206e" title="Add and read a required child ParamComposite.">readParamComposite</a>(in, analyzerManager_);
<a name="l00103"></a>00103    }
<a name="l00104"></a>00104 
<a name="l00105"></a>00105    <span class="comment">/*</span>
<a name="l00106"></a>00106 <span class="comment">   * Read and execute commands from default command file.</span>
<a name="l00107"></a>00107 <span class="comment">   */</span>
<a name="l00108"></a><a class="code" href="classTools_1_1Processor.html#ac9e90e9b8378d0be0ef382a00b6cc0c9">00108</a>    <span class="keywordtype">void</span> <a class="code" href="classTools_1_1Processor.html#ac9e90e9b8378d0be0ef382a00b6cc0c9" title="Read command file specified in command line.">Processor::readCommands</a>()
<a name="l00109"></a>00109    {
<a name="l00110"></a>00110       <span class="keywordflow">if</span> (fileMaster_.<a class="code" href="classUtil_1_1FileMaster.html#a55bbc32b27ba7a7a16926c63edea6dcd" title="Return the command file name.">commandFileName</a>().empty()) {
<a name="l00111"></a>00111          <span class="comment">// Read from standard input if no command file name is set</span>
<a name="l00112"></a>00112          <a class="code" href="classTools_1_1Processor.html#ac9e90e9b8378d0be0ef382a00b6cc0c9" title="Read command file specified in command line.">readCommands</a>(std::cin);
<a name="l00113"></a>00113       } <span class="keywordflow">else</span> {
<a name="l00114"></a>00114          <a class="code" href="classTools_1_1Processor.html#ac9e90e9b8378d0be0ef382a00b6cc0c9" title="Read command file specified in command line.">readCommands</a>(fileMaster_.<a class="code" href="classUtil_1_1FileMaster.html#a4dfc5422ef408b9ea55f011dd298a9d2" title="Get the command input stream by reference.">commandFile</a>());
<a name="l00115"></a>00115       }
<a name="l00116"></a>00116    }
<a name="l00117"></a>00117 
<a name="l00118"></a>00118    <span class="comment">/*</span>
<a name="l00119"></a>00119 <span class="comment">   * Read and execute commands from a specified command file.</span>
<a name="l00120"></a>00120 <span class="comment">   */</span>
<a name="l00121"></a><a class="code" href="classTools_1_1Processor.html#ad509be5281c3a220efc49ef8dc4fe13a">00121</a>    <span class="keywordtype">void</span> <a class="code" href="classTools_1_1Processor.html#ac9e90e9b8378d0be0ef382a00b6cc0c9" title="Read command file specified in command line.">Processor::readCommands</a>(std::istream &amp;in)
<a name="l00122"></a>00122    {
<a name="l00123"></a>00123       std::string command;
<a name="l00124"></a>00124       std::string filename;
<a name="l00125"></a>00125       std::ifstream inputFile;
<a name="l00126"></a>00126       std::ofstream outputFile;
<a name="l00127"></a>00127 
<a name="l00128"></a>00128       <span class="keywordtype">bool</span> readNext = <span class="keyword">true</span>;
<a name="l00129"></a>00129       <span class="keywordflow">while</span> (readNext) {
<a name="l00130"></a>00130 
<a name="l00131"></a>00131          in &gt;&gt; command;
<a name="l00132"></a>00132          <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; command;
<a name="l00133"></a>00133 
<a name="l00134"></a>00134          <span class="keywordflow">if</span> (command == <span class="stringliteral">&quot;FINISH&quot;</span>) {
<a name="l00135"></a>00135             <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; std::endl;
<a name="l00136"></a>00136             readNext = <span class="keyword">false</span>;
<a name="l00137"></a>00137          } <span class="keywordflow">else</span>
<a name="l00138"></a>00138          <span class="keywordflow">if</span> (command == <span class="stringliteral">&quot;SET_CONFIG_READER&quot;</span>) {
<a name="l00139"></a>00139             std::string classname;
<a name="l00140"></a>00140             in &gt;&gt; classname;
<a name="l00141"></a>00141             <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; classname &lt;&lt; std::endl;
<a name="l00142"></a>00142             <a class="code" href="classTools_1_1Processor.html#a0d1df492e63e90a75a69df3ce0037377" title="Set ConfigReader style (creates a ConfigReader).">setConfigReader</a>(classname);
<a name="l00143"></a>00143          } <span class="keywordflow">else</span>
<a name="l00144"></a>00144          <span class="keywordflow">if</span> (command == <span class="stringliteral">&quot;READ_CONFIG&quot;</span>) {
<a name="l00145"></a>00145 
<a name="l00146"></a>00146             <span class="comment">// If needed, read auxiliary file</span>
<a name="l00147"></a>00147             <span class="keywordflow">if</span> (<a class="code" href="classTools_1_1Processor.html#a6c4f8606a630c816fb6b2c02b456deb8" title="Return the current ConfigReader (create default if necessary).">configReader</a>().needsAuxiliaryFile()) {
<a name="l00148"></a>00148                <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot;\nReading auxiliary file: &quot;</span>; 
<a name="l00149"></a>00149                in &gt;&gt; filename;
<a name="l00150"></a>00150                <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; filename;
<a name="l00151"></a>00151                fileMaster_.<a class="code" href="classUtil_1_1FileMaster.html#a2bf65e41c81f3d341759f8e1c329409d" title="Open an input file.">openInputFile</a>(filename, inputFile);
<a name="l00152"></a>00152                <a class="code" href="classTools_1_1Processor.html#a6c4f8606a630c816fb6b2c02b456deb8" title="Return the current ConfigReader (create default if necessary).">configReader</a>().<a class="code" href="classTools_1_1ConfigReader.html#a841cd4bdf98d5a762b296b53fb1b2bbb" title="Read auxiliary file.">readAuxiliaryFile</a>(inputFile);
<a name="l00153"></a>00153                inputFile.close();
<a name="l00154"></a>00154             }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156             <span class="comment">// Read actual configuration file</span>
<a name="l00157"></a>00157             <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot;\nReading config file: &quot;</span>;
<a name="l00158"></a>00158             in &gt;&gt; filename;
<a name="l00159"></a>00159             <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; filename &lt;&lt; std::endl;
<a name="l00160"></a>00160             fileMaster_.<a class="code" href="classUtil_1_1FileMaster.html#a2bf65e41c81f3d341759f8e1c329409d" title="Open an input file.">openInputFile</a>(filename, inputFile);
<a name="l00161"></a>00161             <a class="code" href="classTools_1_1Processor.html#a6c4f8606a630c816fb6b2c02b456deb8" title="Return the current ConfigReader (create default if necessary).">configReader</a>().<a class="code" href="classTools_1_1ConfigReader.html#a744efe51f77686d14c60ea8ae9a02a58" title="Read a configuration file.">readConfig</a>(inputFile);
<a name="l00162"></a>00162             inputFile.close();
<a name="l00163"></a>00163 
<a name="l00164"></a>00164          } <span class="keywordflow">else</span>
<a name="l00165"></a>00165          <span class="keywordflow">if</span> (command == <span class="stringliteral">&quot;SET_CONFIG_WRITER&quot;</span>) {
<a name="l00166"></a>00166             std::string classname;
<a name="l00167"></a>00167             in &gt;&gt; classname;
<a name="l00168"></a>00168             <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; classname &lt;&lt; std::endl;
<a name="l00169"></a>00169             <a class="code" href="classTools_1_1Processor.html#af442dda60f1bf734ccfa29e3009c875e" title="Set ConfigWriter style (creates a ConfigWriter).">setConfigWriter</a>(classname);
<a name="l00170"></a>00170          } <span class="keywordflow">else</span>
<a name="l00171"></a>00171          <span class="keywordflow">if</span> (command == <span class="stringliteral">&quot;WRITE_CONFIG&quot;</span>) {
<a name="l00172"></a>00172             <span class="keywordflow">if</span> (<a class="code" href="classTools_1_1Processor.html#afad4736ec69be345e50111b335baf47f" title="Return the current ConfigWriter (create default if necessary).">configWriter</a>().needsAuxiliaryFile()) {
<a name="l00173"></a>00173                <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot;\nReading auxiliary file: &quot;</span>;
<a name="l00174"></a>00174                in &gt;&gt; filename;
<a name="l00175"></a>00175                <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; filename;
<a name="l00176"></a>00176                fileMaster_.<a class="code" href="classUtil_1_1FileMaster.html#a2bf65e41c81f3d341759f8e1c329409d" title="Open an input file.">openInputFile</a>(filename, inputFile);
<a name="l00177"></a>00177                <a class="code" href="classTools_1_1Processor.html#afad4736ec69be345e50111b335baf47f" title="Return the current ConfigWriter (create default if necessary).">configWriter</a>().<a class="code" href="classTools_1_1ConfigWriter.html#a2a846726cd66c43bd08d6492b0013ed5" title="Read auxiliary file (empty default implementation).">readAuxiliaryFile</a>(inputFile);
<a name="l00178"></a>00178                inputFile.close();
<a name="l00179"></a>00179             }
<a name="l00180"></a>00180             <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot;\nWriting config file: &quot;</span>;
<a name="l00181"></a>00181             in &gt;&gt; filename;
<a name="l00182"></a>00182             <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; filename &lt;&lt; std::endl;
<a name="l00183"></a>00183             fileMaster_.<a class="code" href="classUtil_1_1FileMaster.html#a9ec33e9117a760a09b294b47b0d80ad9" title="Open an output file.">openOutputFile</a>(filename, outputFile);
<a name="l00184"></a>00184             <a class="code" href="classTools_1_1Processor.html#afad4736ec69be345e50111b335baf47f" title="Return the current ConfigWriter (create default if necessary).">configWriter</a>().<a class="code" href="classTools_1_1ConfigWriter.html#a2190ff93ac0809a7d109ad80ffc2c612" title="Write configuration file.">writeConfig</a>(outputFile);
<a name="l00185"></a>00185             outputFile.close();
<a name="l00186"></a>00186          } <span class="keywordflow">else</span>
<a name="l00187"></a>00187          <span class="keywordflow">if</span> (command == <span class="stringliteral">&quot;SET_TRAJECTORY_READER&quot;</span>) {
<a name="l00188"></a>00188             std::string classname;
<a name="l00189"></a>00189             in &gt;&gt; classname;
<a name="l00190"></a>00190             <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; classname &lt;&lt; std::endl;
<a name="l00191"></a>00191             <a class="code" href="classTools_1_1Processor.html#ab3050e9b0c047e75bd1749c0efc1b80e" title="Set TrajectoryReader style (creates a TrajectoryReader).">setTrajectoryReader</a>(classname);
<a name="l00192"></a>00192          } <span class="keywordflow">else</span>
<a name="l00193"></a>00193          <span class="keywordflow">if</span> (command == <span class="stringliteral">&quot;ANALYZE_TRAJECTORY&quot;</span>) {
<a name="l00194"></a>00194             in &gt;&gt; filename;
<a name="l00195"></a>00195             <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; filename &lt;&lt; std::endl;
<a name="l00196"></a>00196             <a class="code" href="classTools_1_1Processor.html#a095dc7b569a8ae0e1ba2aa7822a503a3" title="Open, read, analyze and close a single trajectory file.">analyzeTrajectory</a>(filename);
<a name="l00197"></a>00197          } <span class="keywordflow">else</span> 
<a name="l00198"></a>00198          {
<a name="l00199"></a>00199             <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot;  Error: Unknown command  &quot;</span> &lt;&lt; std::endl;
<a name="l00200"></a>00200             readNext = <span class="keyword">false</span>;
<a name="l00201"></a>00201          }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203       }
<a name="l00204"></a>00204    }
<a name="l00205"></a>00205 
<a name="l00206"></a>00206    <span class="comment">// ConfigReader Functions</span>
<a name="l00207"></a>00207 
<a name="l00208"></a>00208    <span class="comment">/*</span>
<a name="l00209"></a>00209 <span class="comment">   * Set ConfigReader style.</span>
<a name="l00210"></a>00210 <span class="comment">   */</span>
<a name="l00211"></a><a class="code" href="classTools_1_1Processor.html#a0d1df492e63e90a75a69df3ce0037377">00211</a>    <span class="keywordtype">void</span> <a class="code" href="classTools_1_1Processor.html#a0d1df492e63e90a75a69df3ce0037377" title="Set ConfigReader style (creates a ConfigReader).">Processor::setConfigReader</a>(<span class="keyword">const</span> std::string&amp; configStyle)
<a name="l00212"></a>00212    {
<a name="l00213"></a>00213       configReaderPtr_ = configReaderFactory_.<a class="code" href="classTools_1_1ConfigReaderFactory.html#a247ad89a8e5cf663b834c2f4ce6114c9" title="Create an instance of a specified subclass of ConfigReader.">factory</a>(configStyle);
<a name="l00214"></a>00214       <span class="keywordflow">if</span> (configReaderPtr_ == 0) {
<a name="l00215"></a>00215          std::string msg;
<a name="l00216"></a>00216          msg = <span class="stringliteral">&quot;Unrecognized ConfigReader subclass name: &quot;</span>;
<a name="l00217"></a>00217          msg += configStyle;
<a name="l00218"></a>00218          <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(msg.c_str());
<a name="l00219"></a>00219       }
<a name="l00220"></a>00220       <span class="comment">// Log::file() &lt;&lt; &quot;Setting config reader to class &quot;</span>
<a name="l00221"></a>00221       <span class="comment">//            &lt;&lt; configReaderPtr_-&gt;className() &lt;&lt; std::endl;</span>
<a name="l00222"></a>00222    }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224    <span class="comment">/*</span>
<a name="l00225"></a>00225 <span class="comment">   * Return the ConfigReader (create default if necessary).</span>
<a name="l00226"></a>00226 <span class="comment">   */</span>
<a name="l00227"></a><a class="code" href="classTools_1_1Processor.html#a6c4f8606a630c816fb6b2c02b456deb8">00227</a>    <a class="code" href="classTools_1_1ConfigReader.html" title="Abstract reader/writer for configuration files.">ConfigReader</a>&amp; <a class="code" href="classTools_1_1Processor.html#a6c4f8606a630c816fb6b2c02b456deb8" title="Return the current ConfigReader (create default if necessary).">Processor::configReader</a>() 
<a name="l00228"></a>00228    {
<a name="l00229"></a>00229       <span class="keywordflow">if</span> (configReaderPtr_ == 0) {
<a name="l00230"></a>00230          configReaderPtr_ = <span class="keyword">new</span> <a class="code" href="classTools_1_1DdMdConfigReader.html" title="Native / default DdMd format for configuration files.">DdMdConfigReader</a>(*<span class="keyword">this</span>);
<a name="l00231"></a>00231          assert(configReaderPtr_);
<a name="l00232"></a>00232       }
<a name="l00233"></a>00233       <span class="keywordflow">return</span> *configReaderPtr_;
<a name="l00234"></a>00234    }
<a name="l00235"></a>00235 
<a name="l00236"></a>00236    <span class="comment">/*</span>
<a name="l00237"></a>00237 <span class="comment">   * Read a single configuration file.</span>
<a name="l00238"></a>00238 <span class="comment">   */</span>
<a name="l00239"></a><a class="code" href="classTools_1_1Processor.html#a36a18c66945912234b5543e756354e71">00239</a>    <span class="keywordtype">void</span> <a class="code" href="classTools_1_1Processor.html#a36a18c66945912234b5543e756354e71" title="Read a single configuration file.">Processor::readConfig</a>(std::ifstream&amp; in)
<a name="l00240"></a>00240    {
<a name="l00241"></a>00241       <a class="code" href="classTools_1_1Configuration.html#a00649731fd23eaa63ef05383ea5e6543" title="Clear all atoms and groups.">clear</a>();  
<a name="l00242"></a>00242       <a class="code" href="classTools_1_1Processor.html#a6c4f8606a630c816fb6b2c02b456deb8" title="Return the current ConfigReader (create default if necessary).">configReader</a>().<a class="code" href="classTools_1_1ConfigReader.html#a744efe51f77686d14c60ea8ae9a02a58" title="Read a configuration file.">readConfig</a>(in); 
<a name="l00243"></a>00243    }
<a name="l00244"></a>00244 
<a name="l00245"></a>00245    <span class="comment">/*</span>
<a name="l00246"></a>00246 <span class="comment">   * Open, read and close a configuration file.</span>
<a name="l00247"></a>00247 <span class="comment">   */</span>
<a name="l00248"></a><a class="code" href="classTools_1_1Processor.html#ab521c62d5948fa14e39faffa68cfcd54">00248</a>    <span class="keywordtype">void</span> <a class="code" href="classTools_1_1Processor.html#a36a18c66945912234b5543e756354e71" title="Read a single configuration file.">Processor::readConfig</a>(<span class="keyword">const</span> std::string&amp; filename)
<a name="l00249"></a>00249    { 
<a name="l00250"></a>00250       std::ifstream file;
<a name="l00251"></a>00251       file.open(filename.c_str());
<a name="l00252"></a>00252       <a class="code" href="classTools_1_1Processor.html#a36a18c66945912234b5543e756354e71" title="Read a single configuration file.">readConfig</a>(file);
<a name="l00253"></a>00253       file.close();
<a name="l00254"></a>00254    }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256    <span class="comment">/*</span>
<a name="l00257"></a>00257 <span class="comment">   * Read and analyze a sequence of configuration files.</span>
<a name="l00258"></a>00258 <span class="comment">   */</span>
<a name="l00259"></a><a class="code" href="classTools_1_1Processor.html#a181a808f3f01201c436a06d05293a8e3">00259</a>    <span class="keywordtype">void</span> <a class="code" href="classTools_1_1Processor.html#a181a808f3f01201c436a06d05293a8e3" title="Read and analyze a sequence of numbered configuration files.">Processor::analyzeConfigs</a>(<span class="keyword">const</span> std::string&amp; baseFileName,
<a name="l00260"></a>00260                                   <span class="keywordtype">int</span> min, <span class="keywordtype">int</span> max, <span class="keywordtype">int</span> interval)
<a name="l00261"></a>00261    {
<a name="l00262"></a>00262       <span class="comment">// Preconditions</span>
<a name="l00263"></a>00263       <span class="keywordflow">if</span> (min &lt; 0)    <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;min &lt; 0&quot;</span>);
<a name="l00264"></a>00264       <span class="keywordflow">if</span> (max &lt; min)  <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;max &lt; min&quot;</span>);
<a name="l00265"></a>00265       <span class="keywordflow">if</span> (interval &lt;= 0)  <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(<span class="stringliteral">&quot;interval &lt;= 0&quot;</span>);
<a name="l00266"></a>00266 
<a name="l00267"></a>00267       <span class="comment">//Timer timer;</span>
<a name="l00268"></a>00268       std::string filename;
<a name="l00269"></a>00269       std::stringstream indexString;
<a name="l00270"></a>00270       std::ifstream configFile;
<a name="l00271"></a>00271 
<a name="l00272"></a>00272       <span class="comment">// Main loop</span>
<a name="l00273"></a>00273       <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot;begin main loop&quot;</span> &lt;&lt; std::endl;
<a name="l00274"></a>00274       <span class="comment">//timer.start();</span>
<a name="l00275"></a>00275       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iStep = min; iStep &lt;= max; iStep += interval) {
<a name="l00276"></a>00276 
<a name="l00277"></a>00277          indexString &lt;&lt; iStep;
<a name="l00278"></a>00278          filename = baseFileName;
<a name="l00279"></a>00279          filename += indexString.str();
<a name="l00280"></a>00280          configFile.open(filename.c_str());
<a name="l00281"></a>00281          <span class="keywordflow">if</span> (!configFile.is_open()) {
<a name="l00282"></a>00282             std::string msg = <span class="stringliteral">&quot;Configuration file is not open. Filename =&quot;</span>;
<a name="l00283"></a>00283             msg += filename;
<a name="l00284"></a>00284             <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(msg.c_str());
<a name="l00285"></a>00285          }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287          <span class="comment">// Clear the stringstream</span>
<a name="l00288"></a>00288          indexString.str(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00289"></a>00289 
<a name="l00290"></a>00290          <a class="code" href="classTools_1_1Configuration.html#a00649731fd23eaa63ef05383ea5e6543" title="Clear all atoms and groups.">clear</a>();
<a name="l00291"></a>00291          <a class="code" href="classTools_1_1Processor.html#a36a18c66945912234b5543e756354e71" title="Read a single configuration file.">readConfig</a>(configFile);
<a name="l00292"></a>00292          configFile.close();
<a name="l00293"></a>00293 
<a name="l00294"></a>00294 <span class="preprocessor">         #if 0</span>
<a name="l00295"></a>00295 <span class="preprocessor"></span><span class="preprocessor">         #ifndef INTER_NOPAIR</span>
<a name="l00296"></a>00296 <span class="preprocessor"></span>         <span class="comment">// Build the configuration CellList</span>
<a name="l00297"></a>00297          pairPotential().buildCellList();
<a name="l00298"></a>00298 <span class="preprocessor">         #endif</span>
<a name="l00299"></a>00299 <span class="preprocessor"></span>
<a name="l00300"></a>00300 <span class="preprocessor">         #ifdef UTIL_DEBUG</span>
<a name="l00301"></a>00301 <span class="preprocessor"></span>         isValid();
<a name="l00302"></a>00302 <span class="preprocessor">         #endif</span>
<a name="l00303"></a>00303 <span class="preprocessor"></span><span class="preprocessor">         #endif</span>
<a name="l00304"></a>00304 <span class="preprocessor"></span>
<a name="l00305"></a>00305          <span class="comment">// Initialize analyzers (taking in molecular information).</span>
<a name="l00306"></a>00306          <span class="keywordflow">if</span> (iStep == min) {
<a name="l00307"></a>00307             analyzerManager_.<a class="code" href="classTools_1_1AnalyzerManager.html#a1198e37134ced82259c66b78375f33ce" title="Call setup method of each Analyzer.">setup</a>();
<a name="l00308"></a>00308          }
<a name="l00309"></a>00309 
<a name="l00310"></a>00310          <span class="comment">// Sample property values</span>
<a name="l00311"></a>00311          analyzerManager_.<a class="code" href="classTools_1_1AnalyzerManager.html#a187d559047a40bf155c8c8616b5f6899" title="Call sample method of each Analyzer, if scheduled.">sample</a>(iStep);
<a name="l00312"></a>00312 
<a name="l00313"></a>00313       }
<a name="l00314"></a>00314       <span class="comment">//timer.stop();</span>
<a name="l00315"></a>00315       <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot;end main loop&quot;</span> &lt;&lt; std::endl;
<a name="l00316"></a>00316 
<a name="l00317"></a>00317       <span class="comment">// Output results of all analyzers to output files</span>
<a name="l00318"></a>00318       analyzerManager_.<a class="code" href="classTools_1_1AnalyzerManager.html#a8b53f9eb8dde328fb53ece3ad0de111a" title="Call output method of each analyzer.">output</a>();
<a name="l00319"></a>00319 
<a name="l00320"></a>00320    }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322    <span class="comment">// ConfigWriter Functions</span>
<a name="l00323"></a>00323 
<a name="l00324"></a>00324    <span class="comment">/*</span>
<a name="l00325"></a>00325 <span class="comment">   * Set ConfigWriter style.</span>
<a name="l00326"></a>00326 <span class="comment">   */</span>
<a name="l00327"></a><a class="code" href="classTools_1_1Processor.html#af442dda60f1bf734ccfa29e3009c875e">00327</a>    <span class="keywordtype">void</span> <a class="code" href="classTools_1_1Processor.html#af442dda60f1bf734ccfa29e3009c875e" title="Set ConfigWriter style (creates a ConfigWriter).">Processor::setConfigWriter</a>(<span class="keyword">const</span> std::string&amp; configStyle)
<a name="l00328"></a>00328    {
<a name="l00329"></a>00329       configWriterPtr_ = configWriterFactory_.<a class="code" href="classTools_1_1ConfigWriterFactory.html#aae4b2a5cb555b94c54f42b2942464a2c" title="Create an instance of a specified subclass of ConfigWriter.">factory</a>(configStyle);
<a name="l00330"></a>00330       <span class="keywordflow">if</span> (configWriterPtr_ == 0) {
<a name="l00331"></a>00331          std::string msg;
<a name="l00332"></a>00332          msg = <span class="stringliteral">&quot;Unrecognized ConfigWriter subclass name: &quot;</span>;
<a name="l00333"></a>00333          msg += configStyle;
<a name="l00334"></a>00334          <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(msg.c_str());
<a name="l00335"></a>00335       }
<a name="l00336"></a>00336    }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338    <span class="comment">/*</span>
<a name="l00339"></a>00339 <span class="comment">   * Return the ConfigWriter (create default if necessary).</span>
<a name="l00340"></a>00340 <span class="comment">   */</span>
<a name="l00341"></a><a class="code" href="classTools_1_1Processor.html#afad4736ec69be345e50111b335baf47f">00341</a>    <a class="code" href="classTools_1_1ConfigWriter.html" title="Abstract reader/writer for configuration files.">ConfigWriter</a>&amp; <a class="code" href="classTools_1_1Processor.html#afad4736ec69be345e50111b335baf47f" title="Return the current ConfigWriter (create default if necessary).">Processor::configWriter</a>() 
<a name="l00342"></a>00342    {
<a name="l00343"></a>00343       <span class="keywordflow">if</span> (configWriterPtr_ == 0) {
<a name="l00344"></a>00344          configWriterPtr_ = <span class="keyword">new</span> <a class="code" href="classTools_1_1DdMdConfigWriter.html" title="Native / default DdMd format for configuration files.">DdMdConfigWriter</a>(*<span class="keyword">this</span>);
<a name="l00345"></a>00345          assert(configWriterPtr_);
<a name="l00346"></a>00346       }
<a name="l00347"></a>00347       <span class="keywordflow">return</span> *configWriterPtr_;
<a name="l00348"></a>00348    }
<a name="l00349"></a>00349 
<a name="l00350"></a>00350    <span class="comment">/*</span>
<a name="l00351"></a>00351 <span class="comment">   * Read a configuration file.</span>
<a name="l00352"></a>00352 <span class="comment">   */</span>
<a name="l00353"></a><a class="code" href="classTools_1_1Processor.html#a40e08ff508c07555e7b604811f6cbbd4">00353</a>    <span class="keywordtype">void</span> <a class="code" href="classTools_1_1Processor.html#a40e08ff508c07555e7b604811f6cbbd4" title="Write a single configuration file.">Processor::writeConfig</a>(std::ofstream&amp; in)
<a name="l00354"></a>00354    {  <a class="code" href="classTools_1_1Processor.html#afad4736ec69be345e50111b335baf47f" title="Return the current ConfigWriter (create default if necessary).">configWriter</a>().<a class="code" href="classTools_1_1ConfigWriter.html#a2190ff93ac0809a7d109ad80ffc2c612" title="Write configuration file.">writeConfig</a>(in); }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356    <span class="comment">/*</span>
<a name="l00357"></a>00357 <span class="comment">   * Open, write and close a configuration file.</span>
<a name="l00358"></a>00358 <span class="comment">   */</span>
<a name="l00359"></a><a class="code" href="classTools_1_1Processor.html#a9e4403c55a074a6ae33451c8d718dbb4">00359</a>    <span class="keywordtype">void</span> <a class="code" href="classTools_1_1Processor.html#a40e08ff508c07555e7b604811f6cbbd4" title="Write a single configuration file.">Processor::writeConfig</a>(<span class="keyword">const</span> std::string&amp; filename)
<a name="l00360"></a>00360    { 
<a name="l00361"></a>00361       std::ofstream file;
<a name="l00362"></a>00362       file.open(filename.c_str());
<a name="l00363"></a>00363       <a class="code" href="classTools_1_1Processor.html#a40e08ff508c07555e7b604811f6cbbd4" title="Write a single configuration file.">writeConfig</a>(file);
<a name="l00364"></a>00364       file.close();
<a name="l00365"></a>00365    }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367    <span class="comment">// Trajectory Analysis</span>
<a name="l00368"></a>00368 
<a name="l00369"></a>00369    <span class="comment">/*</span>
<a name="l00370"></a>00370 <span class="comment">   * Set TrajectoryReader style.</span>
<a name="l00371"></a>00371 <span class="comment">   */</span>
<a name="l00372"></a><a class="code" href="classTools_1_1Processor.html#ab3050e9b0c047e75bd1749c0efc1b80e">00372</a>    <span class="keywordtype">void</span> <a class="code" href="classTools_1_1Processor.html#ab3050e9b0c047e75bd1749c0efc1b80e" title="Set TrajectoryReader style (creates a TrajectoryReader).">Processor::setTrajectoryReader</a>(<span class="keyword">const</span> std::string&amp; trajectoryStyle)
<a name="l00373"></a>00373    {
<a name="l00374"></a>00374       trajectoryReaderPtr_ = 
<a name="l00375"></a>00375                       trajectoryReaderFactory_.<a class="code" href="classTools_1_1TrajectoryReaderFactory.html#a5e62f49020e61ada176e820290509b13" title="Create an instance of a specified subclass of TrajectoryReader.">factory</a>(trajectoryStyle);
<a name="l00376"></a>00376       <span class="keywordflow">if</span> (trajectoryReaderPtr_ == 0) {
<a name="l00377"></a>00377          std::string msg;
<a name="l00378"></a>00378          msg = <span class="stringliteral">&quot;Unrecognized TrajectoryReader subclass name: &quot;</span>;
<a name="l00379"></a>00379          msg += trajectoryStyle;
<a name="l00380"></a>00380          <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(msg.c_str());
<a name="l00381"></a>00381       }
<a name="l00382"></a>00382    }
<a name="l00383"></a>00383 
<a name="l00384"></a>00384    <span class="comment">/*</span>
<a name="l00385"></a>00385 <span class="comment">   * Return the TrajectoryReader (create default if necessary).</span>
<a name="l00386"></a>00386 <span class="comment">   */</span>
<a name="l00387"></a><a class="code" href="classTools_1_1Processor.html#a0c0b598312fe61fef104fa98c3b6cf1d">00387</a>    <a class="code" href="classTools_1_1TrajectoryReader.html" title="Abstract trajectory file reader.">TrajectoryReader</a>&amp; <a class="code" href="classTools_1_1Processor.html#a0c0b598312fe61fef104fa98c3b6cf1d" title="Return the current TrajectoryReader (create default if necessary).">Processor::trajectoryReader</a>() 
<a name="l00388"></a>00388    {
<a name="l00389"></a>00389       <span class="keywordflow">if</span> (trajectoryReaderPtr_ == 0) {
<a name="l00390"></a>00390          trajectoryReaderPtr_ = <span class="keyword">new</span> <a class="code" href="classTools_1_1LammpsDumpReader.html" title="Reader for lammps dump trajectory file format.">LammpsDumpReader</a>(*<span class="keyword">this</span>);
<a name="l00391"></a>00391          assert(trajectoryReaderPtr_);
<a name="l00392"></a>00392       }
<a name="l00393"></a>00393       <span class="keywordflow">return</span> *trajectoryReaderPtr_;
<a name="l00394"></a>00394    }
<a name="l00395"></a>00395 
<a name="l00396"></a>00396    <span class="comment">/*</span>
<a name="l00397"></a>00397 <span class="comment">   * Read and analyze a trajectory file.</span>
<a name="l00398"></a>00398 <span class="comment">   */</span>
<a name="l00399"></a><a class="code" href="classTools_1_1Processor.html#a095dc7b569a8ae0e1ba2aa7822a503a3">00399</a>    <span class="keywordtype">void</span> <a class="code" href="classTools_1_1Processor.html#a095dc7b569a8ae0e1ba2aa7822a503a3" title="Open, read, analyze and close a single trajectory file.">Processor::analyzeTrajectory</a>(<span class="keyword">const</span> std::string&amp; filename)
<a name="l00400"></a>00400    {
<a name="l00401"></a>00401 
<a name="l00402"></a>00402       <span class="comment">// Open file</span>
<a name="l00403"></a>00403       std::ifstream file;
<a name="l00404"></a>00404       <span class="keywordflow">if</span> (<a class="code" href="classTools_1_1Processor.html#a0c0b598312fe61fef104fa98c3b6cf1d" title="Return the current TrajectoryReader (create default if necessary).">trajectoryReader</a>().isBinary()) {
<a name="l00405"></a>00405          fileMaster_.<a class="code" href="classUtil_1_1FileMaster.html#a2bf65e41c81f3d341759f8e1c329409d" title="Open an input file.">openInputFile</a>(filename, file,
<a name="l00406"></a>00406                                     std::ios::in | std::ios::binary);
<a name="l00407"></a>00407       } <span class="keywordflow">else</span> {
<a name="l00408"></a>00408          fileMaster_.<a class="code" href="classUtil_1_1FileMaster.html#a2bf65e41c81f3d341759f8e1c329409d" title="Open an input file.">openInputFile</a>(filename, file);
<a name="l00409"></a>00409       }
<a name="l00410"></a>00410       <span class="keywordflow">if</span> (!file.is_open()) {
<a name="l00411"></a>00411          std::string msg = <span class="stringliteral">&quot;Trajectory file is not open. Filename =&quot;</span>;
<a name="l00412"></a>00412          msg += filename;
<a name="l00413"></a>00413          <a class="code" href="global_8h.html#ad2512f8bd062d41d66799cf900151487" title="Macro for throwing an Exception, reporting function, file and line number.">UTIL_THROW</a>(msg.c_str());
<a name="l00414"></a>00414       }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416       <span class="comment">// Initialize analyzers (taking in molecular information).</span>
<a name="l00417"></a>00417       analyzerManager_.<a class="code" href="classTools_1_1AnalyzerManager.html#a1198e37134ced82259c66b78375f33ce" title="Call setup method of each Analyzer.">setup</a>();
<a name="l00418"></a>00418 
<a name="l00419"></a>00419       <span class="comment">// Main loop</span>
<a name="l00420"></a>00420       <a class="code" href="classTools_1_1Processor.html#a0c0b598312fe61fef104fa98c3b6cf1d" title="Return the current TrajectoryReader (create default if necessary).">trajectoryReader</a>().<a class="code" href="classTools_1_1TrajectoryReader.html#a898dd09df64e22aa10ae7acabf7bb698" title="Read a header (if any).">readHeader</a>(file);
<a name="l00421"></a>00421       <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot;begin main loop&quot;</span> &lt;&lt; std::endl;
<a name="l00422"></a>00422       <span class="keywordtype">int</span> iStep = 0;
<a name="l00423"></a>00423       <span class="keywordtype">bool</span> notEnd = <span class="keyword">true</span>;
<a name="l00424"></a>00424       <span class="keywordflow">while</span> (notEnd) {
<a name="l00425"></a>00425          notEnd = <a class="code" href="classTools_1_1Processor.html#a0c0b598312fe61fef104fa98c3b6cf1d" title="Return the current TrajectoryReader (create default if necessary).">trajectoryReader</a>().<a class="code" href="classTools_1_1TrajectoryReader.html#a2cad1307e6f7146d9e55cf6e4240fbc5" title="Read a frame.">readFrame</a>(file);
<a name="l00426"></a>00426          <span class="keywordflow">if</span> (notEnd) {
<a name="l00427"></a>00427             analyzerManager_.<a class="code" href="classTools_1_1AnalyzerManager.html#a187d559047a40bf155c8c8616b5f6899" title="Call sample method of each Analyzer, if scheduled.">sample</a>(iStep);
<a name="l00428"></a>00428             ++iStep;
<a name="l00429"></a>00429          }
<a name="l00430"></a>00430       }
<a name="l00431"></a>00431       <a class="code" href="classUtil_1_1Log.html#a7b86f7c53e482f8f4a1a8b756c162817" title="Get log ostream by reference.">Log::file</a>() &lt;&lt; <span class="stringliteral">&quot;end main loop&quot;</span> &lt;&lt; std::endl;
<a name="l00432"></a>00432 
<a name="l00433"></a>00433       <span class="comment">// Output any final results of analyzers to output files</span>
<a name="l00434"></a>00434       analyzerManager_.<a class="code" href="classTools_1_1AnalyzerManager.html#a8b53f9eb8dde328fb53ece3ad0de111a" title="Call output method of each analyzer.">output</a>();
<a name="l00435"></a>00435 
<a name="l00436"></a>00436       file.close();
<a name="l00437"></a>00437    }
<a name="l00438"></a>00438 
<a name="l00439"></a>00439    <span class="comment">/*</span>
<a name="l00440"></a>00440 <span class="comment">   * Return FileMaster.</span>
<a name="l00441"></a>00441 <span class="comment">   */</span>
<a name="l00442"></a><a class="code" href="classTools_1_1Processor.html#a317c5df0fbcbc7581c79572b2501014d">00442</a>    <a class="code" href="classUtil_1_1FileMaster.html" title="A FileMaster manages input and output files for a simulation.">FileMaster</a>&amp; <a class="code" href="classTools_1_1Processor.html#a317c5df0fbcbc7581c79572b2501014d" title="Return FileMaster if active, or throw Exception.">Processor::fileMaster</a>()
<a name="l00443"></a>00443    {  <span class="keywordflow">return</span> fileMaster_; }
<a name="l00444"></a>00444 
<a name="l00445"></a>00445 }
</pre></div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.3-->
<!-- start footer part -->


<hr class="footer"/><address class="footer"><small>
Generated on Mon Dec 1 2014 21:48:00 for Simpatico by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
