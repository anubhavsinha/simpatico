<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Simpatico: 2.8 Restarting</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Simpatico
   &#160;<span id="projectnumber">v1.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="index.html">Simpatico - Simulation Package for Polymer and Molecular Liquids</a>      </li>
      <li class="navelem"><a class="el" href="user_page.html">2 User Guide</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">2.8 Restarting </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The -r command line option can be used to restart an mcSim or mdSim simulation from a binary restart file. This allows a user to either recover from a failure (caused, e.g., by a hardware failure or a wall-clock limit on a queue) or to continue a simulation that complete successfully.</p>
<p>A restart file preserves the full internal state of a simulation. This includes a great deal of information that is not preserved in a configuration file, including the internal state of statistical accumulators used by on-the-fly diagnostics, the internal state of some MD integrators that are based on an extended dynamical system (e.g., Nose-Hoover), and the state of the random number generator. It is designed to allow the simulation to continue as if had not been interrupted.</p>
<p>Thus far, it is only possible to restart mcSim and mdSim simulation. No analogous capabilty has been implemented yet for ddSim simulations. Parallel ddSim simulations can thus only be restarted from a configuration file, which preserves the physical state (boundary dimensions, and particle positions and velocities), but loses some internal state information.</p>
<h2><a class="anchor" id="user_restart_page_restart"></a>
Writing Restart Files</h2>
<p>For an mcSim or mdSim simulation to be restartable, the original run must periodically write a restart file. The restart file is written repeatedly to a single file: Each time the file is written, the previous version of the file is overwritten, so that only the most recent verion is available. The interval (number of time steps) between subsequent file writes is given in the parameter file by an integer parameter named "writeRestartInterval". Output of the restart file may be completely suppressed by setting this parameter to zero. If writeRestartInterval is not zero, the base name of the output file is given by a string parameter "writeRestartFileName." The full name of the output restart file is constructed by appending a suffix ".rst" to this base name.</p>
<p>The parameters "writeRestartInterval" and (if present) "writeRestartFileName" are the last parameters in main block of the parameter file. They appear just before the closing bracket of the main block, and just after the closing bracket of the <a class="el" href="classMcMd_1_1DiagnosticManager.html" title="Manager for a list of Diagnostic objects.">DiagnosticManager</a> block. For example, an mcSim or mdSim parameter file that requires the restart file to be written every 10000 time steps to a file named "restart.rst" would thus look in part like this </p>
<div class="fragment"><pre class="fragment">MdSimulation{
  ...
  DiagnosticManager{
     ...
  }
  writeRestartInterval        10000
  writeRestarttFileName     restart
}
</pre></div><p> where ellipses (...)indicate omitted parts of the file.</p>
<p>If writeRestartInterval is set to 0, output of restart file is suppressed. In this case, the "writeRestartFileName" parameter must be omitted. The parameter file for an mdSim simulation with no restart file output would thus look like this: </p>
<div class="fragment"><pre class="fragment">MdSimulation{
  ...
  DiagnosticManager{
     ...
  }
  writeRestartInterval           0
}
</pre></div><h2><a class="anchor" id="user_restart_page_command"></a>
Command File</h2>
<p>When a simulation is restarted, it first reads the restart (*.rst) file to recreate the internal state of the simulation, and then begins reading a separated command file. The command file for a restart simulation must begin with a RESTART command that specifies how many steps to continue the simulation (as discussed below) which may be followed by other commands.</p>
<p>The name of the command file for a restarted simulation must must begin with the same base name as the corresponding *.rst restart file, followed by a file extension ".cmd" (for "command"). The restart (*.rst) file and command (*.cmd) file must be placed in the same directory. For single-processor simulations, this must be the directory from which the program was invoked.</p>
<p>The first line of command file for a restarted simulation must contain a command that begins with the keyword "RESTART". The RESTART command causes the simulation to re-enter the main simulation loop at the point at which the restart file was written, with the step counter set to the value it had when that file was written, and then continue the simulation continue until the step counter reaches a specified final value. The final value for the step counter is given as an argument to the RESTART command, after the RESTART keyword. The last line of any command file must contain a "FINISH" command, which terminates execution. The command file to restart a simulation and continue until the step counter reaches 150000, and then terminate, without doing anything else, would thus look like this: </p>
<div class="fragment"><pre class="fragment">   RESTART   150000
   FINISH
</pre></div><p> Other commands may also appear before the initial RESTART command and the final FINISH command, in order to, e.g., write the final configuration to a configuration file, or change parameters and run another simulation.</p>
<p>The RESTART command is only valid in an mcSim or mdSim simulation that was invoked with the RESTART (-r) command line option, in which case it must be the first line of the file.</p>
<h2><a class="anchor" id="user_restart_page_usage"></a>
Command Line Usage</h2>
<p>To restart an mcSim or mdSim simulation, one must invoke the mdSim or mcSim executable with the -r option, and supply the common base name of the *.rst and *.cmd files as an argument t this command line option. Thus, for example, if a previous MC simulation were run using a base name of "restart" for the outputFileName in the <a class="el" href="classMcMd_1_1McWriteRestart.html" title="Periodically write restart file.">McWriteRestart</a> <a class="el" href="classMcMd_1_1Diagnostic.html" title="Abstract base for periodic output and/or analysis actions.">Diagnostic</a>, one could type </p>
<div class="fragment"><pre class="fragment">   mcSim -r restart
</pre></div><p> to restart the simulation. In the above example, the -r option would cause the program to read restart.rst to initialize the simulation and then execute the commands in the file restart.cmd. Execution will fail if either of these files is missing.</p>
<p>The -r option may be combined with the -e option, which causes parameters that would normally be read from the parameter file to be echoed to standard output while the program is reading the parameter file.</p>
<h2><a class="anchor" id="user_restart_page_multiprocessor"></a>
Multi-processor simulations</h2>
<p>Is is also possible to restart multi-processor mcSim and mdSim simulations. Please read the discussion of <a class="el" href="user_multi_McMd_page.html">multi-processor mcSim and mdSim simulations</a> before reading the following discussion of multi-processor restart procedures.</p>
<p>In multi-processor simulations, as for single processor simulations, restart files are written by <a class="el" href="classMcMd_1_1McWriteRestart.html" title="Periodically write restart file.">McWriteRestart</a> or <a class="el" href="classMcMd_1_1MdWriteRestart.html" title="Repeatedly write restart file.">MdWriteRestart</a> diagnostic. The parameter file format for these diagnostics is the same in single- and multi-processor simulations. In all multi-processor simulations, whether independent or replicated, these diagnostics write a separate restart file for each processor. The restart file for each processor is placed in the numbered directory that contains data associated with that processor. For example, if the writeRestartFileName parameter in the original parameter file is "restart", the restart file for processor 2 would be repeatedly written to the file 2/restart.rst.</p>
<p>The conventions for command files are different for "independent" and "replicated" simulations. Independent simulations use a separate *.rst restart command file for each processor, each of which is placed in the same directory as the associated restart file. Replicated simulations use a single restart command file, which must be placed in the same directory as the single parameter file and command file for the original simulation, which is also the directory from which the mcSim or mdSim executable is invoked. In either case, the base name of the command file or files must be the same as the base name of the restart files, whichis determined by the outputFileName parameter used by the <a class="el" href="classMcMd_1_1McWriteRestart.html" title="Periodically write restart file.">McWriteRestart</a> or <a class="el" href="classMcMd_1_1MdWriteRestart.html" title="Repeatedly write restart file.">MdWriteRestart</a> diagnostic during the original simulation.</p>
<p>The command to restart a multi-processor simulation is similar to that for a single-processor simulation. The command to restart a 3 processor mcSim simulation of either independent or replicated systems, using the mcSim_m_f executable and the mpirun command to launch an MPI program, is </p>
<div class="fragment"><pre class="fragment">   mpirun -np 3 mcSim_m_f -e -r restart
</pre></div><p> Information about whether the original simulation was a simulation of independent or replicated systems is stored within all restart files, and does not need to be specified by a command line option when the simulation is restarted. Invoking an mcSim or mdSim executable with both the "-r" and "-p" options is thus illegal, and will cause execution to halt with an error message.</p>
<p>Navigation: </p>
<ul style="list-style: none;">
<li>
<a class="el" href="user_analysis_page.html">2.7 Data Analysis</a> (Previous)  </li>
<li>
<a class="el" href="user_page.html">2 User Guide</a> (Up)  </li>
<li>
<a class="el" href="user_multi_page.html">2.9 Multi-System Simulations</a> (Next)  </li>
</ul>
</div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Mon Jan 21 2013 23:22:45 for Simpatico by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
